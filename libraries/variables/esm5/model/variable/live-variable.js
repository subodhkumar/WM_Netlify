import * as tslib_1 from "tslib";
import { DataSource, isDefined } from '@wm/core';
import { VariableManagerFactory } from '../../factory/variable-manager.factory';
import { ApiAwareVariable } from './api-aware-variable';
import { VARIABLE_CONSTANTS } from '../../constants/variables.constants';
var getManager = function () {
    return VariableManagerFactory.get(VARIABLE_CONSTANTS.CATEGORY.LIVE);
};
var ɵ0 = getManager;
var LiveVariable = /** @class */ (function (_super) {
    tslib_1.__extends(LiveVariable, _super);
    function LiveVariable(variable) {
        var _this = _super.call(this) || this;
        Object.assign(_this, variable);
        return _this;
    }
    LiveVariable.prototype.execute = function (operation, options) {
        var returnVal = _super.prototype.execute.call(this, operation, options);
        if (isDefined(returnVal)) {
            return returnVal;
        }
        switch (operation) {
            case DataSource.Operation.IS_API_AWARE:
                returnVal = true;
                break;
            case DataSource.Operation.SUPPORTS_CRUD:
                returnVal = true;
                break;
            case DataSource.Operation.SUPPORTS_DISTINCT_API:
                returnVal = true;
                break;
            case DataSource.Operation.IS_PAGEABLE:
                returnVal = true;
                break;
            case DataSource.Operation.SUPPORTS_SERVER_FILTER:
                returnVal = true;
                break;
            case DataSource.Operation.GET_OPERATION_TYPE:
                returnVal = this.operation;
                break;
            case DataSource.Operation.GET_RELATED_PRIMARY_KEYS:
                returnVal = this.getRelatedTablePrimaryKeys(options);
                break;
            case DataSource.Operation.GET_ENTITY_NAME:
                returnVal = this.propertiesMap.entityName;
                break;
            case DataSource.Operation.LIST_RECORDS:
                returnVal = this.listRecords(options);
                break;
            case DataSource.Operation.UPDATE_RECORD:
                returnVal = this.updateRecord(options);
                break;
            case DataSource.Operation.INSERT_RECORD:
                returnVal = this.insertRecord(options);
                break;
            case DataSource.Operation.DELETE_RECORD:
                returnVal = this.deleteRecord(options);
                break;
            case DataSource.Operation.INVOKE:
                returnVal = this.invoke(options);
                break;
            case DataSource.Operation.UPDATE:
                returnVal = this.update(options);
                break;
            case DataSource.Operation.GET_RELATED_TABLE_DATA:
                returnVal = this.getRelatedTableData(options.relatedField, options);
                break;
            case DataSource.Operation.GET_DISTINCT_DATA_BY_FIELDS:
                returnVal = this.getDistinctDataByFields(options);
                break;
            case DataSource.Operation.GET_AGGREGATED_DATA:
                returnVal = this.getAggregatedData(options);
                break;
            case DataSource.Operation.GET_MATCH_MODE:
                returnVal = this.matchMode;
                break;
            case DataSource.Operation.DOWNLOAD:
                returnVal = this.download(options);
                break;
            case DataSource.Operation.GET_PROPERTIES_MAP:
                returnVal = this.propertiesMap;
                break;
            case DataSource.Operation.GET_PRIMARY_KEY:
                returnVal = this.getPrimaryKey();
                break;
            case DataSource.Operation.GET_BLOB_URL:
                returnVal = "services/" + this.liveSource + "/" + this.type + "/" + options.primaryValue + "/content/" + options.columnName;
                break;
            case DataSource.Operation.GET_OPTIONS:
                returnVal = this._options || {};
                break;
            case DataSource.Operation.SEARCH_RECORDS:
                returnVal = this.searchRecords(options);
                break;
            case DataSource.Operation.GET_REQUEST_PARAMS:
                returnVal = this.getRequestParams(options);
                break;
            case DataSource.Operation.GET_PAGING_OPTIONS:
                returnVal = this.pagination;
                break;
            case DataSource.Operation.IS_UPDATE_REQUIRED:
                returnVal = true;
                break;
            case DataSource.Operation.IS_BOUND_TO_LOCALE:
                returnVal = false;
                break;
            case DataSource.Operation.CANCEL:
                returnVal = false;
                break;
            default:
                returnVal = {};
                break;
        }
        return returnVal;
    };
    LiveVariable.prototype.listRecords = function (options, success, error) {
        return getManager().listRecords(this, options, success, error);
    };
    LiveVariable.prototype.updateRecord = function (options, success, error) {
        return getManager().updateRecord(this, options, success, error);
    };
    LiveVariable.prototype.insertRecord = function (options, success, error) {
        return getManager().insertRecord(this, options, success, error);
    };
    LiveVariable.prototype.deleteRecord = function (options, success, error) {
        return getManager().deleteRecord(this, options, success, error);
    };
    LiveVariable.prototype.setInput = function (key, val, options) {
        return getManager().setInput(this, key, val, options);
    };
    LiveVariable.prototype.setFilter = function (key, val) {
        return getManager().setFilter(this, key, val);
    };
    LiveVariable.prototype.download = function (options, success, error) {
        return getManager().download(this, options, success, error);
    };
    LiveVariable.prototype.invoke = function (options, success, error) {
        switch (this.operation) {
            case 'insert':
                return this.insertRecord(options, success, error);
            case 'update':
                return this.updateRecord(options, success, error);
            case 'delete':
                return this.deleteRecord(options, success, error);
            default:
                return this.listRecords(options, success, error);
        }
    };
    LiveVariable.prototype.getRelatedTablePrimaryKeys = function (columnName) {
        return getManager().getRelatedTablePrimaryKeys(this, columnName);
    };
    LiveVariable.prototype.getRelatedTableData = function (columnName, options, success, error) {
        return getManager().getRelatedTableData(this, columnName, options, success, error);
    };
    LiveVariable.prototype.getDistinctDataByFields = function (options, success, error) {
        return getManager().getDistinctDataByFields(this, options, success, error);
    };
    LiveVariable.prototype.getAggregatedData = function (options, success, error) {
        return getManager().getAggregatedData(this, options, success, error);
    };
    LiveVariable.prototype.getPrimaryKey = function () {
        return getManager().getPrimaryKey(this);
    };
    LiveVariable.prototype.searchRecords = function (options, success, error) {
        return getManager().searchRecords(this, options, success, error);
    };
    LiveVariable.prototype.getRequestParams = function (options) {
        return getManager().prepareRequestParams(options);
    };
    LiveVariable.prototype._downgradeInputData = function (data) {
        return getManager().downgradeFilterExpressionsToInputData(this, data);
    };
    LiveVariable.prototype._upgradeInputData = function (response, data) {
        return getManager().upgradeInputDataToFilterExpressions(this, response, data);
    };
    LiveVariable.prototype.setOrderBy = function (expression) {
        this.orderBy = expression;
        /* update the variable if autoUpdate flag is set */
        if (this.autoUpdate) {
            this.update();
        }
        return this.orderBy;
    };
    // legacy method
    LiveVariable.prototype.update = function (options, success, error) {
        return this.invoke(options, success, error);
    };
    LiveVariable.prototype.createRecord = function (options, success, error) {
        return this.insertRecord(options, success, error);
    };
    LiveVariable.prototype.init = function () {
        getManager().initBinding(this, 'dataBinding', this.operation === 'read' ? 'filterFields' : 'inputFields');
        if (this.operation === 'read') {
            getManager().initFilterExpressionBinding(this);
        }
        getManager().defineFirstLastRecord(this);
    };
    LiveVariable.prototype.cancel = function (options) {
        return getManager().cancel(this, options);
    };
    return LiveVariable;
}(ApiAwareVariable));
export { LiveVariable };
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS12YXJpYWJsZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B3bS92YXJpYWJsZXMvIiwic291cmNlcyI6WyJtb2RlbC92YXJpYWJsZS9saXZlLXZhcmlhYmxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFlLFNBQVMsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUU5RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUNoRixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN4RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUd6RSxJQUFNLFVBQVUsR0FBRztJQUNmLE9BQU8sc0JBQXNCLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN4RSxDQUFDLENBQUM7O0FBRUY7SUFBa0Msd0NBQWdCO0lBWTlDLHNCQUFZLFFBQWE7UUFBekIsWUFDSSxpQkFBTyxTQUVWO1FBREcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFXLEVBQUUsUUFBUSxDQUFDLENBQUM7O0lBQ3pDLENBQUM7SUFFRCw4QkFBTyxHQUFQLFVBQVEsU0FBUyxFQUFFLE9BQU87UUFDdEIsSUFBSSxTQUFTLEdBQUcsaUJBQU0sT0FBTyxZQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUNsRCxJQUFJLFNBQVMsQ0FBQyxTQUFTLENBQUMsRUFBRTtZQUN0QixPQUFPLFNBQVMsQ0FBQztTQUNwQjtRQUVELFFBQVEsU0FBUyxFQUFFO1lBQ2YsS0FBSyxVQUFVLENBQUMsU0FBUyxDQUFDLFlBQVk7Z0JBQ2xDLFNBQVMsR0FBRyxJQUFJLENBQUM7Z0JBQ2pCLE1BQU07WUFDVixLQUFLLFVBQVUsQ0FBQyxTQUFTLENBQUMsYUFBYTtnQkFDbkMsU0FBUyxHQUFHLElBQUksQ0FBQztnQkFDakIsTUFBTTtZQUNWLEtBQUssVUFBVSxD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QUUsT0FBUSxFQUFFLEtBQU07UUFDbkMsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUVELDJCQUFJLEdBQUo7UUFDSSxVQUFVLEVBQUUsQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxJQUFJLENBQUMsU0FBUyxLQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUMxRyxJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssTUFBTSxFQUFFO1lBQzNCLFVBQVUsRUFBRSxDQUFDLDJCQUEyQixDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2xEO1FBQ0QsVUFBVSxFQUFFLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVELDZCQUFNLEdBQU4sVUFBTyxPQUFRO1FBQ1gsT0FBTyxVQUFVLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFDTCxtQkFBQztBQUFELENBQUMsQUFsT0QsQ0FBa0MsZ0JBQWdCLEdBa09qRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERhdGFTb3VyY2UsIElEYXRhU291cmNlLCBpc0RlZmluZWQgfSBmcm9tICdAd20vY29yZSc7XG5cbmltcG9ydCB7IFZhcmlhYmxlTWFuYWdlckZhY3RvcnkgfSBmcm9tICcuLi8uLi9mYWN0b3J5L3ZhcmlhYmxlLW1hbmFnZXIuZmFjdG9yeSc7XG5pbXBvcnQgeyBBcGlBd2FyZVZhcmlhYmxlIH0gZnJvbSAnLi9hcGktYXdhcmUtdmFyaWFibGUnO1xuaW1wb3J0IHsgVkFSSUFCTEVfQ09OU1RBTlRTIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL3ZhcmlhYmxlcy5jb25zdGFudHMnO1xuaW1wb3J0IHsgTGl2ZVZhcmlhYmxlTWFuYWdlciB9IGZyb20gJy4uLy4uL21hbmFnZXIvdmFyaWFibGUvbGl2ZS12YXJpYWJsZS5tYW5hZ2VyJztcblxuY29uc3QgZ2V0TWFuYWdlciA9ICgpOiBMaXZlVmFyaWFibGVNYW5hZ2VyID0+IHtcbiAgICByZXR1cm4gVmFyaWFibGVNYW5hZ2VyRmFjdG9yeS5nZXQoVkFSSUFCTEVfQ09OU1RBTlRTLkNBVEVHT1JZLkxJVkUpO1xufTtcblxuZXhwb3J0IGNsYXNzIExpdmVWYXJpYWJsZSBleHRlbmRzIEFwaUF3YXJlVmFyaWFibGUgaW1wbGVtZW50cyBJRGF0YVNvdXJjZSB7XG5cbiAgICBtYXRjaE1vZGU7XG4gICAgbGl2ZVNvdXJjZTtcbiAgICBwcm9wZXJ0aWVzTWFwO1xuICAgIHBhZ2luYXRpb247XG4gICAgdHlwZTtcbiAgICBvcmRlckJ5O1xuICAgIF9vcHRpb25zO1xuICAgIC8vIFVzZWQgdG8gdHJhY2sgYSB2YXJpYWJsZSBodHRwIGNhbGwsIHNvIHRoYXQgaXQgY2FuIGJlIGNhbmNlbGxlZCBhdCBhbnkgcG9pbnQgb2YgdGltZSBkdXJpbmcgaXRzIGV4ZWN1dGlvblxuICAgIF9vYnNlcnZhYmxlO1xuXG4gICAgY29uc3RydWN0b3IodmFyaWFibGU6IGFueSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMgYXMgYW55LCB2YXJpYWJsZSk7XG4gICAgfVxuXG4gICAgZXhlY3V0ZShvcGVyYXRpb24sIG9wdGlvbnMpIHtcbiAgICAgICAgbGV0IHJldHVyblZhbCA9IHN1cGVyLmV4ZWN1dGUob3BlcmF0aW9uLCBvcHRpb25zKTtcbiAgICAgICAgaWYgKGlzRGVmaW5lZChyZXR1cm5WYWwpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsO1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoIChvcGVyYXRpb24pIHtcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uSVNfQVBJX0FXQVJFOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLlNVUFBPUlRTX0NSVUQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uU1VQUE9SVFNfRElTVElOQ1RfQVBJOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLklTX1BBR0VBQkxFOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLlNVUFBPUlRTX1NFUlZFUl9GSUxURVI6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uR0VUX09QRVJBVElPTl9UWVBFOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRoaXMub3BlcmF0aW9uO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5HRVRfUkVMQVRFRF9QUklNQVJZX0tFWVM6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gdGhpcy5nZXRSZWxhdGVkVGFibGVQcmltYXJ5S2V5cyhvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uR0VUX0VOVElUWV9OQU1FOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRoaXMucHJvcGVydGllc01hcC5lbnRpdHlOYW1lO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5MSVNUX1JFQ09SRFM6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gdGhpcy5saXN0UmVjb3JkcyhvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uVVBEQVRFX1JFQ09SRCA6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gdGhpcy51cGRhdGVSZWNvcmQob3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLklOU0VSVF9SRUNPUkQgOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRoaXMuaW5zZXJ0UmVjb3JkKG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5ERUxFVEVfUkVDT1JEIDpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0aGlzLmRlbGV0ZVJlY29yZChvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uSU5WT0tFIDpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0aGlzLmludm9rZShvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uVVBEQVRFIDpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0aGlzLnVwZGF0ZShvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uR0VUX1JFTEFURURfVEFCTEVfREFUQTpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0aGlzLmdldFJlbGF0ZWRUYWJsZURhdGEob3B0aW9ucy5yZWxhdGVkRmllbGQsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5HRVRfRElTVElOQ1RfREFUQV9CWV9GSUVMRFM6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gdGhpcy5nZXREaXN0aW5jdERhdGFCeUZpZWxkcyhvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uR0VUX0FHR1JFR0FURURfREFUQTpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0aGlzLmdldEFnZ3JlZ2F0ZWREYXRhKG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5HRVRfTUFUQ0hfTU9ERTpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0aGlzLm1hdGNoTW9kZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uRE9XTkxPQUQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gdGhpcy5kb3dubG9hZChvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uR0VUX1BST1BFUlRJRVNfTUFQOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRoaXMucHJvcGVydGllc01hcDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uR0VUX1BSSU1BUllfS0VZOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRoaXMuZ2V0UHJpbWFyeUtleSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5HRVRfQkxPQl9VUkw6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gYHNlcnZpY2VzLyR7dGhpcy5saXZlU291cmNlfS8ke3RoaXMudHlwZX0vJHtvcHRpb25zLnByaW1hcnlWYWx1ZX0vY29udGVudC8ke29wdGlvbnMuY29sdW1uTmFtZX1gO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5HRVRfT1BUSU9OUzpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0aGlzLl9vcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5TRUFSQ0hfUkVDT1JEUzpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0aGlzLnNlYXJjaFJlY29yZHMob3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLkdFVF9SRVFVRVNUX1BBUkFNUzpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0aGlzLmdldFJlcXVlc3RQYXJhbXMob3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLkdFVF9QQUdJTkdfT1BUSU9OUzpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0aGlzLnBhZ2luYXRpb247XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLklTX1VQREFURV9SRVFVSVJFRDpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5JU19CT1VORF9UT19MT0NBTEU6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLkNBTkNFTDpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0ge307XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJldHVyblZhbDtcbiAgICB9XG5cbiAgICBsaXN0UmVjb3JkcyhvcHRpb25zPywgc3VjY2Vzcz8sIGVycm9yPykge1xuICAgICAgICByZXR1cm4gZ2V0TWFuYWdlcigpLmxpc3RSZWNvcmRzKHRoaXMsIG9wdGlvbnMsIHN1Y2Nlc3MsIGVycm9yKTtcbiAgICB9XG5cbiAgICB1cGRhdGVSZWNvcmQob3B0aW9ucz8sIHN1Y2Nlc3M/LCBlcnJvcj8pIHtcbiAgICAgICAgcmV0dXJuIGdldE1hbmFnZXIoKS51cGRhdGVSZWNvcmQodGhpcywgb3B0aW9ucywgc3VjY2VzcywgZXJyb3IpO1xuICAgIH1cblxuICAgIGluc2VydFJlY29yZChvcHRpb25zPywgc3VjY2Vzcz8sIGVycm9yPykge1xuICAgICAgICByZXR1cm4gZ2V0TWFuYWdlcigpLmluc2VydFJlY29yZCh0aGlzLCBvcHRpb25zLCBzdWNjZXNzLCBlcnJvcik7XG4gICAgfVxuXG4gICAgZGVsZXRlUmVjb3JkKG9wdGlvbnM/LCBzdWNjZXNzPywgZXJyb3I/KSB7XG4gICAgICAgIHJldHVybiBnZXRNYW5hZ2VyKCkuZGVsZXRlUmVjb3JkKHRoaXMsIG9wdGlvbnMsIHN1Y2Nlc3MsIGVycm9yKTtcbiAgICB9XG5cbiAgICBzZXRJbnB1dChrZXksIHZhbCwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gZ2V0TWFuYWdlcigpLnNldElucHV0KHRoaXMsIGtleSwgdmFsLCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICBzZXRGaWx0ZXIoa2V5LCB2YWwpIHtcbiAgICAgICAgcmV0dXJuIGdldE1hbmFnZXIoKS5zZXRGaWx0ZXIodGhpcywga2V5LCB2YWwpO1xuICAgIH1cblxuICAgIGRvd25sb2FkKG9wdGlvbnMsIHN1Y2Nlc3M/LCBlcnJvcj8pIHtcbiAgICAgICAgcmV0dXJuIGdldE1hbmFnZXIoKS5kb3dubG9hZCh0aGlzLCBvcHRpb25zLCBzdWNjZXNzLCBlcnJvcik7XG4gICAgfVxuXG4gICAgaW52b2tlKG9wdGlvbnM/LCBzdWNjZXNzPywgZXJyb3I/KSB7XG4gICAgICAgIHN3aXRjaCAodGhpcy5vcGVyYXRpb24pIHtcbiAgICAgICAgICAgIGNhc2UgJ2luc2VydCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0UmVjb3JkKG9wdGlvbnMsIHN1Y2Nlc3MsIGVycm9yKTtcbiAgICAgICAgICAgIGNhc2UgJ3VwZGF0ZSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudXBkYXRlUmVjb3JkKG9wdGlvbnMsIHN1Y2Nlc3MsIGVycm9yKTtcbiAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVsZXRlUmVjb3JkKG9wdGlvbnMsIHN1Y2Nlc3MsIGVycm9yKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGlzdFJlY29yZHMob3B0aW9ucywgc3VjY2VzcywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0UmVsYXRlZFRhYmxlUHJpbWFyeUtleXMoY29sdW1uTmFtZSkge1xuICAgICAgICByZXR1cm4gZ2V0TWFuYWdlcigpLmdldFJlbGF0ZWRUYWJsZVByaW1hcnlLZXlzKHRoaXMsIGNvbHVtbk5hbWUpO1xuICAgIH1cblxuICAgIGdldFJlbGF0ZWRUYWJsZURhdGEoY29sdW1uTmFtZSwgb3B0aW9ucywgc3VjY2Vzcz8sIGVycm9yPykge1xuICAgICAgICByZXR1cm4gZ2V0TWFuYWdlcigpLmdldFJlbGF0ZWRUYWJsZURhdGEodGhpcywgY29sdW1uTmFtZSwgb3B0aW9ucywgc3VjY2VzcywgZXJyb3IpO1xuICAgIH1cblxuICAgIGdldERpc3RpbmN0RGF0YUJ5RmllbGRzKG9wdGlvbnMsIHN1Y2Nlc3M/LCBlcnJvcj8pIHtcbiAgICAgICAgcmV0dXJuIGdldE1hbmFnZXIoKS5nZXREaXN0aW5jdERhdGFCeUZpZWxkcyh0aGlzLCBvcHRpb25zLCBzdWNjZXNzLCBlcnJvcik7XG4gICAgfVxuXG4gICAgZ2V0QWdncmVnYXRlZERhdGEob3B0aW9ucywgc3VjY2Vzcz8sIGVycm9yPykge1xuICAgICAgICByZXR1cm4gZ2V0TWFuYWdlcigpLmdldEFnZ3JlZ2F0ZWREYXRhKHRoaXMsIG9wdGlvbnMsIHN1Y2Nlc3MsIGVycm9yKTtcbiAgICB9XG5cbiAgICBnZXRQcmltYXJ5S2V5KCkge1xuICAgICAgICByZXR1cm4gZ2V0TWFuYWdlcigpLmdldFByaW1hcnlLZXkodGhpcyk7XG4gICAgfVxuXG4gICAgc2VhcmNoUmVjb3JkcyhvcHRpb25zLCBzdWNjZXNzPywgZXJyb3I/KSB7XG4gICAgICAgIHJldHVybiBnZXRNYW5hZ2VyKCkuc2VhcmNoUmVjb3Jkcyh0aGlzLCBvcHRpb25zLCBzdWNjZXNzLCBlcnJvcik7XG4gICAgfVxuXG4gICAgZ2V0UmVxdWVzdFBhcmFtcyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBnZXRNYW5hZ2VyKCkucHJlcGFyZVJlcXVlc3RQYXJhbXMob3B0aW9ucyk7XG4gICAgfVxuXG4gICAgX2Rvd25ncmFkZUlucHV0RGF0YShkYXRhKSB7XG4gICAgICAgIHJldHVybiBnZXRNYW5hZ2VyKCkuZG93bmdyYWRlRmlsdGVyRXhwcmVzc2lvbnNUb0lucHV0RGF0YSh0aGlzLCBkYXRhKTtcbiAgICB9XG5cbiAgICBfdXBncmFkZUlucHV0RGF0YShyZXNwb25zZSwgZGF0YSkge1xuICAgICAgICByZXR1cm4gZ2V0TWFuYWdlcigpLnVwZ3JhZGVJbnB1dERhdGFUb0ZpbHRlckV4cHJlc3Npb25zKHRoaXMsIHJlc3BvbnNlLCBkYXRhKTtcbiAgICB9XG5cbiAgICBzZXRPcmRlckJ5KGV4cHJlc3Npb24pIHtcbiAgICAgICAgdGhpcy5vcmRlckJ5ID0gZXhwcmVzc2lvbjtcblxuICAgICAgICAvKiB1cGRhdGUgdGhlIHZhcmlhYmxlIGlmIGF1dG9VcGRhdGUgZmxhZyBpcyBzZXQgKi9cbiAgICAgICAgaWYgKHRoaXMuYXV0b1VwZGF0ZSkge1xuICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLm9yZGVyQnk7XG4gICAgfVxuXG4gICAgLy8gbGVnYWN5IG1ldGhvZFxuICAgIHVwZGF0ZShvcHRpb25zPywgc3VjY2Vzcz8sIGVycm9yPykge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnZva2Uob3B0aW9ucywgc3VjY2VzcywgZXJyb3IpO1xuICAgIH1cblxuICAgIGNyZWF0ZVJlY29yZChvcHRpb25zPywgc3VjY2Vzcz8sIGVycm9yPykge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnNlcnRSZWNvcmQob3B0aW9ucywgc3VjY2VzcywgZXJyb3IpO1xuICAgIH1cblxuICAgIGluaXQoKSB7XG4gICAgICAgIGdldE1hbmFnZXIoKS5pbml0QmluZGluZyh0aGlzLCAnZGF0YUJpbmRpbmcnLCB0aGlzLm9wZXJhdGlvbiA9PT0gJ3JlYWQnID8gJ2ZpbHRlckZpZWxkcycgOiAnaW5wdXRGaWVsZHMnKTtcbiAgICAgICAgaWYgKHRoaXMub3BlcmF0aW9uID09PSAncmVhZCcpIHtcbiAgICAgICAgICAgIGdldE1hbmFnZXIoKS5pbml0RmlsdGVyRXhwcmVzc2lvbkJpbmRpbmcodGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgZ2V0TWFuYWdlcigpLmRlZmluZUZpcnN0TGFzdFJlY29yZCh0aGlzKTtcbiAgICB9XG5cbiAgICBjYW5jZWwob3B0aW9ucz8pIHtcbiAgICAgICAgcmV0dXJuIGdldE1hbmFnZXIoKS5jYW5jZWwodGhpcywgb3B0aW9ucyk7XG4gICAgfVxufVxuIl19