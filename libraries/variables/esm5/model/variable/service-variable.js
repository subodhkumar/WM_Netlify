import * as tslib_1 from "tslib";
import { DataSource, isDefined } from '@wm/core';
import { VariableManagerFactory } from '../../factory/variable-manager.factory';
import { ApiAwareVariable } from './api-aware-variable';
import { VARIABLE_CONSTANTS } from '../../constants/variables.constants';
import { ServiceVariableUtils } from '../../util/variable/service-variable.utils';
var getManager = function () {
    return VariableManagerFactory.get(VARIABLE_CONSTANTS.CATEGORY.SERVICE);
};
var ɵ0 = getManager;
var ServiceVariable = /** @class */ (function (_super) {
    tslib_1.__extends(ServiceVariable, _super);
    function ServiceVariable(variable) {
        var _this = _super.call(this) || this;
        Object.assign(_this, variable);
        return _this;
    }
    ServiceVariable.prototype.execute = function (operation, options) {
        var returnVal = _super.prototype.execute.call(this, operation, options);
        if (isDefined(returnVal)) {
            return returnVal;
        }
        switch (operation) {
            case DataSource.Operation.IS_API_AWARE:
                returnVal = true;
                break;
            case DataSource.Operation.SUPPORTS_CRUD:
                returnVal = false;
                break;
            case DataSource.Operation.SUPPORTS_DISTINCT_API:
                returnVal = false;
                break;
            case DataSource.Operation.IS_PAGEABLE:
                returnVal = (this.controller === VARIABLE_CONSTANTS.CONTROLLER_TYPE.QUERY || !_.isEmpty(this.pagination));
                break;
            case DataSource.Operation.SUPPORTS_SERVER_FILTER:
                returnVal = false;
                break;
            case DataSource.Operation.SET_INPUT:
                returnVal = this.setInput(options);
                break;
            case DataSource.Operation.LIST_RECORDS:
                returnVal = this.invoke(options);
                break;
            case DataSource.Operation.INVOKE:
                returnVal = this.invoke(options);
                break;
            case DataSource.Operation.UPDATE:
                returnVal = this.update(options);
                break;
            case DataSource.Operation.SEARCH_RECORDS:
                returnVal = this.searchRecords(options);
                break;
            case DataSource.Operation.DOWNLOAD:
                returnVal = this.download(options);
                break;
            case DataSource.Operation.GET_PAGING_OPTIONS:
                returnVal = this.pagination;
                break;
            case DataSource.Operation.IS_UPDATE_REQUIRED:
                returnVal = this.isUpdateRequired(options);
                break;
            case DataSource.Operation.IS_BOUND_TO_LOCALE:
                returnVal = false;
                break;
            case DataSource.Operation.CANCEL:
                returnVal = this.cancel(options);
                break;
            default:
                returnVal = {};
                break;
        }
        return returnVal;
    };
    ServiceVariable.prototype.invoke = function (options, success, error) {
        return getManager().invoke(this, options, success, error);
    };
    ServiceVariable.prototype.update = function (options, success, error) {
        return getManager().invoke(this, options, success, error);
    };
    ServiceVariable.prototype.download = function (options, success, error) {
        return getManager().download(this, options, success, error);
    };
    ServiceVariable.prototype.setInput = function (key, val, options) {
        return getManager().setInput(this, key, val, options);
    };
    ServiceVariable.prototype.searchRecords = function (options, success, error) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            getManager().searchRecords(_this, options, function (response, pagination) {
                resolve({ data: response.content || response, pagination: pagination });
            }, reject);
        });
    };
    ServiceVariable.prototype.isUpdateRequired = function (hasData) {
        var inputFields = getManager().getInputParms(this);
        var queryParams = ServiceVariableUtils.excludePaginationParams(inputFields);
        if (!queryParams.length) {
            // if we don't have any query params and variable data is available then we don't need variable update, so return false
            if (hasData) {
                return false;
            }
        }
        return true;
    };
    ServiceVariable.prototype.cancel = function (options) {
        return getManager().cancel(this, options);
    };
    ServiceVariable.prototype.init = function () {
        getManager().initBinding(this);
        getManager().defineFirstLastRecord(this);
    };
    return ServiceVariable;
}(ApiAwareVariable));
export { ServiceVariable };
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmljZS12YXJpYWJsZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B3bS92YXJpYWJsZXMvIiwic291cmNlcyI6WyJtb2RlbC92YXJpYWJsZS9zZXJ2aWNlLXZhcmlhYmxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFlLFNBQVMsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUU5RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUNoRixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN4RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUV6RSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUlsRixJQUFNLFVBQVUsR0FBRztJQUNmLE9BQU8sc0JBQXNCLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUMzRSxDQUFDLENBQUM7O0FBRUY7SUFBcUMsMkNBQWdCO0lBUWpELHlCQUFZLFFBQWE7UUFBekIsWUFDSSxpQkFBTyxTQUVWO1FBREcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFXLEVBQUUsUUFBUSxDQUFDLENBQUM7O0lBQ3pDLENBQUM7SUFFRCxpQ0FBTyxHQUFQLFVBQVEsU0FBUyxFQUFFLE9BQU87UUFDdEIsSUFBSSxTQUFTLEdBQUcsaUJBQU0sT0FBTyxZQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUNsRCxJQUFJLFNBQVMsQ0FBQyxTQUFTLENBQUMsRUFBRTtZQUN0QixPQUFPLFNBQVMsQ0FBQztTQUNwQjtRQUVELFFBQVEsU0FBUyxFQUFFO1lBQ2YsS0FBSyxVQUFVLENBQUMsU0FBUyxDQUFDLFlBQVk7Z0JBQ2xDLFNBQVMsR0FBRyxJQUFJLENBQUM7Z0JBQ2pCLE1BQU07WUFDVixLQUFLLFVBQVUsQ0FBQyxTQUFTLENBQUMsYUFBYTtnQkFD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QUFJLENBQUMsQ0FBQztRQUMvQixVQUFVLEVBQUUsQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBQ0wsc0JBQUM7QUFBRCxDQUFDLEFBdEhELENBQXFDLGdCQUFnQixHQXNIcEQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEYXRhU291cmNlLCBJRGF0YVNvdXJjZSwgaXNEZWZpbmVkIH0gZnJvbSAnQHdtL2NvcmUnO1xuXG5pbXBvcnQgeyBWYXJpYWJsZU1hbmFnZXJGYWN0b3J5IH0gZnJvbSAnLi4vLi4vZmFjdG9yeS92YXJpYWJsZS1tYW5hZ2VyLmZhY3RvcnknO1xuaW1wb3J0IHsgQXBpQXdhcmVWYXJpYWJsZSB9IGZyb20gJy4vYXBpLWF3YXJlLXZhcmlhYmxlJztcbmltcG9ydCB7IFZBUklBQkxFX0NPTlNUQU5UUyB9IGZyb20gJy4uLy4uL2NvbnN0YW50cy92YXJpYWJsZXMuY29uc3RhbnRzJztcbmltcG9ydCB7IFNlcnZpY2VWYXJpYWJsZU1hbmFnZXIgfSBmcm9tICcuLi8uLi9tYW5hZ2VyL3ZhcmlhYmxlL3NlcnZpY2UtdmFyaWFibGUubWFuYWdlcic7XG5pbXBvcnQgeyBTZXJ2aWNlVmFyaWFibGVVdGlscyB9IGZyb20gJy4uLy4uL3V0aWwvdmFyaWFibGUvc2VydmljZS12YXJpYWJsZS51dGlscyc7XG5cbmRlY2xhcmUgY29uc3QgXztcblxuY29uc3QgZ2V0TWFuYWdlciA9ICgpOiBTZXJ2aWNlVmFyaWFibGVNYW5hZ2VyID0+IHtcbiAgICByZXR1cm4gVmFyaWFibGVNYW5hZ2VyRmFjdG9yeS5nZXQoVkFSSUFCTEVfQ09OU1RBTlRTLkNBVEVHT1JZLlNFUlZJQ0UpO1xufTtcblxuZXhwb3J0IGNsYXNzIFNlcnZpY2VWYXJpYWJsZSBleHRlbmRzIEFwaUF3YXJlVmFyaWFibGUgaW1wbGVtZW50cyBJRGF0YVNvdXJjZSB7XG5cbiAgICAvLyBVc2VkIHRvIHRyYWNrIHByb2dyZXNzIG9mIGZpbGUgdXBsb2FkXG4gICAgX3Byb2dyZXNzT2JzZXJ2YWJsZTtcbiAgICAvLyBVc2VkIHRvIHRyYWNrIGEgdmFyaWFibGUgaHR0cCBjYWxsLCBzbyB0aGF0IGl0IGNhbiBiZSBjYW5jZWxsZWQgYXQgYW55IHBvaW50IG9mIHRpbWUgZHVyaW5nIGl0cyBleGVjdXRpb25cbiAgICBfb2JzZXJ2YWJsZTtcbiAgICBwYWdpbmF0aW9uO1xuXG4gICAgY29uc3RydWN0b3IodmFyaWFibGU6IGFueSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMgYXMgYW55LCB2YXJpYWJsZSk7XG4gICAgfVxuXG4gICAgZXhlY3V0ZShvcGVyYXRpb24sIG9wdGlvbnMpIHtcbiAgICAgICAgbGV0IHJldHVyblZhbCA9IHN1cGVyLmV4ZWN1dGUob3BlcmF0aW9uLCBvcHRpb25zKTtcbiAgICAgICAgaWYgKGlzRGVmaW5lZChyZXR1cm5WYWwpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsO1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoIChvcGVyYXRpb24pIHtcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uSVNfQVBJX0FXQVJFOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLlNVUFBPUlRTX0NSVUQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLlNVUFBPUlRTX0RJU1RJTkNUX0FQSTpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uSVNfUEFHRUFCTEU6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gKHRoaXMuY29udHJvbGxlciA9PT0gVkFSSUFCTEVfQ09OU1RBTlRTLkNPTlRST0xMRVJfVFlQRS5RVUVSWSB8fCAhXy5pc0VtcHR5KHRoaXMucGFnaW5hdGlvbikpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5TVVBQT1JUU19TRVJWRVJfRklMVEVSOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5TRVRfSU5QVVQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gdGhpcy5zZXRJbnB1dChvcHRpb25zKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uTElTVF9SRUNPUkRTOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRoaXMuaW52b2tlKG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5JTlZPS0UgOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRoaXMuaW52b2tlKG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5VUERBVEUgOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRoaXMudXBkYXRlKG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRhU291cmNlLk9wZXJhdGlvbi5TRUFSQ0hfUkVDT1JEUzpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0aGlzLnNlYXJjaFJlY29yZHMob3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLkRPV05MT0FEOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRoaXMuZG93bmxvYWQob3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLkdFVF9QQUdJTkdfT1BUSU9OUzpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0aGlzLnBhZ2luYXRpb247XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLklTX1VQREFURV9SRVFVSVJFRDpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0aGlzLmlzVXBkYXRlUmVxdWlyZWQob3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGFTb3VyY2UuT3BlcmF0aW9uLklTX0JPVU5EX1RPX0xPQ0FMRTpcbiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgRGF0YVNvdXJjZS5PcGVyYXRpb24uQ0FOQ0VMOlxuICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRoaXMuY2FuY2VsKG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdCA6XG4gICAgICAgICAgICAgICAgcmV0dXJuVmFsID0ge307XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJldHVyblZhbDtcbiAgICB9XG5cbiAgICBpbnZva2Uob3B0aW9ucz8sIHN1Y2Nlc3M/LCBlcnJvcj8pIHtcbiAgICAgICAgcmV0dXJuIGdldE1hbmFnZXIoKS5pbnZva2UodGhpcywgb3B0aW9ucywgc3VjY2VzcywgZXJyb3IpO1xuICAgIH1cblxuICAgIHVwZGF0ZShvcHRpb25zLCBzdWNjZXNzPywgZXJyb3I/KSB7XG4gICAgICAgIHJldHVybiBnZXRNYW5hZ2VyKCkuaW52b2tlKHRoaXMsIG9wdGlvbnMsIHN1Y2Nlc3MsIGVycm9yKTtcbiAgICB9XG5cbiAgICBkb3dubG9hZChvcHRpb25zLCBzdWNjZXNzPywgZXJyb3I/KSB7XG4gICAgICAgIHJldHVybiBnZXRNYW5hZ2VyKCkuZG93bmxvYWQodGhpcywgb3B0aW9ucywgc3VjY2VzcywgZXJyb3IpO1xuICAgIH1cblxuICAgIHNldElucHV0KGtleSwgdmFsPywgb3B0aW9ucz8pIHtcbiAgICAgICAgcmV0dXJuIGdldE1hbmFnZXIoKS5zZXRJbnB1dCh0aGlzLCBrZXksIHZhbCwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgc2VhcmNoUmVjb3JkcyhvcHRpb25zLCBzdWNjZXNzPywgZXJyb3I/KSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBnZXRNYW5hZ2VyKCkuc2VhcmNoUmVjb3Jkcyh0aGlzLCBvcHRpb25zLCAocmVzcG9uc2UsIHBhZ2luYXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHtkYXRhOiByZXNwb25zZS5jb250ZW50IHx8IHJlc3BvbnNlLCBwYWdpbmF0aW9ufSk7XG4gICAgICAgICAgICB9LCByZWplY3QpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBpc1VwZGF0ZVJlcXVpcmVkKGhhc0RhdGEpIHtcbiAgICAgICAgY29uc3QgaW5wdXRGaWVsZHMgPSBnZXRNYW5hZ2VyKCkuZ2V0SW5wdXRQYXJtcyh0aGlzKTtcbiAgICAgICAgY29uc3QgcXVlcnlQYXJhbXMgPSBTZXJ2aWNlVmFyaWFibGVVdGlscy5leGNsdWRlUGFnaW5hdGlvblBhcmFtcyhpbnB1dEZpZWxkcyk7XG5cbiAgICAgICAgaWYgKCFxdWVyeVBhcmFtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8vIGlmIHdlIGRvbid0IGhhdmUgYW55IHF1ZXJ5IHBhcmFtcyBhbmQgdmFyaWFibGUgZGF0YSBpcyBhdmFpbGFibGUgdGhlbiB3ZSBkb24ndCBuZWVkIHZhcmlhYmxlIHVwZGF0ZSwgc28gcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICBpZiAoaGFzRGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGNhbmNlbChvcHRpb25zPykge1xuICAgICAgICByZXR1cm4gZ2V0TWFuYWdlcigpLmNhbmNlbCh0aGlzLCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICBpbml0KCkge1xuICAgICAgICBnZXRNYW5hZ2VyKCkuaW5pdEJpbmRpbmcodGhpcyk7XG4gICAgICAgIGdldE1hbmFnZXIoKS5kZWZpbmVGaXJzdExhc3RSZWNvcmQodGhpcyk7XG4gICAgfVxufVxuIl19