import { BaseActionManager } from './base-action.manager';
import { VARIABLE_CONSTANTS } from '../../constants/variables.constants';
import { initiateCallback, toasterService, dialogService } from '../../util/variable/variables.utils';
export class NotificationActionManager extends BaseActionManager {
    onToasterClick(variable) {
        initiateCallback('onClick', variable, '');
    }
    onToasterHide(variable) {
        initiateCallback('onHide', variable, '');
    }
    notifyViaToaster(variable, options) {
        const type = (options.class || variable.dataBinding.class || 'info').toLowerCase(), body = options.message || variable.dataBinding.text, title = options.title, positionClass = 'toast-' + (options.position || variable.dataBinding.toasterPosition || 'bottom right').replace(' ', '-'), partialPage = variable.dataBinding.page, DEFAULT_DURATION = 3000;
        let duration = parseInt(variable.dataBinding.duration || options.duration, null), toaster;
        // duration
        if (!duration) {
            duration = (duration !== 0 && type === 'success') ? DEFAULT_DURATION : 0;
        }
        if (variable.dataBinding.content && variable.dataBinding.content === 'page' && partialPage) {
            toaster = toasterService.showCustom(partialPage, { positionClass: positionClass, timeOut: duration,
                partialParams: variable._binddataSet, context: variable._context });
        }
        else {
            toaster = toasterService.show(type, title, body || null, { positionClass: positionClass, timeOut: duration, enableHtml: true });
        }
        // callbacks
        if (variable.onClick) {
            toaster.onTap.subscribe(this.onToasterClick.bind(this, variable));
        }
        if (variable.onHide) {
            toaster.onHidden.subscribe(this.onToasterHide.bind(this, variable));
        }
    }
    notifyViaDialog(variable, options) {
        const commonPageDialogId = 'Common' + _.capitalize(variable.operation) + 'Dialog', variableOwner = variable.owner, dialogId = (variableOwner === VARIABLE_CONSTANTS.OWNER.APP) ? commonPageDialogId : 'notification' + variable.operation + 'dialog';
        dialogService.open(dialogId, variable._context, {
            notification: {
                'title': options.title || variable.dataBinding.title,
                'text': options.message || variable.dataBinding.text,
                'okButtonText': options.okButtonText || variable.dataBinding.okButtonText || 'OK',
                'cancelButtonText': options.cancelButtonText || variable.dataBinding.cancelButtonText || 'CANCEL',
                'alerttype': options.alerttype || variable.dataBinding.alerttype || 'information',
                onOk: () => {
                    initiateCallback('onOk', variable, options.data);
                    // Close the action dialog after triggering onOk callback event
                    dialogService.close(dialogId, variable._context);
                },
                onCancel: () => {
                    initiateCallback('onCancel', variable, options.data);
                    // Close the action dialog after triggering onCancel callback event
                    dialogService.close(dialogId, variable._context);
                },
                onClose: () => {
                    initiateCallback('onClose', variable, options.data);
                }
            }
        });
    }
    // *********************************************************** PUBLIC ***********************************************************//
    notify(variable, options, success, error) {
        const operation = variable.operation;
        options = options || {};
        if (operation === 'toast') {
            this.notifyViaToaster(variable, options);
        }
        else {
            this.notifyViaDialog(variable, options);
        }
    }
    getMessage(variable) {
        return variable.dataBinding.text;
    }
    setMessage(variable, text) {
        if (_.isString(text)) {
            variable.dataBinding.text = text;
        }
        return variable.dataBinding.text;
    }
    getOkButtonText(variable) {
        return variable.dataBinding.okButtonText;
    }
    setOkButtonText(variable, text) {
        if (_.isString(text)) {
            variable.dataBinding.okButtonText = text;
        }
        return variable.dataBinding.okButtonText;
    }
    getToasterDuration(variable) {
        return variable.dataBinding.duration;
    }
    setToasterDuration(variable, duration) {
        variable.dataBinding.duration = duration;
        return variable.dataBinding.duration;
    }
    getToasterClass(variable) {
        return variable.dataBinding.class;
    }
    setToasterClass(variable, type) {
        if (_.isString(type)) {
            variable.dataBinding.class = type;
        }
        return variable.dataBinding.class;
    }
    getToasterPosition(variable) {
        return variable.dataBinding.class;
    }
    setToasterPosition(variable, position) {
        if (_.isString(position)) {
            variable.dataBinding.position = position;
        }
        return variable.dataBinding.position;
    }
    getAlertType(variable) {
        return variable.dataBinding.alerttype;
    }
    setAlertType(variable, alerttype) {
        if (_.isString(alerttype)) {
            variable.dataBinding.alerttype = alerttype;
        }
        return variable.dataBinding.alerttype;
    }
    getCancelButtonText(variable) {
        return variable.dataBinding.cancelButtonText;
    }
    setCancelButtonText(variable, text) {
        if (_.isString(text)) {
            variable.dataBinding.cancelButtonText = text;
        }
        return variable.dataBinding.cancelButtonText;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLWFjdGlvbi5tYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHdtL3ZhcmlhYmxlcy8iLCJzb3VyY2VzIjpbIm1hbmFnZXIvYWN0aW9uL25vdGlmaWNhdGlvbi1hY3Rpb24ubWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUN6RSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBSXRHLE1BQU0sT0FBTyx5QkFBMEIsU0FBUSxpQkFBaUI7SUFFcEQsY0FBYyxDQUFDLFFBQVE7UUFDM0IsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRU8sYUFBYSxDQUFDLFFBQVE7UUFDMUIsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRU8sZ0JBQWdCLENBQUMsUUFBUSxFQUFFLE9BQU87UUFDdEMsTUFBTSxJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsS0FBSyxJQUFJLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUM5RSxJQUFJLEdBQUcsT0FBTyxDQUFDLE9BQU8sSUFBSSxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksRUFDbkQsS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLEVBQ3JCLGFBQWEsR0FBRyxRQUFRLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsZUFBZSxJQUFJLGNBQWMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQ3pILFdBQVcsR0FBRyxRQUFR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QUFFO1lBQ3RCLFFBQVEsQ0FBQyxXQUFXLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztTQUM1QztRQUNELE9BQU8sUUFBUSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUM7SUFDekMsQ0FBQztJQUVELFlBQVksQ0FBQyxRQUFRO1FBQ2pCLE9BQU8sUUFBUSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUM7SUFDMUMsQ0FBQztJQUVELFlBQVksQ0FBQyxRQUFRLEVBQUUsU0FBUztRQUM1QixJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQUU7WUFDdkIsUUFBUSxDQUFDLFdBQVcsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1NBQzlDO1FBQ0QsT0FBTyxRQUFRLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQztJQUMxQyxDQUFDO0lBRUQsbUJBQW1CLENBQUMsUUFBUTtRQUN4QixPQUFPLFFBQVEsQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUM7SUFDakQsQ0FBQztJQUVELG1CQUFtQixDQUFDLFFBQVEsRUFBRSxJQUFJO1FBQzlCLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUNsQixRQUFRLENBQUMsV0FBVyxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQztTQUNoRDtRQUNELE9BQU8sUUFBUSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQztJQUNqRCxDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlQWN0aW9uTWFuYWdlciB9IGZyb20gJy4vYmFzZS1hY3Rpb24ubWFuYWdlcic7XG5pbXBvcnQgeyBWQVJJQUJMRV9DT05TVEFOVFMgfSBmcm9tICcuLi8uLi9jb25zdGFudHMvdmFyaWFibGVzLmNvbnN0YW50cyc7XG5pbXBvcnQgeyBpbml0aWF0ZUNhbGxiYWNrLCB0b2FzdGVyU2VydmljZSwgZGlhbG9nU2VydmljZSB9IGZyb20gJy4uLy4uL3V0aWwvdmFyaWFibGUvdmFyaWFibGVzLnV0aWxzJztcblxuZGVjbGFyZSBjb25zdCBfO1xuXG5leHBvcnQgY2xhc3MgTm90aWZpY2F0aW9uQWN0aW9uTWFuYWdlciBleHRlbmRzIEJhc2VBY3Rpb25NYW5hZ2VyIHtcblxuICAgIHByaXZhdGUgb25Ub2FzdGVyQ2xpY2sodmFyaWFibGUpIHtcbiAgICAgICAgaW5pdGlhdGVDYWxsYmFjaygnb25DbGljaycsIHZhcmlhYmxlLCAnJyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblRvYXN0ZXJIaWRlKHZhcmlhYmxlKSB7XG4gICAgICAgIGluaXRpYXRlQ2FsbGJhY2soJ29uSGlkZScsIHZhcmlhYmxlLCAnJyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBub3RpZnlWaWFUb2FzdGVyKHZhcmlhYmxlLCBvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHR5cGUgPSAob3B0aW9ucy5jbGFzcyB8fCB2YXJpYWJsZS5kYXRhQmluZGluZy5jbGFzcyB8fCAnaW5mbycpLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICBib2R5ID0gb3B0aW9ucy5tZXNzYWdlIHx8IHZhcmlhYmxlLmRhdGFCaW5kaW5nLnRleHQsXG4gICAgICAgICAgICB0aXRsZSA9IG9wdGlvbnMudGl0bGUsXG4gICAgICAgICAgICBwb3NpdGlvbkNsYXNzID0gJ3RvYXN0LScgKyAob3B0aW9ucy5wb3NpdGlvbiB8fCB2YXJpYWJsZS5kYXRhQmluZGluZy50b2FzdGVyUG9zaXRpb24gfHwgJ2JvdHRvbSByaWdodCcpLnJlcGxhY2UoJyAnLCAnLScpLFxuICAgICAgICAgICAgcGFydGlhbFBhZ2UgPSB2YXJpYWJsZS5kYXRhQmluZGluZy5wYWdlLFxuICAgICAgICAgICAgREVGQVVMVF9EVVJBVElPTiA9IDMwMDA7XG4gICAgICAgIGxldCBkdXJhdGlvbiA9IHBhcnNlSW50KHZhcmlhYmxlLmRhdGFCaW5kaW5nLmR1cmF0aW9uIHx8IG9wdGlvbnMuZHVyYXRpb24sIG51bGwpLFxuICAgICAgICAgICAgdG9hc3RlcjtcblxuICAgICAgICAvLyBkdXJhdGlvblxuICAgICAgICBpZiAoIWR1cmF0aW9uKSB7XG4gICAgICAgICAgICBkdXJhdGlvbiA9IChkdXJhdGlvbiAhPT0gMCAmJiB0eXBlID09PSAnc3VjY2VzcycpID8gREVGQVVMVF9EVVJBVElPTiA6IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhcmlhYmxlLmRhdGFCaW5kaW5nLmNvbnRlbnQgJiYgdmFyaWFibGUuZGF0YUJpbmRpbmcuY29udGVudCA9PT0gJ3BhZ2UnICYmIHBhcnRpYWxQYWdlKSB7XG4gICAgICAgICAgICB0b2FzdGVyID0gdG9hc3RlclNlcnZpY2Uuc2hvd0N1c3RvbShwYXJ0aWFsUGFnZSwge3Bvc2l0aW9uQ2xhc3M6IHBvc2l0aW9uQ2xhc3MsIHRpbWVPdXQ6IGR1cmF0aW9uLFxuICAgICAgICAgICAgICAgIHBhcnRpYWxQYXJhbXM6IHZhcmlhYmxlLl9iaW5kZGF0YVNldCwgY29udGV4dDogdmFyaWFibGUuX2NvbnRleHR9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRvYXN0ZXIgPSB0b2FzdGVyU2VydmljZS5zaG93KHR5cGUsIHRpdGxlLCBib2R5IHx8IG51bGwsIHtwb3NpdGlvbkNsYXNzOiBwb3NpdGlvbkNsYXNzLCB0aW1lT3V0OiBkdXJhdGlvbiwgZW5hYmxlSHRtbDogdHJ1ZX0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2FsbGJhY2tzXG4gICAgICAgIGlmICh2YXJpYWJsZS5vbkNsaWNrKSB7XG4gICAgICAgICAgICB0b2FzdGVyLm9uVGFwLnN1YnNjcmliZSggdGhpcy5vblRvYXN0ZXJDbGljay5iaW5kKHRoaXMsIHZhcmlhYmxlKSApO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YXJpYWJsZS5vbkhpZGUpIHtcbiAgICAgICAgICAgIHRvYXN0ZXIub25IaWRkZW4uc3Vic2NyaWJlKCB0aGlzLm9uVG9hc3RlckhpZGUuYmluZCh0aGlzLCB2YXJpYWJsZSkgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgbm90aWZ5VmlhRGlhbG9nKHZhcmlhYmxlLCBvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IGNvbW1vblBhZ2VEaWFsb2dJZCA9ICdDb21tb24nICsgXy5jYXBpdGFsaXplKHZhcmlhYmxlLm9wZXJhdGlvbikgKyAnRGlhbG9nJyxcbiAgICAgICAgICAgIHZhcmlhYmxlT3duZXIgPSB2YXJpYWJsZS5vd25lcixcbiAgICAgICAgICAgIGRpYWxvZ0lkID0gKHZhcmlhYmxlT3duZXIgPT09IFZBUklBQkxFX0NPTlNUQU5UUy5PV05FUi5BUFAgKSA/IGNvbW1vblBhZ2VEaWFsb2dJZCA6ICdub3RpZmljYXRpb24nICsgdmFyaWFibGUub3BlcmF0aW9uICsgJ2RpYWxvZyc7XG4gICAgICAgIGRpYWxvZ1NlcnZpY2Uub3BlbihkaWFsb2dJZCwgIHZhcmlhYmxlLl9jb250ZXh0LCB7XG4gICAgICAgICAgICBub3RpZmljYXRpb246IHtcbiAgICAgICAgICAgICAgICAndGl0bGUnIDogb3B0aW9ucy50aXRsZSB8fCB2YXJpYWJsZS5kYXRhQmluZGluZy50aXRsZSxcbiAgICAgICAgICAgICAgICAndGV4dCcgOiBvcHRpb25zLm1lc3NhZ2UgfHwgdmFyaWFibGUuZGF0YUJpbmRpbmcudGV4dCxcbiAgICAgICAgICAgICAgICAnb2tCdXR0b25UZXh0JyA6IG9wdGlvbnMub2tCdXR0b25UZXh0IHx8IHZhcmlhYmxlLmRhdGFCaW5kaW5nLm9rQnV0dG9uVGV4dCB8fCAnT0snLFxuICAgICAgICAgICAgICAgICdjYW5jZWxCdXR0b25UZXh0JyA6IG9wdGlvbnMuY2FuY2VsQnV0dG9uVGV4dCB8fCB2YXJpYWJsZS5kYXRhQmluZGluZy5jYW5jZWxCdXR0b25UZXh0IHx8ICdDQU5DRUwnLFxuICAgICAgICAgICAgICAgICdhbGVydHR5cGUnIDogb3B0aW9ucy5hbGVydHR5cGUgfHwgdmFyaWFibGUuZGF0YUJpbmRpbmcuYWxlcnR0eXBlIHx8ICdpbmZvcm1hdGlvbicsXG4gICAgICAgICAgICAgICAgb25PazogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWF0ZUNhbGxiYWNrKCdvbk9rJywgdmFyaWFibGUsIG9wdGlvbnMuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIENsb3NlIHRoZSBhY3Rpb24gZGlhbG9nIGFmdGVyIHRyaWdnZXJpbmcgb25PayBjYWxsYmFjayBldmVudFxuICAgICAgICAgICAgICAgICAgICBkaWFsb2dTZXJ2aWNlLmNsb3NlKGRpYWxvZ0lkLCB2YXJpYWJsZS5fY29udGV4dCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvbkNhbmNlbDogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpbml0aWF0ZUNhbGxiYWNrKCdvbkNhbmNlbCcsIHZhcmlhYmxlLCBvcHRpb25zLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAvLyBDbG9zZSB0aGUgYWN0aW9uIGRpYWxvZyBhZnRlciB0cmlnZ2VyaW5nIG9uQ2FuY2VsIGNhbGxiYWNrIGV2ZW50XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ1NlcnZpY2UuY2xvc2UoZGlhbG9nSWQsIHZhcmlhYmxlLl9jb250ZXh0KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uQ2xvc2U6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhdGVDYWxsYmFjaygnb25DbG9zZScsIHZhcmlhYmxlLCBvcHRpb25zLmRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4vLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBQVUJMSUMgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovL1xuXG4gICAgbm90aWZ5KHZhcmlhYmxlLCBvcHRpb25zLCBzdWNjZXNzLCBlcnJvcikge1xuICAgICAgICBjb25zdCBvcGVyYXRpb24gPSB2YXJpYWJsZS5vcGVyYXRpb247XG4gICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgICAgIGlmIChvcGVyYXRpb24gPT09ICd0b2FzdCcpIHtcbiAgICAgICAgICAgIHRoaXMubm90aWZ5VmlhVG9hc3Rlcih2YXJpYWJsZSwgb3B0aW9ucyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm5vdGlmeVZpYURpYWxvZyh2YXJpYWJsZSwgb3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRNZXNzYWdlKHZhcmlhYmxlKSB7XG4gICAgICAgIHJldHVybiB2YXJpYWJsZS5kYXRhQmluZGluZy50ZXh0O1xuICAgIH1cblxuICAgIHNldE1lc3NhZ2UodmFyaWFibGUsIHRleHQpIHtcbiAgICAgICAgaWYgKF8uaXNTdHJpbmcodGV4dCkpIHtcbiAgICAgICAgICAgIHZhcmlhYmxlLmRhdGFCaW5kaW5nLnRleHQgPSB0ZXh0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YXJpYWJsZS5kYXRhQmluZGluZy50ZXh0O1xuICAgIH1cblxuICAgIGdldE9rQnV0dG9uVGV4dCh2YXJpYWJsZSkge1xuICAgICAgICByZXR1cm4gdmFyaWFibGUuZGF0YUJpbmRpbmcub2tCdXR0b25UZXh0O1xuICAgIH1cbiAgICBzZXRPa0J1dHRvblRleHQodmFyaWFibGUsIHRleHQpIHtcbiAgICAgICAgaWYgKF8uaXNTdHJpbmcodGV4dCkpIHtcbiAgICAgICAgICAgIHZhcmlhYmxlLmRhdGFCaW5kaW5nLm9rQnV0dG9uVGV4dCA9IHRleHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhcmlhYmxlLmRhdGFCaW5kaW5nLm9rQnV0dG9uVGV4dDtcbiAgICB9XG5cbiAgICBnZXRUb2FzdGVyRHVyYXRpb24odmFyaWFibGUpIHtcbiAgICAgICAgcmV0dXJuIHZhcmlhYmxlLmRhdGFCaW5kaW5nLmR1cmF0aW9uO1xuICAgIH1cblxuICAgIHNldFRvYXN0ZXJEdXJhdGlvbih2YXJpYWJsZSwgZHVyYXRpb24pIHtcbiAgICAgICAgdmFyaWFibGUuZGF0YUJpbmRpbmcuZHVyYXRpb24gPSBkdXJhdGlvbjtcbiAgICAgICAgcmV0dXJuIHZhcmlhYmxlLmRhdGFCaW5kaW5nLmR1cmF0aW9uO1xuICAgIH1cblxuICAgIGdldFRvYXN0ZXJDbGFzcyh2YXJpYWJsZSkge1xuICAgICAgICByZXR1cm4gdmFyaWFibGUuZGF0YUJpbmRpbmcuY2xhc3M7XG4gICAgfVxuXG4gICAgc2V0VG9hc3RlckNsYXNzKHZhcmlhYmxlLCB0eXBlKSB7XG4gICAgICAgIGlmIChfLmlzU3RyaW5nKHR5cGUpKSB7XG4gICAgICAgICAgICB2YXJpYWJsZS5kYXRhQmluZGluZy5jbGFzcyA9IHR5cGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhcmlhYmxlLmRhdGFCaW5kaW5nLmNsYXNzO1xuICAgIH1cblxuICAgIGdldFRvYXN0ZXJQb3NpdGlvbih2YXJpYWJsZSkge1xuICAgICAgICByZXR1cm4gdmFyaWFibGUuZGF0YUJpbmRpbmcuY2xhc3M7XG4gICAgfVxuXG4gICAgc2V0VG9hc3RlclBvc2l0aW9uKHZhcmlhYmxlLCBwb3NpdGlvbikge1xuICAgICAgICBpZiAoXy5pc1N0cmluZyhwb3NpdGlvbikpIHtcbiAgICAgICAgICAgIHZhcmlhYmxlLmRhdGFCaW5kaW5nLnBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhcmlhYmxlLmRhdGFCaW5kaW5nLnBvc2l0aW9uO1xuICAgIH1cblxuICAgIGdldEFsZXJ0VHlwZSh2YXJpYWJsZSkge1xuICAgICAgICByZXR1cm4gdmFyaWFibGUuZGF0YUJpbmRpbmcuYWxlcnR0eXBlO1xuICAgIH1cblxuICAgIHNldEFsZXJ0VHlwZSh2YXJpYWJsZSwgYWxlcnR0eXBlKSB7XG4gICAgICAgIGlmIChfLmlzU3RyaW5nKGFsZXJ0dHlwZSkpIHtcbiAgICAgICAgICAgIHZhcmlhYmxlLmRhdGFCaW5kaW5nLmFsZXJ0dHlwZSA9IGFsZXJ0dHlwZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFyaWFibGUuZGF0YUJpbmRpbmcuYWxlcnR0eXBlO1xuICAgIH1cblxuICAgIGdldENhbmNlbEJ1dHRvblRleHQodmFyaWFibGUpIHtcbiAgICAgICAgcmV0dXJuIHZhcmlhYmxlLmRhdGFCaW5kaW5nLmNhbmNlbEJ1dHRvblRleHQ7XG4gICAgfVxuXG4gICAgc2V0Q2FuY2VsQnV0dG9uVGV4dCh2YXJpYWJsZSwgdGV4dCkge1xuICAgICAgICBpZiAoXy5pc1N0cmluZyh0ZXh0KSkge1xuICAgICAgICAgICAgdmFyaWFibGUuZGF0YUJpbmRpbmcuY2FuY2VsQnV0dG9uVGV4dCA9IHRleHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhcmlhYmxlLmRhdGFCaW5kaW5nLmNhbmNlbEJ1dHRvblRleHQ7XG4gICAgfVxufVxuIl19