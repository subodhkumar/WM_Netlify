import { isNumberType, FormWidgetType, DataType, isMobileApp, isAndroid } from '@wm/core';
const VIEW_MODE_OPTIONS = {
    DEFAULT: 'default',
    LABEL: 'label'
};
export const EDIT_MODE = {
    QUICK_EDIT: 'quickedit',
    INLINE: 'inline',
    FORM: 'form',
    DIALOG: 'dialog'
};
// Method to set the header config of the data table
export const setHeaderConfig = (headerConfig, config, field) => {
    _.forEach(headerConfig, cols => {
        if (cols.isGroup) {
            if (cols.field === field) {
                cols.columns.push(config);
            }
            else {
                setHeaderConfig(cols.columns, config, field);
            }
        }
    });
};
export const setHeaderConfigForTable = (headerConfig, config, fieldName) => {
    if (fieldName) {
        setHeaderConfig(headerConfig, config, fieldName);
    }
    else {
        headerConfig.push(config);
    }
};
export const getRowOperationsColumn = () => {
    return {
        'field': 'rowOperations',
        'type': 'custom',
        'displayName': 'Actions',
        'width': '120px',
        'readonly': true,
        'sortable': false,
        'searchable': false,
        'resizable': false,
        'selectable': false,
        'show': true,
        'operations': [],
        'opConfig': {},
        'pcDisplay': true,
        'mobileDisplay': true,
        'include': true,
        'isRowOperation': true
    };
};
/**
 * Returns caption and widget bootstrap classes for the field
 */
export const getFieldLayoutConfig = (captionWidth, captionPosition, os) => {
    let captionCls = '', widgetCls = '';
    captionPosition = captionPosition || 'top';
    if (captionPosition === 'top') {
        if ((os && os === 'android') || !isMobileApp() || isAndroid()) { // Is android or not a mobile application
            captionCls = widgetCls = 'col-xs-12';
        }
        else if (isMobileApp()) { // Is a mobile application and not android
            captionCls = 'col-xs-4';
            widgetCls = 'col-xs-8';
        }
    }
    else if (captionWidth) {
        // handling itemsperrow containing string of classes
        _.forEach(_.split(captionWidth, ' '), function (cls) {
            const keys = _.split(cls, '-'), tier = keys[0];
            let _captionWidth, widgetWidth;
            _captionWidth = parseInt(keys[1], 10);
            widgetWidth = 12 - _captionWidth;
            widgetWidth = widgetWidth <= 0 ? 12 : widgetWidth;
            captionCls += ' ' + 'col-' + tier + '-' + _captionWidth;
            widgetCls += ' ' + 'col-' + tier + '-' + widgetWidth;
        });
    }
    return {
        'captionCls': captionCls,
        'widgetCls': widgetCls
    };
};
export const getDefaultViewModeWidget = widget => {
    if (_.includes(['checkbox', 'toggle', 'rating'], widget)) {
        return VIEW_MODE_OPTIONS.DEFAULT;
    }
    return VIEW_MODE_OPTIONS.LABEL;
};
const parseBooleanValue = value => {
    if (value === 'true') {
        return true;
    }
    if (value === 'false') {
        return false;
    }
    if (/^\d+$/.test(value)) { // Check if the value is a string of number type like '123'
        return +value;
    }
    return value;
};
const ɵ0 = parseBooleanValue;
export const parseValueByType = (value, type, widget) => {
    if (widget) {
        if (widget === FormWidgetType.NUMBER || widget === FormWidgetType.SLIDER || widget === FormWidgetType.CURRENCY) {
            return isNaN(Number(value)) ? null : Number(value);
        }
        if (widget === FormWidgetType.CHECKBOX || widget === FormWidgetType.TOGGLE) {
            return parseBooleanValue(value);
        }
        return value;
    }
    if (isNumberType(type)) {
        return isNaN(Number(value)) ? null : Number(value);
    }
    if (type === DataType.BOOLEAN) {
        return parseBooleanValue(value);
    }
    return value;
};
const fieldTypeWidgetTypeMap = {
    'integer': ['number', 'text', 'select', 'checkboxset', 'radioset', 'rating', 'slider', 'currency', 'autocomplete', 'chips'],
    'big_integer': ['number', 'text', 'select', 'checkboxset', 'radioset', 'rating', 'slider', 'currency', 'autocomplete', 'chips'],
    'short': ['number', 'text', 'select', 'checkboxset', 'radioset', 'slider', 'currency', 'autocomplete', 'chips'],
    'float': ['number', 'text', 'select', 'checkboxset', 'radioset', 'slider', 'currency', 'autocomplete', 'chips'],
    'big_decimal': ['number', 'text', 'select', 'checkboxset', 'radioset', 'slider', 'currency', 'autocomplete', 'chips'],
    'number': ['number', 'text', 'select', 'checkboxset', 'radioset', 'slider', 'currency', 'autocomplete', 'chips'],
    'double': ['number', 'text', 'select', 'checkboxset', 'radioset', 'slider', 'currency', 'autocomplete', 'chips'],
    'long': ['number', 'text', 'select', 'checkboxset', 'radioset', 'rating', 'slider', 'currency', 'autocomplete', 'chips'],
    'byte': ['number', 'text', 'select', 'checkboxset', 'radioset', 'slider', 'currency', 'autocomplete', 'chips'],
    'string': ['text', 'number', 'textarea', 'password', 'richtext', 'select', 'checkboxset', 'radioset', 'date', 'time', 'timestamp', 'switch', 'currency', 'autocomplete', 'chips', 'colorpicker'],
    'character': ['text', 'number', 'textarea', 'password', 'richtext', 'select', 'checkboxset', 'radioset', 'switch', 'currency', 'autocomplete', 'chips'],
    'text': ['text', 'number', 'textarea', 'password', 'richtext', 'select', 'checkboxset', 'radioset', 'date', 'time', 'timestamp', 'switch', 'currency', 'autocomplete', 'chips', 'colorpicker'],
    'date': ['date', 'text', 'number', 'select', 'checkboxset', 'radioset', 'autocomplete', 'chips'],
    'time': ['time', 'text', 'number', 'select', 'checkboxset', 'radioset', 'autocomplete', 'chips'],
    'timestamp': ['timestamp', 'text', 'number', 'select', 'checkboxset', 'radioset', 'autocomplete', 'chips'],
    'datetime': ['datetime', 'text', 'select', 'checkboxset', 'radioset', 'autocomplete', 'chips'],
    'boolean': ['checkbox', 'radioset', 'toggle', 'select'],
    'list': ['select', 'radioset', 'checkboxset', 'switch', 'autocomplete', 'chips'],
    'clob': ['text', 'textarea', 'richtext'],
    'blob': ['upload'],
    'file': ['upload'],
    'custom': ['text', 'number', 'textarea', 'password', 'checkbox', 'toggle', 'slider', 'richtext', 'currency', 'switch',
        'select', 'checkboxset', 'radioset', 'date', 'time', 'timestamp', 'rating', 'datetime', 'autocomplete', 'chips', 'colorpicker']
};
// Get widgets applicable to the given type
export const getFieldTypeWidgetTypesMap = () => {
    return fieldTypeWidgetTypeMap;
};
// Get filter widget applicable to the given type
export const getDataTableFilterWidget = type => {
    let widget = fieldTypeWidgetTypeMap[type] && fieldTypeWidgetTypeMap[type][0];
    if (type === DataType.BOOLEAN) {
        widget = FormWidgetType.SELECT;
    }
    if (_.includes([FormWidgetType.TEXT, FormWidgetType.NUMBER, FormWidgetType.SELECT, FormWidgetType.AUTOCOMPLETE,
        FormWidgetType.DATE, FormWidgetType.TIME, FormWidgetType.DATETIME], widget)) {
        return widget;
    }
    return FormWidgetType.TEXT;
};
/**
 * @ngdoc function
 * @name wm.widgets.live.getEditModeWidget
 * @methodOf wm.widgets.live.LiveWidgetUtils
 * @function
 *
 * @description
 * This function returns the default widget for grid
 *
 * @param {object} colDef field definition
 */
export const getEditModeWidget = colDef => {
    if (colDef['related-entity-name'] && colDef['primary-key']) {
        return FormWidgetType.SELECT;
    }
    return (fieldTypeWidgetTypeMap[colDef.type] && fieldTypeWidgetTypeMap[colDef.type][0]) || FormWidgetType.TEXT;
};
/**
 * @ngdoc function
 * @name wm.widgets.live.LiveWidgetUtils#getDefaultValue
 * @methodOf wm.widgets.live.LiveWidgetUtils
 * @function
 *
 * @description
 * return the formatted default value
 *
 * @param {string} value value to be formatted
 * @param {string} type column type of the value
 */
export const getDefaultValue = (value, type, widget) => {
    if (widget) {
        if (widget === FormWidgetType.NUMBER || widget === FormWidgetType.SLIDER || widget === FormWidgetType.CURRENCY) {
            return isNaN(Number(value)) ? null : Number(value);
        }
        if (widget === FormWidgetType.CHECKBOX || widget === FormWidgetType.TOGGLE) {
            return parseBooleanValue(value);
        }
        return value;
    }
    if (isNumberType(type)) {
        return isNaN(Number(value)) ? null : Number(value);
    }
    if (type === DataType.BOOLEAN) {
        return parseBooleanValue(value);
    }
    return value;
};
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS11dGlscy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B3bS9jb21wb25lbnRzLyIsInNvdXJjZXMiOlsidXRpbHMvbGl2ZS11dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLGNBQWMsRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUkxRixNQUFPLGlCQUFpQixHQUFHO0lBQ3ZCLE9BQU8sRUFBRyxTQUFTO0lBQ25CLEtBQUssRUFBRyxPQUFPO0NBQ2xCLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxTQUFTLEdBQUc7SUFDckIsVUFBVSxFQUFHLFdBQVc7SUFDeEIsTUFBTSxFQUFHLFFBQVE7SUFDakIsSUFBSSxFQUFHLE1BQU07SUFDYixNQUFNLEVBQUcsUUFBUTtDQUNwQixDQUFDO0FBRUYsb0RBQW9EO0FBQ3BELE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBRyxDQUFDLFlBQVksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFRLEVBQUU7SUFDakUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUU7UUFDM0IsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2QsSUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLEtBQUssRUFBRTtnQkFDdEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDN0I7aUJBQU07Z0JBQ0gsZUFBZSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQ2hEO1NBQ0o7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxNQUFNLHVCQUF1QixHQUFHLENBQUMsWUFBWSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQVEsRUFBRTtJQUM3RSxJQUFJLFNBQVMsRUFBRTtRQUNYLGVBQWUsQ0FBQyxZQUFZLEVB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TUFBTSxLQUFLLGNBQWMsQ0FBQyxNQUFNLElBQUksTUFBTSxLQUFLLGNBQWMsQ0FBQyxNQUFNLElBQUksTUFBTSxLQUFLLGNBQWMsQ0FBQyxRQUFRLEVBQUU7WUFDNUcsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3REO1FBQ0QsSUFBSSxNQUFNLEtBQUssY0FBYyxDQUFDLFFBQVEsSUFBSSxNQUFNLEtBQUssY0FBYyxDQUFDLE1BQU0sRUFBRTtZQUN4RSxPQUFPLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ25DO1FBQ0QsT0FBTyxLQUFLLENBQUM7S0FDaEI7SUFDRCxJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUNwQixPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDdEQ7SUFDRCxJQUFJLElBQUksS0FBSyxRQUFRLENBQUMsT0FBTyxFQUFFO1FBQzNCLE9BQU8saUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDbkM7SUFDRCxPQUFPLEtBQUssQ0FBQztBQUNqQixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc051bWJlclR5cGUsIEZvcm1XaWRnZXRUeXBlLCBEYXRhVHlwZSwgaXNNb2JpbGVBcHAsIGlzQW5kcm9pZCB9IGZyb20gJ0B3bS9jb3JlJztcblxuZGVjbGFyZSBjb25zdCBfO1xuXG5jb25zdCAgVklFV19NT0RFX09QVElPTlMgPSB7XG4gICAgREVGQVVMVCA6ICdkZWZhdWx0JyxcbiAgICBMQUJFTCA6ICdsYWJlbCdcbn07XG5cbmV4cG9ydCBjb25zdCBFRElUX01PREUgPSB7XG4gICAgUVVJQ0tfRURJVCA6ICdxdWlja2VkaXQnLFxuICAgIElOTElORSA6ICdpbmxpbmUnLFxuICAgIEZPUk0gOiAnZm9ybScsXG4gICAgRElBTE9HIDogJ2RpYWxvZydcbn07XG5cbi8vIE1ldGhvZCB0byBzZXQgdGhlIGhlYWRlciBjb25maWcgb2YgdGhlIGRhdGEgdGFibGVcbmV4cG9ydCBjb25zdCBzZXRIZWFkZXJDb25maWcgPSAoaGVhZGVyQ29uZmlnLCBjb25maWcsIGZpZWxkKTogdm9pZCA9PiB7XG4gICAgXy5mb3JFYWNoKGhlYWRlckNvbmZpZywgY29scyA9PiB7XG4gICAgICAgIGlmIChjb2xzLmlzR3JvdXApIHtcbiAgICAgICAgICAgIGlmIChjb2xzLmZpZWxkID09PSBmaWVsZCkge1xuICAgICAgICAgICAgICAgIGNvbHMuY29sdW1ucy5wdXNoKGNvbmZpZyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNldEhlYWRlckNvbmZpZyhjb2xzLmNvbHVtbnMsIGNvbmZpZywgZmllbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59O1xuXG5leHBvcnQgY29uc3Qgc2V0SGVhZGVyQ29uZmlnRm9yVGFibGUgPSAoaGVhZGVyQ29uZmlnLCBjb25maWcsIGZpZWxkTmFtZSk6IHZvaWQgPT4ge1xuICAgIGlmIChmaWVsZE5hbWUpIHtcbiAgICAgICAgc2V0SGVhZGVyQ29uZmlnKGhlYWRlckNvbmZpZywgY29uZmlnLCBmaWVsZE5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGhlYWRlckNvbmZpZy5wdXNoKGNvbmZpZyk7XG4gICAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGdldFJvd09wZXJhdGlvbnNDb2x1bW4gPSAoKTogYW55ID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgICAnZmllbGQnICAgICAgICAgOiAncm93T3BlcmF0aW9ucycsXG4gICAgICAgICd0eXBlJyAgICAgICAgICA6ICdjdXN0b20nLFxuICAgICAgICAnZGlzcGxheU5hbWUnICAgOiAnQWN0aW9ucycsXG4gICAgICAgICd3aWR0aCcgICAgICAgICA6ICcxMjBweCcsXG4gICAgICAgICdyZWFkb25seScgICAgICA6IHRydWUsXG4gICAgICAgICdzb3J0YWJsZScgICAgICA6IGZhbHNlLFxuICAgICAgICAnc2VhcmNoYWJsZScgICAgOiBmYWxzZSxcbiAgICAgICAgJ3Jlc2l6YWJsZScgICAgIDogZmFsc2UsXG4gICAgICAgICdzZWxlY3RhYmxlJyAgICA6IGZhbHNlLFxuICAgICAgICAnc2hvdycgICAgICAgICAgOiB0cnVlLFxuICAgICAgICAnb3BlcmF0aW9ucycgICAgOiBbXSxcbiAgICAgICAgJ29wQ29uZmlnJyAgICAgIDoge30sXG4gICAgICAgICdwY0Rpc3BsYXknICAgICA6IHRydWUsXG4gICAgICAgICdtb2JpbGVEaXNwbGF5JyA6IHRydWUsXG4gICAgICAgICdpbmNsdWRlJyAgICAgICA6IHRydWUsXG4gICAgICAgICdpc1Jvd09wZXJhdGlvbic6IHRydWVcbiAgICB9O1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIGNhcHRpb24gYW5kIHdpZGdldCBib290c3RyYXAgY2xhc3NlcyBmb3IgdGhlIGZpZWxkXG4gKi9cbmV4cG9ydCBjb25zdCBnZXRGaWVsZExheW91dENvbmZpZyA9IChjYXB0aW9uV2lkdGgsIGNhcHRpb25Qb3NpdGlvbiwgb3MpOiBhbnkgPT4ge1xuICAgIGxldCBjYXB0aW9uQ2xzID0gJycsXG4gICAgICAgIHdpZGdldENscyA9ICcnO1xuXG4gICAgY2FwdGlvblBvc2l0aW9uID0gY2FwdGlvblBvc2l0aW9uIHx8ICd0b3AnO1xuXG4gICAgaWYgKGNhcHRpb25Qb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgICAgaWYgKChvcyAmJiBvcyA9PT0gJ2FuZHJvaWQnKSB8fCAhaXNNb2JpbGVBcHAoKSB8fCBpc0FuZHJvaWQoKSkgeyAvLyBJcyBhbmRyb2lkIG9yIG5vdCBhIG1vYmlsZSBhcHBsaWNhdGlvblxuICAgICAgICAgICAgY2FwdGlvbkNscyA9IHdpZGdldENscyA9ICdjb2wteHMtMTInO1xuICAgICAgICB9IGVsc2UgaWYgKGlzTW9iaWxlQXBwKCkpIHsgLy8gSXMgYSBtb2JpbGUgYXBwbGljYXRpb24gYW5kIG5vdCBhbmRyb2lkXG4gICAgICAgICAgICBjYXB0aW9uQ2xzID0gJ2NvbC14cy00JztcbiAgICAgICAgICAgIHdpZGdldENscyA9ICdjb2wteHMtOCc7XG4gICAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGNhcHRpb25XaWR0aCkge1xuICAgICAgICAvLyBoYW5kbGluZyBpdGVtc3BlcnJvdyBjb250YWluaW5nIHN0cmluZyBvZiBjbGFzc2VzXG4gICAgICAgIF8uZm9yRWFjaChfLnNwbGl0KGNhcHRpb25XaWR0aCwgJyAnKSwgZnVuY3Rpb24gKGNscykge1xuICAgICAgICAgICAgY29uc3Qga2V5cyA9IF8uc3BsaXQoY2xzLCAnLScpLFxuICAgICAgICAgICAgICAgIHRpZXIgPSBrZXlzWzBdO1xuICAgICAgICAgICAgbGV0IF9jYXB0aW9uV2lkdGgsXG4gICAgICAgICAgICAgICAgd2lkZ2V0V2lkdGg7XG4gICAgICAgICAgICBfY2FwdGlvbldpZHRoID0gcGFyc2VJbnQoa2V5c1sxXSwgMTApO1xuICAgICAgICAgICAgd2lkZ2V0V2lkdGggID0gMTIgLSBfY2FwdGlvbldpZHRoO1xuICAgICAgICAgICAgd2lkZ2V0V2lkdGggID0gd2lkZ2V0V2lkdGggPD0gMCA/IDEyIDogd2lkZ2V0V2lkdGg7XG4gICAgICAgICAgICBjYXB0aW9uQ2xzICs9ICcgJyArICdjb2wtJyArIHRpZXIgKyAnLScgKyBfY2FwdGlvbldpZHRoO1xuICAgICAgICAgICAgd2lkZ2V0Q2xzICArPSAnICcgKyAnY29sLScgKyB0aWVyICsgJy0nICsgd2lkZ2V0V2lkdGg7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICAnY2FwdGlvbkNscycgOiBjYXB0aW9uQ2xzLFxuICAgICAgICAnd2lkZ2V0Q2xzJyAgOiB3aWRnZXRDbHNcbiAgICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IGdldERlZmF1bHRWaWV3TW9kZVdpZGdldCA9IHdpZGdldCA9PiB7XG4gICAgaWYgKF8uaW5jbHVkZXMoWydjaGVja2JveCcsICd0b2dnbGUnLCAncmF0aW5nJ10sIHdpZGdldCkpIHtcbiAgICAgICAgcmV0dXJuIFZJRVdfTU9ERV9PUFRJT05TLkRFRkFVTFQ7XG4gICAgfVxuICAgIHJldHVybiBWSUVXX01PREVfT1BUSU9OUy5MQUJFTDtcbn07XG5cbmNvbnN0IHBhcnNlQm9vbGVhblZhbHVlID0gdmFsdWUgPT4ge1xuICAgIGlmICh2YWx1ZSA9PT0gJ3RydWUnKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAodmFsdWUgPT09ICdmYWxzZScpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoL15cXGQrJC8udGVzdCh2YWx1ZSkpIHsgLy8gQ2hlY2sgaWYgdGhlIHZhbHVlIGlzIGEgc3RyaW5nIG9mIG51bWJlciB0eXBlIGxpa2UgJzEyMydcbiAgICAgICAgcmV0dXJuICt2YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xufTtcblxuZXhwb3J0IGNvbnN0IHBhcnNlVmFsdWVCeVR5cGUgPSAodmFsdWUsIHR5cGUsIHdpZGdldCkgPT4ge1xuICAgIGlmICh3aWRnZXQpIHtcbiAgICAgICAgaWYgKHdpZGdldCA9PT0gRm9ybVdpZGdldFR5cGUuTlVNQkVSIHx8IHdpZGdldCA9PT0gRm9ybVdpZGdldFR5cGUuU0xJREVSIHx8IHdpZGdldCA9PT0gRm9ybVdpZGdldFR5cGUuQ1VSUkVOQ1kpIHtcbiAgICAgICAgICAgIHJldHVybiBpc05hTihOdW1iZXIodmFsdWUpKSA/IG51bGwgOiBOdW1iZXIodmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh3aWRnZXQgPT09IEZvcm1XaWRnZXRUeXBlLkNIRUNLQk9YIHx8IHdpZGdldCA9PT0gRm9ybVdpZGdldFR5cGUuVE9HR0xFKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFyc2VCb29sZWFuVmFsdWUodmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgaWYgKGlzTnVtYmVyVHlwZSh0eXBlKSkge1xuICAgICAgICByZXR1cm4gaXNOYU4oTnVtYmVyKHZhbHVlKSkgPyBudWxsIDogTnVtYmVyKHZhbHVlKTtcbiAgICB9XG4gICAgaWYgKHR5cGUgPT09IERhdGFUeXBlLkJPT0xFQU4pIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlQm9vbGVhblZhbHVlKHZhbHVlKTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xufTtcblxuY29uc3QgZmllbGRUeXBlV2lkZ2V0VHlwZU1hcCA9IHtcbiAgICAnaW50ZWdlcicgICAgOiBbJ251bWJlcicsICd0ZXh0JywgJ3NlbGVjdCcsICdjaGVja2JveHNldCcsICdyYWRpb3NldCcsICdyYXRpbmcnLCAnc2xpZGVyJywgJ2N1cnJlbmN5JywgJ2F1dG9jb21wbGV0ZScsICdjaGlwcyddLFxuICAgICdiaWdfaW50ZWdlcic6IFsnbnVtYmVyJywgJ3RleHQnLCAnc2VsZWN0JywgJ2NoZWNrYm94c2V0JywgJ3JhZGlvc2V0JywgJ3JhdGluZycsICdzbGlkZXInLCAnY3VycmVuY3knLCAnYXV0b2NvbXBsZXRlJywgJ2NoaXBzJ10sXG4gICAgJ3Nob3J0JyAgICAgIDogWydudW1iZXInLCAndGV4dCcsICdzZWxlY3QnLCAnY2hlY2tib3hzZXQnLCAncmFkaW9zZXQnLCAnc2xpZGVyJywgJ2N1cnJlbmN5JywgJ2F1dG9jb21wbGV0ZScsICdjaGlwcyddLFxuICAgICdmbG9hdCcgICAgICA6IFsnbnVtYmVyJywgJ3RleHQnLCAnc2VsZWN0JywgJ2NoZWNrYm94c2V0JywgJ3JhZGlvc2V0JywgJ3NsaWRlcicsICdjdXJyZW5jeScsICdhdXRvY29tcGxldGUnLCAnY2hpcHMnXSxcbiAgICAnYmlnX2RlY2ltYWwnOiBbJ251bWJlcicsICd0ZXh0JywgJ3NlbGVjdCcsICdjaGVja2JveHNldCcsICdyYWRpb3NldCcsICdzbGlkZXInLCAnY3VycmVuY3knLCAnYXV0b2NvbXBsZXRlJywgJ2NoaXBzJ10sXG4gICAgJ251bWJlcicgICAgIDogWydudW1iZXInLCAndGV4dCcsICdzZWxlY3QnLCAnY2hlY2tib3hzZXQnLCAncmFkaW9zZXQnLCAnc2xpZGVyJywgJ2N1cnJlbmN5JywgJ2F1dG9jb21wbGV0ZScsICdjaGlwcyddLFxuICAgICdkb3VibGUnICAgICA6IFsnbnVtYmVyJywgJ3RleHQnLCAnc2VsZWN0JywgJ2NoZWNrYm94c2V0JywgJ3JhZGlvc2V0JywgJ3NsaWRlcicsICdjdXJyZW5jeScsICdhdXRvY29tcGxldGUnLCAnY2hpcHMnXSxcbiAgICAnbG9uZycgICAgICAgOiBbJ251bWJlcicsICd0ZXh0JywgJ3NlbGVjdCcsICdjaGVja2JveHNldCcsICdyYWRpb3NldCcsICdyYXRpbmcnLCAnc2xpZGVyJywgJ2N1cnJlbmN5JywgJ2F1dG9jb21wbGV0ZScsICdjaGlwcyddLFxuICAgICdieXRlJyAgICAgICA6IFsnbnVtYmVyJywgJ3RleHQnLCAnc2VsZWN0JywgJ2NoZWNrYm94c2V0JywgJ3JhZGlvc2V0JywgJ3NsaWRlcicsICdjdXJyZW5jeScsICdhdXRvY29tcGxldGUnLCAnY2hpcHMnXSxcbiAgICAnc3RyaW5nJyAgICAgOiBbJ3RleHQnLCAnbnVtYmVyJywgICd0ZXh0YXJlYScsICdwYXNzd29yZCcsICdyaWNodGV4dCcsICdzZWxlY3QnLCAnY2hlY2tib3hzZXQnLCAncmFkaW9zZXQnLCAnZGF0ZScsICd0aW1lJywgJ3RpbWVzdGFtcCcsICdzd2l0Y2gnLCAnY3VycmVuY3knLCAnYXV0b2NvbXBsZXRlJywgJ2NoaXBzJywgJ2NvbG9ycGlja2VyJ10sXG4gICAgJ2NoYXJhY3RlcicgIDogWyd0ZXh0JywgJ251bWJlcicsICAndGV4dGFyZWEnLCAncGFzc3dvcmQnLCAncmljaHRleHQnLCAnc2VsZWN0JywgJ2NoZWNrYm94c2V0JywgJ3JhZGlvc2V0JywgJ3N3aXRjaCcsICdjdXJyZW5jeScsICdhdXRvY29tcGxldGUnLCAnY2hpcHMnXSxcbiAgICAndGV4dCcgICAgICAgOiBbJ3RleHQnLCAnbnVtYmVyJywgICd0ZXh0YXJlYScsICdwYXNzd29yZCcsICdyaWNodGV4dCcsICdzZWxlY3QnLCAnY2hlY2tib3hzZXQnLCAncmFkaW9zZXQnLCAnZGF0ZScsICd0aW1lJywgJ3RpbWVzdGFtcCcsICdzd2l0Y2gnLCAnY3VycmVuY3knLCAnYXV0b2NvbXBsZXRlJywgJ2NoaXBzJywgJ2NvbG9ycGlja2VyJ10sXG4gICAgJ2RhdGUnICAgICAgIDogWydkYXRlJywgJ3RleHQnLCAnbnVtYmVyJywgJ3NlbGVjdCcsICdjaGVja2JveHNldCcsICdyYWRpb3NldCcsICdhdXRvY29tcGxldGUnLCAnY2hpcHMnXSxcbiAgICAndGltZScgICAgICAgOiBbJ3RpbWUnLCAndGV4dCcsICdudW1iZXInLCAnc2VsZWN0JywgJ2NoZWNrYm94c2V0JywgJ3JhZGlvc2V0JywgJ2F1dG9jb21wbGV0ZScsICdjaGlwcyddLFxuICAgICd0aW1lc3RhbXAnICA6IFsndGltZXN0YW1wJywgJ3RleHQnLCAnbnVtYmVyJywgJ3NlbGVjdCcsICdjaGVja2JveHNldCcsICdyYWRpb3NldCcsICdhdXRvY29tcGxldGUnLCAnY2hpcHMnXSxcbiAgICAnZGF0ZXRpbWUnICAgOiBbJ2RhdGV0aW1lJywgJ3RleHQnLCAnc2VsZWN0JywgJ2NoZWNrYm94c2V0JywgJ3JhZGlvc2V0JywgJ2F1dG9jb21wbGV0ZScsICdjaGlwcyddLFxuICAgICdib29sZWFuJyAgICA6IFsnY2hlY2tib3gnLCAncmFkaW9zZXQnLCAndG9nZ2xlJywgJ3NlbGVjdCddLFxuICAgICdsaXN0JyAgICAgICA6IFsnc2VsZWN0JywgJ3JhZGlvc2V0JywgJ2NoZWNrYm94c2V0JywgJ3N3aXRjaCcsICdhdXRvY29tcGxldGUnLCAnY2hpcHMnXSxcbiAgICAnY2xvYicgICAgICAgOiBbJ3RleHQnLCAndGV4dGFyZWEnLCAncmljaHRleHQnXSxcbiAgICAnYmxvYicgICAgICAgOiBbJ3VwbG9hZCddLFxuICAgICdmaWxlJyAgICAgICA6IFsndXBsb2FkJ10sXG4gICAgJ2N1c3RvbScgICAgIDogWyd0ZXh0JywgJ251bWJlcicsICAndGV4dGFyZWEnLCAncGFzc3dvcmQnLCAnY2hlY2tib3gnLCAndG9nZ2xlJywgJ3NsaWRlcicsICdyaWNodGV4dCcsICdjdXJyZW5jeScsICdzd2l0Y2gnLFxuICAgICAgICAnc2VsZWN0JywgJ2NoZWNrYm94c2V0JywgJ3JhZGlvc2V0JywgJ2RhdGUnLCAndGltZScsICd0aW1lc3RhbXAnLCAncmF0aW5nJywgJ2RhdGV0aW1lJywgJ2F1dG9jb21wbGV0ZScsICdjaGlwcycsICdjb2xvcnBpY2tlciddXG59O1xuXG4vLyBHZXQgd2lkZ2V0cyBhcHBsaWNhYmxlIHRvIHRoZSBnaXZlbiB0eXBlXG5leHBvcnQgY29uc3QgZ2V0RmllbGRUeXBlV2lkZ2V0VHlwZXNNYXAgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGZpZWxkVHlwZVdpZGdldFR5cGVNYXA7XG59O1xuXG4vLyBHZXQgZmlsdGVyIHdpZGdldCBhcHBsaWNhYmxlIHRvIHRoZSBnaXZlbiB0eXBlXG5leHBvcnQgY29uc3QgZ2V0RGF0YVRhYmxlRmlsdGVyV2lkZ2V0ID0gdHlwZSA9PiB7XG4gICAgbGV0IHdpZGdldCA9IGZpZWxkVHlwZVdpZGdldFR5cGVNYXBbdHlwZV0gJiYgZmllbGRUeXBlV2lkZ2V0VHlwZU1hcFt0eXBlXVswXTtcbiAgICBpZiAodHlwZSA9PT0gRGF0YVR5cGUuQk9PTEVBTikge1xuICAgICAgICB3aWRnZXQgPSBGb3JtV2lkZ2V0VHlwZS5TRUxFQ1Q7XG4gICAgfVxuICAgIGlmIChfLmluY2x1ZGVzKFtGb3JtV2lkZ2V0VHlwZS5URVhULCBGb3JtV2lkZ2V0VHlwZS5OVU1CRVIsIEZvcm1XaWRnZXRUeXBlLlNFTEVDVCwgRm9ybVdpZGdldFR5cGUuQVVUT0NPTVBMRVRFLFxuICAgICAgICAgICAgRm9ybVdpZGdldFR5cGUuREFURSwgRm9ybVdpZGdldFR5cGUuVElNRSwgRm9ybVdpZGdldFR5cGUuREFURVRJTUVdLCB3aWRnZXQpKSB7XG4gICAgICAgIHJldHVybiB3aWRnZXQ7XG4gICAgfVxuICAgIHJldHVybiBGb3JtV2lkZ2V0VHlwZS5URVhUO1xufTtcblxuLyoqXG4gKiBAbmdkb2MgZnVuY3Rpb25cbiAqIEBuYW1lIHdtLndpZGdldHMubGl2ZS5nZXRFZGl0TW9kZVdpZGdldFxuICogQG1ldGhvZE9mIHdtLndpZGdldHMubGl2ZS5MaXZlV2lkZ2V0VXRpbHNcbiAqIEBmdW5jdGlvblxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogVGhpcyBmdW5jdGlvbiByZXR1cm5zIHRoZSBkZWZhdWx0IHdpZGdldCBmb3IgZ3JpZFxuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBjb2xEZWYgZmllbGQgZGVmaW5pdGlvblxuICovXG5leHBvcnQgY29uc3QgZ2V0RWRpdE1vZGVXaWRnZXQgPSBjb2xEZWYgPT4ge1xuICAgIGlmIChjb2xEZWZbJ3JlbGF0ZWQtZW50aXR5LW5hbWUnXSAmJiBjb2xEZWZbJ3ByaW1hcnkta2V5J10pIHtcbiAgICAgICAgcmV0dXJuIEZvcm1XaWRnZXRUeXBlLlNFTEVDVDtcbiAgICB9XG4gICAgcmV0dXJuIChmaWVsZFR5cGVXaWRnZXRUeXBlTWFwW2NvbERlZi50eXBlXSAmJiBmaWVsZFR5cGVXaWRnZXRUeXBlTWFwW2NvbERlZi50eXBlXVswXSkgfHwgRm9ybVdpZGdldFR5cGUuVEVYVDtcbn07XG5cbi8qKlxuICogQG5nZG9jIGZ1bmN0aW9uXG4gKiBAbmFtZSB3bS53aWRnZXRzLmxpdmUuTGl2ZVdpZGdldFV0aWxzI2dldERlZmF1bHRWYWx1ZVxuICogQG1ldGhvZE9mIHdtLndpZGdldHMubGl2ZS5MaXZlV2lkZ2V0VXRpbHNcbiAqIEBmdW5jdGlvblxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogcmV0dXJuIHRoZSBmb3JtYXR0ZWQgZGVmYXVsdCB2YWx1ZVxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSB2YWx1ZSB0byBiZSBmb3JtYXR0ZWRcbiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIGNvbHVtbiB0eXBlIG9mIHRoZSB2YWx1ZVxuICovXG5leHBvcnQgY29uc3QgZ2V0RGVmYXVsdFZhbHVlID0gKHZhbHVlLCB0eXBlLCB3aWRnZXQpID0+IHtcbiAgICBpZiAod2lkZ2V0KSB7XG4gICAgICAgIGlmICh3aWRnZXQgPT09IEZvcm1XaWRnZXRUeXBlLk5VTUJFUiB8fCB3aWRnZXQgPT09IEZvcm1XaWRnZXRUeXBlLlNMSURFUiB8fCB3aWRnZXQgPT09IEZvcm1XaWRnZXRUeXBlLkNVUlJFTkNZKSB7XG4gICAgICAgICAgICByZXR1cm4gaXNOYU4oTnVtYmVyKHZhbHVlKSkgPyBudWxsIDogTnVtYmVyKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAod2lkZ2V0ID09PSBGb3JtV2lkZ2V0VHlwZS5DSEVDS0JPWCB8fCB3aWRnZXQgPT09IEZvcm1XaWRnZXRUeXBlLlRPR0dMRSkge1xuICAgICAgICAgICAgcmV0dXJuIHBhcnNlQm9vbGVhblZhbHVlKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIGlmIChpc051bWJlclR5cGUodHlwZSkpIHtcbiAgICAgICAgcmV0dXJuIGlzTmFOKE51bWJlcih2YWx1ZSkpID8gbnVsbCA6IE51bWJlcih2YWx1ZSk7XG4gICAgfVxuICAgIGlmICh0eXBlID09PSBEYXRhVHlwZS5CT09MRUFOKSB7XG4gICAgICAgIHJldHVybiBwYXJzZUJvb2xlYW5WYWx1ZSh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbn07XG4iXX0=