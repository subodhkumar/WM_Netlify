import { SwipeAnimation } from '@swipey';
export class CarouselAnimator extends SwipeAnimation {
    constructor(carousel, interval, ngZone) {
        super();
        this.carousel = carousel;
        this.interval = interval;
        this.ngZone = ngZone;
        this._activeIndex = 0;
        this._animationPaused = false;
        this._pauseCaroselTill = 0;
        this._oldIndex = 0;
        const self = this;
        this._$el = $(this.carousel.getNativeElement()).find('>.carousel');
        this.init(this._$el.find('>.carousel-inner'));
        this._items = this._$el.find('>.carousel-inner >.carousel-item');
        this._indicators = this._$el.find('>.carousel-indicators');
        this._indicators.find('li').each(function (i) {
            $(this).on('click', () => {
                self._activeIndex = i;
                self.setActiveItem();
            });
        });
        this._$el.find('>.left.carousel-control').on('click', () => {
            this._pauseCaroselTill = Date.now() + this.interval;
            this.goToUpper();
        });
        this._$el.find('>.right.carousel-control').on('click', () => {
            this._pauseCaroselTill = Date.now() + this.interval;
            this.goToLower();
        });
        this.setActiveItem();
        if (this.interval) {
            this.start();
        }
    }
    bounds() {
        this._width = this._items.width();
        this._swiping = true;
        return {
            'lower': -this._width,
            'center': 0,
            'upper': this._width
        };
    }
    context() {
        return {
            'w': this._width
        };
    }
    animation() {
        return [{
                'target': this.getTarget.bind(this),
                'css': {
                    'transform': 'translate3d(${{ (($D + $d) / w) * 100 + \'%\'}}, 0, 0)',
                    '-webkit-transform': 'translate3d(${{ (($D + $d) / w) * 100 + \'%\'}}, 0, 0)'
                }
            }];
    }
    onUpper() {
        this.resetTransition();
        this._activeIndex -= 1;
        this.setActiveItem();
        this._swiping = false;
    }
    onLower() {
        this.resetTransition();
        this._activeIndex += 1;
        this.setActiveItem();
        this._swiping = false;
    }
    onAnimation() {
        const newIndex = (this._items.length + this._activeIndex) % this._items.length;
        this.carousel.onChangeCB(newIndex, this._oldIndex);
        this._oldIndex = newIndex;
    }
    start() {
        this.ngZone.runOutsideAngular(() => {
            this._intervalId = setInterval(() => {
                if (!this._swiping && this._pauseCaroselTill < Date.now()) {
                    this.goToLower(600);
                }
            }, this.interval);
        });
    }
    pause() {
        this._animationPaused = true;
        if (!this._intervalId) {
            this.start();
        }
    }
    resume() {
        this._animationPaused = false;
    }
    stop() {
        if (this._intervalId) {
            clearInterval(this._intervalId);
            this._intervalId = 0;
        }
    }
    threshold() {
        return 5;
    }
    // Returns multiple elements as single jQuery element.
    getTarget() {
        const noOfItems = this._items.length, activeItem = this._items.eq((noOfItems + this._activeIndex) % noOfItems), leftItem = this._items.eq((noOfItems + this._activeIndex - 1) % noOfItems), rightItem = this._items.eq((noOfItems + this._activeIndex + 1) % noOfItems);
        return activeItem.add(rightItem).add(leftItem);
    }
    resetTransition() {
        this.getTarget().css({
            '-webkit-transition': 'none',
            '-webkit-transform': '',
            'transition': 'none',
            'transform': ''
        });
    }
    // Sets active item, leftItem, rightItem by removing / adding respective classes.
    setActiveItem() {
        const items = this._items, left = this._activeIndex - 1, right = this._activeIndex + 1;
        // if there is only one carousel-item then there won't be any right or left-item.
        if (items.length === 1) {
            items.eq(0).removeClass('left-item right-item');
            return;
        }
        this._indicators.find('>.active').removeClass('active');
        this._indicators.find('> li').eq((items.length + this._activeIndex) % items.length).addClass('active');
        items.filter('.active').removeClass('active');
        items.addClass('left-item');
        items.eq((items.length + left) % items.length).addClass('left-item').removeClass('right-item');
        items.eq((items.length + this._activeIndex) % items.length).removeClass('left-item right-item').addClass('active');
        items.eq((items.length + right) % items.length).addClass('right-item').removeClass('left-item');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2Fyb3VzZWwuYW5pbWF0b3IuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ad20vY29tcG9uZW50cy8iLCJzb3VyY2VzIjpbIndpZGdldHMvY29tbW9uL2Nhcm91c2VsL2Nhcm91c2VsLmFuaW1hdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFNekMsTUFBTSxPQUFPLGdCQUFpQixTQUFRLGNBQWM7SUFhaEQsWUFBMkIsUUFBMkIsRUFBVSxRQUFnQixFQUFVLE1BQWM7UUFDcEcsS0FBSyxFQUFFLENBQUM7UUFEZSxhQUFRLEdBQVIsUUFBUSxDQUFtQjtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVE7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBVmhHLGlCQUFZLEdBQUcsQ0FBQyxDQUFDO1FBQ2pCLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUl6QixzQkFBaUIsR0FBRyxDQUFDLENBQUM7UUFHdEIsY0FBUyxHQUFHLENBQUMsQ0FBQztRQUlsQixNQUFNLElBQUksR0FBRyxJQUFJLENBQUM7UUFDbEIsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ25FLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDO1FBQzlDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsa0NBQWtDLENBQUMsQ0FBQztRQUNqRSxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDM0QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFVB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QztRQUM5QyxLQUFLLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzVCLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQy9GLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxDQUFDLHNCQUFzQixDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ25ILEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3BHLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5nWm9uZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBTd2lwZUFuaW1hdGlvbiB9IGZyb20gJ0Bzd2lwZXknO1xuXG5pbXBvcnQgeyBDYXJvdXNlbERpcmVjdGl2ZSB9IGZyb20gJy4vY2Fyb3VzZWwuZGlyZWN0aXZlJztcblxuZGVjbGFyZSBjb25zdCAkO1xuXG5leHBvcnQgY2xhc3MgQ2Fyb3VzZWxBbmltYXRvciBleHRlbmRzIFN3aXBlQW5pbWF0aW9uIHtcblxuICAgIHByaXZhdGUgXyRlbDtcbiAgICBwcml2YXRlIF9hY3RpdmVJbmRleCA9IDA7XG4gICAgcHJpdmF0ZSBfYW5pbWF0aW9uUGF1c2VkID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBfaW5kaWNhdG9ycztcbiAgICBwcml2YXRlIF9pdGVtcztcbiAgICBwcml2YXRlIF9pbnRlcnZhbElkO1xuICAgIHByaXZhdGUgX3BhdXNlQ2Fyb3NlbFRpbGwgPSAwO1xuICAgIHByaXZhdGUgX3N3aXBpbmc7XG4gICAgcHJpdmF0ZSBfd2lkdGg7XG4gICAgcHJpdmF0ZSBfb2xkSW5kZXggPSAwO1xuXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKHByaXZhdGUgY2Fyb3VzZWw6IENhcm91c2VsRGlyZWN0aXZlLCBwcml2YXRlIGludGVydmFsOiBudW1iZXIsIHByaXZhdGUgbmdab25lOiBOZ1pvbmUpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMuXyRlbCA9ICQodGhpcy5jYXJvdXNlbC5nZXROYXRpdmVFbGVtZW50KCkpLmZpbmQoJz4uY2Fyb3VzZWwnKTtcbiAgICAgICAgdGhpcy5pbml0KHRoaXMuXyRlbC5maW5kKCc+LmNhcm91c2VsLWlubmVyJykpO1xuICAgICAgICB0aGlzLl9pdGVtcyA9IHRoaXMuXyRlbC5maW5kKCc+LmNhcm91c2VsLWlubmVyID4uY2Fyb3VzZWwtaXRlbScpO1xuICAgICAgICB0aGlzLl9pbmRpY2F0b3JzID0gdGhpcy5fJGVsLmZpbmQoJz4uY2Fyb3VzZWwtaW5kaWNhdG9ycycpO1xuICAgICAgICB0aGlzLl9pbmRpY2F0b3JzLmZpbmQoJ2xpJykuZWFjaChmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgJCh0aGlzKS5vbignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2VsZi5fYWN0aXZlSW5kZXggPSBpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2V0QWN0aXZlSXRlbSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl8kZWwuZmluZCgnPi5sZWZ0LmNhcm91c2VsLWNvbnRyb2wnKS5vbignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9wYXVzZUNhcm9zZWxUaWxsID0gRGF0ZS5ub3coKSArIHRoaXMuaW50ZXJ2YWw7XG4gICAgICAgICAgICB0aGlzLmdvVG9VcHBlcigpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fJGVsLmZpbmQoJz4ucmlnaHQuY2Fyb3VzZWwtY29udHJvbCcpLm9uKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3BhdXNlQ2Fyb3NlbFRpbGwgPSBEYXRlLm5vdygpICsgdGhpcy5pbnRlcnZhbDtcbiAgICAgICAgICAgIHRoaXMuZ29Ub0xvd2VyKCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0oKTtcbiAgICAgICAgaWYgKHRoaXMuaW50ZXJ2YWwpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBib3VuZHMoKSB7XG4gICAgICAgIHRoaXMuX3dpZHRoID0gdGhpcy5faXRlbXMud2lkdGgoKTtcbiAgICAgICAgdGhpcy5fc3dpcGluZyA9IHRydWU7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAnbG93ZXInOiAtdGhpcy5fd2lkdGgsXG4gICAgICAgICAgICAnY2VudGVyJzogMCxcbiAgICAgICAgICAgICd1cHBlcic6IHRoaXMuX3dpZHRoXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIGNvbnRleHQoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAndyc6IHRoaXMuX3dpZHRoXG4gICAgICAgIH07XG4gICAgfVxuXG5cbiAgICBwdWJsaWMgYW5pbWF0aW9uKCkge1xuICAgICAgICByZXR1cm4gW3tcbiAgICAgICAgICAgICd0YXJnZXQnOiB0aGlzLmdldFRhcmdldC5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgJ2Nzcyc6IHtcbiAgICAgICAgICAgICAgICAndHJhbnNmb3JtJzogJ3RyYW5zbGF0ZTNkKCR7eyAoKCREICsgJGQpIC8gdykgKiAxMDAgKyBcXCclXFwnfX0sIDAsIDApJyxcbiAgICAgICAgICAgICAgICAnLXdlYmtpdC10cmFuc2Zvcm0nOiAndHJhbnNsYXRlM2QoJHt7ICgoJEQgKyAkZCkgLyB3KSAqIDEwMCArIFxcJyVcXCd9fSwgMCwgMCknXG4gICAgICAgICAgICB9XG4gICAgICAgIH1dO1xuICAgIH1cblxuICAgIHB1YmxpYyBvblVwcGVyKCkge1xuICAgICAgICB0aGlzLnJlc2V0VHJhbnNpdGlvbigpO1xuICAgICAgICB0aGlzLl9hY3RpdmVJbmRleCAtPSAxO1xuICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0oKTtcbiAgICAgICAgdGhpcy5fc3dpcGluZyA9IGZhbHNlO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbkxvd2VyKCkge1xuICAgICAgICB0aGlzLnJlc2V0VHJhbnNpdGlvbigpO1xuICAgICAgICB0aGlzLl9hY3RpdmVJbmRleCArPSAxO1xuICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0oKTtcbiAgICAgICAgdGhpcy5fc3dpcGluZyA9IGZhbHNlO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbkFuaW1hdGlvbigpIHtcbiAgICAgICAgY29uc3QgbmV3SW5kZXggPSAodGhpcy5faXRlbXMubGVuZ3RoICsgdGhpcy5fYWN0aXZlSW5kZXgpICUgdGhpcy5faXRlbXMubGVuZ3RoO1xuICAgICAgICB0aGlzLmNhcm91c2VsLm9uQ2hhbmdlQ0IobmV3SW5kZXgsIHRoaXMuX29sZEluZGV4KTtcbiAgICAgICAgdGhpcy5fb2xkSW5kZXggPSBuZXdJbmRleDtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhcnQoKSB7XG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2ludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9zd2lwaW5nICYmIHRoaXMuX3BhdXNlQ2Fyb3NlbFRpbGwgPCBEYXRlLm5vdygpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ29Ub0xvd2VyKDYwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgdGhpcy5pbnRlcnZhbCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBwYXVzZSgpIHtcbiAgICAgICAgdGhpcy5fYW5pbWF0aW9uUGF1c2VkID0gdHJ1ZTtcbiAgICAgICAgaWYgKCF0aGlzLl9pbnRlcnZhbElkKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgcmVzdW1lKCkge1xuICAgICAgICB0aGlzLl9hbmltYXRpb25QYXVzZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RvcCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2ludGVydmFsSWQpIHtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5faW50ZXJ2YWxJZCk7XG4gICAgICAgICAgICB0aGlzLl9pbnRlcnZhbElkID0gMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyB0aHJlc2hvbGQoKSB7XG4gICAgICAgIHJldHVybiA1O1xuICAgIH1cblxuICAgIC8vIFJldHVybnMgbXVsdGlwbGUgZWxlbWVudHMgYXMgc2luZ2xlIGpRdWVyeSBlbGVtZW50LlxuICAgIHByaXZhdGUgZ2V0VGFyZ2V0KCkge1xuICAgICAgICBjb25zdCBub09mSXRlbXMgPSB0aGlzLl9pdGVtcy5sZW5ndGgsXG4gICAgICAgICAgICBhY3RpdmVJdGVtID0gdGhpcy5faXRlbXMuZXEoKG5vT2ZJdGVtcyArIHRoaXMuX2FjdGl2ZUluZGV4KSAlIG5vT2ZJdGVtcyksXG4gICAgICAgICAgICBsZWZ0SXRlbSA9IHRoaXMuX2l0ZW1zLmVxKChub09mSXRlbXMgKyB0aGlzLl9hY3RpdmVJbmRleCAtIDEpICUgbm9PZkl0ZW1zKSxcbiAgICAgICAgICAgIHJpZ2h0SXRlbSA9IHRoaXMuX2l0ZW1zLmVxKChub09mSXRlbXMgKyB0aGlzLl9hY3RpdmVJbmRleCArIDEpICUgbm9PZkl0ZW1zKTtcbiAgICAgICAgcmV0dXJuIGFjdGl2ZUl0ZW0uYWRkKHJpZ2h0SXRlbSkuYWRkKGxlZnRJdGVtKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlc2V0VHJhbnNpdGlvbigpIHtcbiAgICAgICAgdGhpcy5nZXRUYXJnZXQoKS5jc3Moe1xuICAgICAgICAgICAgJy13ZWJraXQtdHJhbnNpdGlvbic6ICdub25lJyxcbiAgICAgICAgICAgICctd2Via2l0LXRyYW5zZm9ybSc6ICcnLFxuICAgICAgICAgICAgJ3RyYW5zaXRpb24nOiAnbm9uZScsXG4gICAgICAgICAgICAndHJhbnNmb3JtJzogJydcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gU2V0cyBhY3RpdmUgaXRlbSwgbGVmdEl0ZW0sIHJpZ2h0SXRlbSBieSByZW1vdmluZyAvIGFkZGluZyByZXNwZWN0aXZlIGNsYXNzZXMuXG4gICAgcHJpdmF0ZSBzZXRBY3RpdmVJdGVtKCkge1xuICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMuX2l0ZW1zLFxuICAgICAgICAgICAgbGVmdCA9IHRoaXMuX2FjdGl2ZUluZGV4IC0gMSxcbiAgICAgICAgICAgIHJpZ2h0ID0gdGhpcy5fYWN0aXZlSW5kZXggKyAxO1xuICAgICAgICAvLyBpZiB0aGVyZSBpcyBvbmx5IG9uZSBjYXJvdXNlbC1pdGVtIHRoZW4gdGhlcmUgd29uJ3QgYmUgYW55IHJpZ2h0IG9yIGxlZnQtaXRlbS5cbiAgICAgICAgaWYgKGl0ZW1zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgaXRlbXMuZXEoMCkucmVtb3ZlQ2xhc3MoJ2xlZnQtaXRlbSByaWdodC1pdGVtJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9pbmRpY2F0b3JzLmZpbmQoJz4uYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICB0aGlzLl9pbmRpY2F0b3JzLmZpbmQoJz4gbGknKS5lcSgoaXRlbXMubGVuZ3RoICsgdGhpcy5fYWN0aXZlSW5kZXgpICUgaXRlbXMubGVuZ3RoKS5hZGRDbGFzcygnYWN0aXZlJyk7XG5cblxuICAgICAgICBpdGVtcy5maWx0ZXIoJy5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIGl0ZW1zLmFkZENsYXNzKCdsZWZ0LWl0ZW0nKTtcbiAgICAgICAgaXRlbXMuZXEoKGl0ZW1zLmxlbmd0aCArIGxlZnQpICUgaXRlbXMubGVuZ3RoKS5hZGRDbGFzcygnbGVmdC1pdGVtJykucmVtb3ZlQ2xhc3MoJ3JpZ2h0LWl0ZW0nKTtcbiAgICAgICAgaXRlbXMuZXEoKGl0ZW1zLmxlbmd0aCArIHRoaXMuX2FjdGl2ZUluZGV4KSAlIGl0ZW1zLmxlbmd0aCkucmVtb3ZlQ2xhc3MoJ2xlZnQtaXRlbSByaWdodC1pdGVtJykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICBpdGVtcy5lcSgoaXRlbXMubGVuZ3RoICsgcmlnaHQpICUgaXRlbXMubGVuZ3RoKS5hZGRDbGFzcygncmlnaHQtaXRlbScpLnJlbW92ZUNsYXNzKCdsZWZ0LWl0ZW0nKTtcbiAgICB9XG59XG4iXX0=