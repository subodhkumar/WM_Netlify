import { setCSS } from '@wm/core';
import { getBackGroundImageUrl } from '../../utils/widget-utils';
export var APPLY_STYLES_TYPE;
(function (APPLY_STYLES_TYPE) {
    APPLY_STYLES_TYPE[APPLY_STYLES_TYPE["CONTAINER"] = 0] = "CONTAINER";
    APPLY_STYLES_TYPE[APPLY_STYLES_TYPE["SCROLLABLE_CONTAINER"] = 1] = "SCROLLABLE_CONTAINER";
    APPLY_STYLES_TYPE[APPLY_STYLES_TYPE["INNER_SHELL"] = 2] = "INNER_SHELL";
    APPLY_STYLES_TYPE[APPLY_STYLES_TYPE["SHELL"] = 3] = "SHELL";
})(APPLY_STYLES_TYPE || (APPLY_STYLES_TYPE = {}));
export var propNameCSSKeyMap = {
    'backgroundattachment': 'backgroundAttachment',
    'backgroundcolor': 'backgroundColor',
    'backgroundgradient': 'backgroundGradient',
    'backgroundimage': 'backgroundImage',
    'backgroundposition': 'backgroundPosition',
    'backgroundrepeat': 'backgroundRepeat',
    'backgroundsize': 'backgroundSize',
    'bordercolor': 'borderColor',
    'borderradius': 'borderRadius',
    'borderstyle': 'borderStyle',
    'borderwidth': 'borderWidth',
    'borderbottomwidth': 'borderBottomWidth',
    'borderleftwidth': 'borderLeftWidth',
    'borderrightwidth': 'borderRightWidth',
    'bordertopwidth': 'borderTopWidth',
    'color': 'color',
    'cursor': 'cursor',
    'display': 'display',
    'fontsize': 'fontSize',
    'fontfamily': 'fontFamily',
    'fontstyle': 'fontStyle',
    'fontunit': 'fontunit',
    'fontvariant': 'fontVariant',
    'fontweight': 'fontWeight',
    'height': 'height',
    'horizontalalign': 'textAlign',
    'lineheight': 'lineHeight',
    'margin': 'margin',
    'marginbottom': 'marginBottom',
    'marginleft': 'marginLeft',
    'marginright': 'marginRight',
    'margintop': 'marginTop',
    'opacity': 'opacity',
    'overflow': 'overflow',
    'padding': 'padding',
    'paddingbottom': 'paddingBottom',
    'paddingleft': 'paddingLeft',
    'paddingright': 'paddingRight',
    'paddingtop': 'paddingTop',
    'picturesource': 'backgroundImage',
    'textalign': 'textAlign',
    'textdecoration': 'textDecoration',
    'verticalalign': 'verticalAlign',
    'visibility': 'visibility',
    'whitespace': 'whiteSpace',
    'width': 'width',
    'wordbreak': 'wordbreak',
    'zindex': 'zIndex'
};
export var isStyle = function (key) { return !!propNameCSSKeyMap[key]; };
var MAP_SHELL_TYPE_IGNORE_LIST = {
    height: true,
    overflow: true,
    padding: true,
    paddingbottom: true,
    paddingleft: true,
    paddingright: true,
    paddingtop: true
};
var MAP_CONTAINER_TYPE_IGNORE_LIST = {
    textalign: true
};
var MAP_SCROLLABLE_CONTAINER_TYPE_IGNORE_LIST = {
    textalign: true,
    width: true
};
export function styler($node, component, type, skipList) {
    // apply init styles;
    var skipListMap = Object.create(null);
    if (skipList) {
        skipList.forEach(function (k) { return skipListMap[k] = true; });
    }
    component.registerStyleChangeListener(function (key, nv) {
        if (skipListMap[key]) {
            return;
        }
        // if the type is `shell` and the key is in the SHELL_TYPE_IGNORE_LIST, return
        if (type === APPLY_STYLES_TYPE.SHELL && MAP_SHELL_TYPE_IGNORE_LIST[key]) {
            return;
        }
        // if the type is `inner-shell` and the key is NOT in the SHELL_TYPE_IGNORE_LIST, return
        if (type === APPLY_STYLES_TYPE.INNER_SHELL) {
            if (!MAP_SHELL_TYPE_IGNORE_LIST[key]) {
                return;
            }
            if (key === 'height') {
                setCSS($node, 'overflow', nv ? 'auto' : '');
            }
        }
        // if the type is `container` and the key is in the CONTAINER_TYPE_IGNORE_LIST, return
        if (type === APPLY_STYLES_TYPE.CONTAINER && MAP_CONTAINER_TYPE_IGNORE_LIST[key]) {
            return;
        }
        if (type === APPLY_STYLES_TYPE.SCROLLABLE_CONTAINER) {
            if (MAP_SCROLLABLE_CONTAINER_TYPE_IGNORE_LIST[key]) {
                return;
            }
            if (key === 'height') {
                setCSS($node, 'overflow', nv ? 'auto' : '');
            }
        }
        if (key === 'fontsize' || key === 'fontunit') {
            setCSS($node, 'fontSize', component.fontsize === '' ? '' : component.fontsize + (component.fontunit || 'px'));
        }
        else if (key === 'backgroundimage') {
            setCSS($node, 'backgroundImage', component.picturesource || getBackGroundImageUrl(nv));
        }
        else if (propNameCSSKeyMap[key]) {
            setCSS($node, propNameCSSKeyMap[key], nv);
        }
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3R5bGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHdtL2NvbXBvbmVudHMvIiwic291cmNlcyI6WyJ3aWRnZXRzL2ZyYW1ld29yay9zdHlsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUVsQyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUdqRSxNQUFNLENBQU4sSUFBWSxpQkFLWDtBQUxELFdBQVksaUJBQWlCO0lBQ3pCLG1FQUFTLENBQUE7SUFDVCx5RkFBb0IsQ0FBQTtJQUNwQix1RUFBVyxDQUFBO0lBQ1gsMkRBQUssQ0FBQTtBQUNULENBQUMsRUFMVyxpQkFBaUIsS0FBakIsaUJBQWlCLFFBSzVCO0FBRUQsTUFBTSxDQUFDLElBQU0saUJBQWlCLEdBQUc7SUFDN0Isc0JBQXNCLEVBQUUsc0JBQXNCO0lBQzlDLGlCQUFpQixFQUFFLGlCQUFpQjtJQUNwQyxvQkFBb0IsRUFBRSxvQkFBb0I7SUFDMUMsaUJBQWlCLEVBQUUsaUJBQWlCO0lBQ3BDLG9CQUFvQixFQUFFLG9CQUFvQjtJQUMxQyxrQkFBa0IsRUFBRSxrQkFBa0I7SUFDdEMsZ0JBQWdCLEVBQUUsZ0JBQWdCO0lBQ2xDLGFBQWEsRUFBRSxhQUFhO0lBQzVCLGNBQWMsRUFBRSxjQUFjO0lBQzlCLGFBQWEsRUFBRSxhQUFhO0lBQzVCLGFBQWEsRUFBRSxhQUFhO0lBQzVCLG1CQUFtQixFQUFFLG1CQUFtQjtJQUN4QyxpQkFBaUIsRUFBRSxpQkFBaUI7SUFDcEMsa0JBQWtCLEVBQUUsa0JBQWtCO0lBQ3RDLGdCQUFnQixFQUFFLGdCQUFnQjtJQUNsQyxPQUFPLEVBQUUsT0FBTztJQUNoQixRQUFRLEVBQUUsUUFBUTtJQUNsQixTQUFTLEVBQUUsU0FBUztJQUNwQixVQUFVLEVBQUUsVUFBVTtJQUN0QixZQUFZLEVBQUUsWUFBWTtJQUMxQixXQUFXLEVBQUUsV0FBVztJQUN4QixVQUFVLEVB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QWlCLENBQUMsb0JBQW9CLEVBQUU7WUFDakQsSUFBSSx5Q0FBeUMsQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDaEQsT0FBTzthQUNWO1lBRUQsSUFBSSxHQUFHLEtBQUssUUFBUSxFQUFFO2dCQUNsQixNQUFNLENBQUMsS0FBSyxFQUFFLFVBQVUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7YUFDL0M7U0FDSjtRQUVELElBQUksR0FBRyxLQUFLLFVBQVUsSUFBSSxHQUFHLEtBQUssVUFBVSxFQUFFO1lBQzFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsVUFBVSxFQUFFLFNBQVMsQ0FBQyxRQUFRLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxTQUFTLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDakg7YUFBTSxJQUFJLEdBQUcsS0FBSyxpQkFBaUIsRUFBRTtZQUNsQyxNQUFNLENBQUMsS0FBSyxFQUFFLGlCQUFpQixFQUFFLFNBQVMsQ0FBQyxhQUFhLElBQUkscUJBQXFCLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztTQUMxRjthQUFNLElBQUksaUJBQWlCLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDL0IsTUFBTSxDQUFDLEtBQUssRUFBRSxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztTQUM3QztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNldENTUyB9IGZyb20gJ0B3bS9jb3JlJztcblxuaW1wb3J0IHsgZ2V0QmFja0dyb3VuZEltYWdlVXJsIH0gZnJvbSAnLi4vLi4vdXRpbHMvd2lkZ2V0LXV0aWxzJztcbmltcG9ydCB7IFN0eWxhYmxlQ29tcG9uZW50IH0gZnJvbSAnLi4vY29tbW9uL2Jhc2Uvc3R5bGFibGUuY29tcG9uZW50JztcblxuZXhwb3J0IGVudW0gQVBQTFlfU1RZTEVTX1RZUEUge1xuICAgIENPTlRBSU5FUixcbiAgICBTQ1JPTExBQkxFX0NPTlRBSU5FUixcbiAgICBJTk5FUl9TSEVMTCxcbiAgICBTSEVMTFxufVxuXG5leHBvcnQgY29uc3QgcHJvcE5hbWVDU1NLZXlNYXAgPSB7XG4gICAgJ2JhY2tncm91bmRhdHRhY2htZW50JzogJ2JhY2tncm91bmRBdHRhY2htZW50JyxcbiAgICAnYmFja2dyb3VuZGNvbG9yJzogJ2JhY2tncm91bmRDb2xvcicsXG4gICAgJ2JhY2tncm91bmRncmFkaWVudCc6ICdiYWNrZ3JvdW5kR3JhZGllbnQnLFxuICAgICdiYWNrZ3JvdW5kaW1hZ2UnOiAnYmFja2dyb3VuZEltYWdlJyxcbiAgICAnYmFja2dyb3VuZHBvc2l0aW9uJzogJ2JhY2tncm91bmRQb3NpdGlvbicsXG4gICAgJ2JhY2tncm91bmRyZXBlYXQnOiAnYmFja2dyb3VuZFJlcGVhdCcsXG4gICAgJ2JhY2tncm91bmRzaXplJzogJ2JhY2tncm91bmRTaXplJyxcbiAgICAnYm9yZGVyY29sb3InOiAnYm9yZGVyQ29sb3InLFxuICAgICdib3JkZXJyYWRpdXMnOiAnYm9yZGVyUmFkaXVzJyxcbiAgICAnYm9yZGVyc3R5bGUnOiAnYm9yZGVyU3R5bGUnLFxuICAgICdib3JkZXJ3aWR0aCc6ICdib3JkZXJXaWR0aCcsXG4gICAgJ2JvcmRlcmJvdHRvbXdpZHRoJzogJ2JvcmRlckJvdHRvbVdpZHRoJyxcbiAgICAnYm9yZGVybGVmdHdpZHRoJzogJ2JvcmRlckxlZnRXaWR0aCcsXG4gICAgJ2JvcmRlcnJpZ2h0d2lkdGgnOiAnYm9yZGVyUmlnaHRXaWR0aCcsXG4gICAgJ2JvcmRlcnRvcHdpZHRoJzogJ2JvcmRlclRvcFdpZHRoJyxcbiAgICAnY29sb3InOiAnY29sb3InLFxuICAgICdjdXJzb3InOiAnY3Vyc29yJyxcbiAgICAnZGlzcGxheSc6ICdkaXNwbGF5JyxcbiAgICAnZm9udHNpemUnOiAnZm9udFNpemUnLFxuICAgICdmb250ZmFtaWx5JzogJ2ZvbnRGYW1pbHknLFxuICAgICdmb250c3R5bGUnOiAnZm9udFN0eWxlJyxcbiAgICAnZm9udHVuaXQnOiAnZm9udHVuaXQnLFxuICAgICdmb250dmFyaWFudCc6ICdmb250VmFyaWFudCcsXG4gICAgJ2ZvbnR3ZWlnaHQnOiAnZm9udFdlaWdodCcsXG4gICAgJ2hlaWdodCc6ICdoZWlnaHQnLFxuICAgICdob3Jpem9udGFsYWxpZ24nOiAndGV4dEFsaWduJyxcbiAgICAnbGluZWhlaWdodCc6ICdsaW5lSGVpZ2h0JyxcbiAgICAnbWFyZ2luJzogJ21hcmdpbicsXG4gICAgJ21hcmdpbmJvdHRvbSc6ICdtYXJnaW5Cb3R0b20nLFxuICAgICdtYXJnaW5sZWZ0JzogJ21hcmdpbkxlZnQnLFxuICAgICdtYXJnaW5yaWdodCc6ICdtYXJnaW5SaWdodCcsXG4gICAgJ21hcmdpbnRvcCc6ICdtYXJnaW5Ub3AnLFxuICAgICdvcGFjaXR5JzogJ29wYWNpdHknLFxuICAgICdvdmVyZmxvdyc6ICdvdmVyZmxvdycsXG4gICAgJ3BhZGRpbmcnOiAncGFkZGluZycsXG4gICAgJ3BhZGRpbmdib3R0b20nOiAncGFkZGluZ0JvdHRvbScsXG4gICAgJ3BhZGRpbmdsZWZ0JzogJ3BhZGRpbmdMZWZ0JyxcbiAgICAncGFkZGluZ3JpZ2h0JzogJ3BhZGRpbmdSaWdodCcsXG4gICAgJ3BhZGRpbmd0b3AnOiAncGFkZGluZ1RvcCcsXG4gICAgJ3BpY3R1cmVzb3VyY2UnOiAnYmFja2dyb3VuZEltYWdlJyxcbiAgICAndGV4dGFsaWduJzogJ3RleHRBbGlnbicsXG4gICAgJ3RleHRkZWNvcmF0aW9uJzogJ3RleHREZWNvcmF0aW9uJyxcbiAgICAndmVydGljYWxhbGlnbic6ICd2ZXJ0aWNhbEFsaWduJyxcbiAgICAndmlzaWJpbGl0eSc6ICd2aXNpYmlsaXR5JyxcbiAgICAnd2hpdGVzcGFjZSc6ICd3aGl0ZVNwYWNlJyxcbiAgICAnd2lkdGgnOiAnd2lkdGgnLFxuICAgICd3b3JkYnJlYWsnOiAnd29yZGJyZWFrJyxcbiAgICAnemluZGV4JzogJ3pJbmRleCdcbn07XG5cbmV4cG9ydCBjb25zdCBpc1N0eWxlID0ga2V5ID0+ICEhcHJvcE5hbWVDU1NLZXlNYXBba2V5XTtcblxuY29uc3QgTUFQX1NIRUxMX1RZUEVfSUdOT1JFX0xJU1QgPSB7XG4gICAgaGVpZ2h0OiB0cnVlLFxuICAgIG92ZXJmbG93OiB0cnVlLFxuICAgIHBhZGRpbmc6IHRydWUsXG4gICAgcGFkZGluZ2JvdHRvbTogdHJ1ZSxcbiAgICBwYWRkaW5nbGVmdDogdHJ1ZSxcbiAgICBwYWRkaW5ncmlnaHQ6IHRydWUsXG4gICAgcGFkZGluZ3RvcDogdHJ1ZVxufTtcblxuY29uc3QgTUFQX0NPTlRBSU5FUl9UWVBFX0lHTk9SRV9MSVNUID0ge1xuICAgIHRleHRhbGlnbjogdHJ1ZVxufTtcblxuY29uc3QgTUFQX1NDUk9MTEFCTEVfQ09OVEFJTkVSX1RZUEVfSUdOT1JFX0xJU1QgPSB7XG4gICAgdGV4dGFsaWduOiB0cnVlLFxuICAgIHdpZHRoOiB0cnVlXG59O1xuXG5cbmV4cG9ydCBmdW5jdGlvbiBzdHlsZXIoJG5vZGU6IEhUTUxFbGVtZW50LCBjb21wb25lbnQ6IFN0eWxhYmxlQ29tcG9uZW50LCB0eXBlPzogQVBQTFlfU1RZTEVTX1RZUEUsIHNraXBMaXN0PzogQXJyYXk8c3RyaW5nPikge1xuICAgIC8vIGFwcGx5IGluaXQgc3R5bGVzO1xuICAgIGNvbnN0IHNraXBMaXN0TWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICBpZiAoc2tpcExpc3QpIHtcbiAgICAgICAgc2tpcExpc3QuZm9yRWFjaChrID0+IHNraXBMaXN0TWFwW2tdID0gdHJ1ZSk7XG4gICAgfVxuXG4gICAgY29tcG9uZW50LnJlZ2lzdGVyU3R5bGVDaGFuZ2VMaXN0ZW5lcigoa2V5LCBudikgPT4ge1xuXG4gICAgICAgIGlmIChza2lwTGlzdE1hcFtrZXldKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiB0aGUgdHlwZSBpcyBgc2hlbGxgIGFuZCB0aGUga2V5IGlzIGluIHRoZSBTSEVMTF9UWVBFX0lHTk9SRV9MSVNULCByZXR1cm5cbiAgICAgICAgaWYgKHR5cGUgPT09IEFQUExZX1NUWUxFU19UWVBFLlNIRUxMICYmIE1BUF9TSEVMTF9UWVBFX0lHTk9SRV9MSVNUW2tleV0pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGlmIHRoZSB0eXBlIGlzIGBpbm5lci1zaGVsbGAgYW5kIHRoZSBrZXkgaXMgTk9UIGluIHRoZSBTSEVMTF9UWVBFX0lHTk9SRV9MSVNULCByZXR1cm5cbiAgICAgICAgaWYgKHR5cGUgPT09IEFQUExZX1NUWUxFU19UWVBFLklOTkVSX1NIRUxMKSB7XG4gICAgICAgICAgICBpZiAoIU1BUF9TSEVMTF9UWVBFX0lHTk9SRV9MSVNUW2tleV0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoa2V5ID09PSAnaGVpZ2h0Jykge1xuICAgICAgICAgICAgICAgIHNldENTUygkbm9kZSwgJ292ZXJmbG93JywgbnYgPyAnYXV0bycgOiAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiB0aGUgdHlwZSBpcyBgY29udGFpbmVyYCBhbmQgdGhlIGtleSBpcyBpbiB0aGUgQ09OVEFJTkVSX1RZUEVfSUdOT1JFX0xJU1QsIHJldHVyblxuICAgICAgICBpZiAodHlwZSA9PT0gQVBQTFlfU1RZTEVTX1RZUEUuQ09OVEFJTkVSICYmIE1BUF9DT05UQUlORVJfVFlQRV9JR05PUkVfTElTVFtrZXldKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZSA9PT0gQVBQTFlfU1RZTEVTX1RZUEUuU0NST0xMQUJMRV9DT05UQUlORVIpIHtcbiAgICAgICAgICAgIGlmIChNQVBfU0NST0xMQUJMRV9DT05UQUlORVJfVFlQRV9JR05PUkVfTElTVFtrZXldKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoa2V5ID09PSAnaGVpZ2h0Jykge1xuICAgICAgICAgICAgICAgIHNldENTUygkbm9kZSwgJ292ZXJmbG93JywgbnYgPyAnYXV0bycgOiAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoa2V5ID09PSAnZm9udHNpemUnIHx8IGtleSA9PT0gJ2ZvbnR1bml0Jykge1xuICAgICAgICAgICAgc2V0Q1NTKCRub2RlLCAnZm9udFNpemUnLCBjb21wb25lbnQuZm9udHNpemUgPT09ICcnID8gJycgOiBjb21wb25lbnQuZm9udHNpemUgKyAoY29tcG9uZW50LmZvbnR1bml0IHx8ICdweCcpKTtcbiAgICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdiYWNrZ3JvdW5kaW1hZ2UnKSB7XG4gICAgICAgICAgICBzZXRDU1MoJG5vZGUsICdiYWNrZ3JvdW5kSW1hZ2UnLCBjb21wb25lbnQucGljdHVyZXNvdXJjZSB8fCBnZXRCYWNrR3JvdW5kSW1hZ2VVcmwobnYpKTtcbiAgICAgICAgfSBlbHNlIGlmIChwcm9wTmFtZUNTU0tleU1hcFtrZXldKSB7XG4gICAgICAgICAgICBzZXRDU1MoJG5vZGUsIHByb3BOYW1lQ1NTS2V5TWFwW2tleV0sIG52KTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuIl19