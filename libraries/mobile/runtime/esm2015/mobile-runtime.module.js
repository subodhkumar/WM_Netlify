import { HTTP_INTERCEPTORS } from '@angular/common/http';
import { NgModule } from '@angular/core';
import { AppVersion } from '@ionic-native/app-version';
import { BarcodeScanner } from '@ionic-native/barcode-scanner';
import { Calendar } from '@ionic-native/calendar';
import { Camera } from '@ionic-native/camera';
import { Contacts } from '@ionic-native/contacts';
import { File } from '@ionic-native/file';
import { FileOpener } from '@ionic-native/file-opener';
import { Device } from '@ionic-native/device';
import { MediaCapture } from '@ionic-native/media-capture';
import { Geolocation } from '@ionic-native/geolocation';
import { Network } from '@ionic-native/network';
import { SQLite } from '@ionic-native/sqlite';
import { Vibration } from '@ionic-native/vibration';
import { App, AbstractHttpService, fetchContent, hasCordova, insertAfter, isIpad, isIphone, isIpod, isObject, loadStyleSheet, noop, removeNode } from '@wm/core';
import { FileExtensionFromMimePipe } from '@wm/components';
import { WmMobileComponentsModule } from '@wm/mobile/components';
import { DeviceFileOpenerService, DeviceService, ExtAppMessageService, MobileCoreModule, NetworkService } from '@wm/mobile/core';
import { PushService, PushServiceImpl } from '@wm/mobile/offline';
import { SecurityService } from '@wm/security';
import { VariablesModule } from '@wm/mobile/variables';
import { $rootScope, CONSTANTS } from '@wm/variables';
import { AppExtComponent } from './components/app-ext.component';
import { CookieService } from './services/cookie.service';
import { MobileHttpInterceptor } from './services/http-interceptor.service';
import { WebProcessService } from './services/webprocess.service';
export const MAX_WAIT_TIME_4_OAUTH_MESSAGE = 60000;
var OS;
(function (OS) {
    OS["IOS"] = "ios";
    OS["ANDROID"] = "android";
})(OS || (OS = {}));
const MINIMUM_TAB_WIDTH = 768;
const KEYBOARD_CLASS = 'keyboard';
const ionicServices = [
    AppVersion,
    BarcodeScanner,
    Calendar,
    Camera,
    Contacts,
    File,
    FileOpener,
    Device,
    Geolocation,
    MediaCapture,
    Network,
    SQLite,
    Vibration
];
export class MobileRuntimeModule {
    constructor(app, cookieService, deviceFileOpenerService, deviceService, securityService, httpService, extAppMessageService, networkService, webProcessService) {
        this.app = app;
        this.cookieService = cookieService;
        this.deviceFileOpenerService = deviceFileOpenerService;
        this.deviceService = deviceService;
        this.securityService = securityService;
        this.httpService = httpService;
        this.extAppMessageService = extAppMessageService;
        this.networkService = networkService;
        this.webProcessService = webProcessService;
        this._$appEl = $('.wm-app:first');
        if (this._$appEl.width() >= MINIMUM_TAB_WIDTH) {
            app.isTabletApplicationType = true;
            this._$appEl.addClass('wm-tablet-app');
        }
        else {
            this._$appEl.addClass('wm-mobile-app');
        }
        MobileRuntimeModule.initializeRuntime(this, this.app, this.cookieService, this.deviceFileOpenerService, this.deviceService);
    }
    static forRoot() {
        /* add all providers that are required for mobile here. This is to simplify placeholder.*/
        return {
            ngModule: MobileRuntimeModule,
            providers: [
                WebProcessService,
                {
                    provide: HTTP_INTERCEPTORS,
                    useClass: MobileHttpInterceptor,
                    multi: true
                },
                ...ionicServices,
                FileExtensionFromMimePipe,
                { provide: PushService, useClass: PushServiceImpl }
            ]
        };
    }
    // Startup services have to be added only once in the app life-cycle.
    static initializeRuntime(runtimeModule, app, cookieService, deviceFileOpenerService, deviceService) {
        if (this.initialized) {
            return;
        }
        this.initialized = true;
        app.deployedUrl = runtimeModule.getDeployedUrl();
        runtimeModule.getDeviceOS().then(os => {
            app.selectedViewPort = {
                os: os
            };
            runtimeModule.applyOSTheme(os);
        });
        if (hasCordova()) {
            runtimeModule.handleKeyBoardClass();
            deviceService.addStartUpService(cookieService);
            app.subscribe('userLoggedIn', () => {
                let url = $rootScope.project.deployedUrl;
                if (url.endsWith('/')) {
                    url = url.substr(0, url.length - 1);
                }
                cookieService.persistCookie(url, 'JSESSIONID').catch(noop);
                cookieService.persistCookie(url, 'SPRING_SECURITY_REMEMBER_ME_COOKIE').catch(noop);
            });
            app.subscribe('device-file-download', (data) => {
                deviceFileOpenerService.openRemoteFile(data.url, data.extension, data.name).then(data.successCb, data.errorCb);
            });
            const __zone_symbol__FileReader = window['__zone_symbol__FileReader'];
            if (__zone_symbol__FileReader && __zone_symbol__FileReader.READ_CHUNK_SIZE) {
                // cordova File Reader is required. Otherwise, file operations are failing.
                window['FileReader'] = __zone_symbol__FileReader;
            }
            if (!CONSTANTS.isWaveLens) {
                window.remoteSync = (flag = true) => {
                    localStorage.setItem('remoteSync', flag ? 'true' : 'false');
                };
            }
            runtimeModule.addAuthInBrowser();
        }
        deviceService.start();
        deviceService.whenReady().then(() => {
            if (hasCordova()) {
                runtimeModule._$appEl.addClass('cordova');
                runtimeModule.exposeOAuthService();
                navigator.splashscreen.hide();
                // Fix for issue: ios device is not considering the background style, eventhough value is set in config.xml.
                if (window['StatusBar']) {
                    window['StatusBar'].overlaysWebView(false);
                }
            }
        });
    }
    exposeOAuthService() {
        window['OAuthInMobile'] = (providerId) => {
            return new Promise((resolve, reject) => {
                const oauthAdress = '^services/oauth/' + providerId + '$';
                const deregister = this.extAppMessageService.subscribe(oauthAdress, message => {
                    resolve(message.data['access_token']);
                    deregister();
                    clearTimeout(timerId);
                });
                const timerId = setTimeout(function () {
                    deregister();
                    reject(`Time out for oauth message after ${MAX_WAIT_TIME_4_OAUTH_MESSAGE % 1000} seconds`);
                }, MAX_WAIT_TIME_4_OAUTH_MESSAGE);
            });
        };
        const handleOpenURL = window['handleOpenURL'];
        handleOpenURL.isReady = true;
        handleOpenURL(handleOpenURL.lastURL);
    }
    applyOSTheme(os) {
        let oldStyleSheet = $('link[theme="wmtheme"]:first');
        const themeUrl = oldStyleSheet.attr('href').replace(new RegExp('/[a-z]*/style.css$'), `/${os.toLowerCase()}/style.css`), newStyleSheet = loadStyleSheet(themeUrl, { name: 'theme', value: 'wmtheme' });
        oldStyleSheet = oldStyleSheet.length > 0 && oldStyleSheet[0];
        if (newStyleSheet && oldStyleSheet) {
            insertAfter(newStyleSheet, oldStyleSheet);
            removeNode(oldStyleSheet);
        }
    }
    handleKeyBoardClass() {
        const initialScreenSize = window.innerHeight;
        // keyboard class is added when keyboard is open.
        window.addEventListener('resize', () => {
            if (window.innerHeight < initialScreenSize) {
                this._$appEl.addClass(KEYBOARD_CLASS);
            }
            else {
                this._$appEl.removeClass(KEYBOARD_CLASS);
            }
        });
    }
    getDeployedUrl() {
        const waveLensAppUrl = window['WaveLens'] && window['WaveLens']['appUrl'];
        let deployedUrl = $rootScope.project.deployedUrl;
        if (hasCordova()) {
            if (waveLensAppUrl) {
                // TODO: Temporary Fix for WMS-13072, baseUrl is {{DEVELOPMENT_URL}} in wavelens
                deployedUrl = waveLensAppUrl;
            }
            else {
                fetchContent('json', './config.json', true, (response => {
                    if (!response.error && response.baseUrl) {
                        deployedUrl = response.baseUrl;
                    }
                }));
            }
        }
        if (!deployedUrl.endsWith('/')) {
            deployedUrl = deployedUrl + '/';
        }
        $rootScope.project.deployedUrl = deployedUrl;
        return deployedUrl;
    }
    getDeviceOS() {
        return new Promise(function (resolve, reject) {
            const msgContent = { key: 'on-load' };
            // Notify preview window that application is ready. Otherwise, identify the OS.
            if (window.top !== window) {
                window.top.postMessage(msgContent, '*');
                // This is for preview page
                window.onmessage = function (msg) {
                    const data = msg.data;
                    if (isObject(data) && data.key === 'switch-device') {
                        resolve(data.device.os);
                    }
                };
            }
            else if (isIphone() || isIpod() || isIpad()) {
                resolve(OS.IOS);
            }
            else {
                resolve(OS.ANDROID);
            }
        });
    }
    addAuthInBrowser() {
        this.securityService.authInBrowser = () => {
            if (!this.networkService.isConnected()) {
                return Promise.reject('In offline, app cannot contact the server.');
            }
            return this.webProcessService.execute('LOGIN', '/')
                .then(output => {
                let url = this.app.deployedUrl;
                if (url.endsWith('/')) {
                    url = url.substr(0, url.length - 1);
                }
                output = JSON.parse(output);
                if (output[CONSTANTS.XSRF_COOKIE_NAME]) {
                    localStorage.setItem(CONSTANTS.XSRF_COOKIE_NAME, output[CONSTANTS.XSRF_COOKIE_NAME]);
                }
                return this.cookieService.clearAll()
                    .then(() => {
                    const promises = _.keys(output).map(k => {
                        return this.cookieService.setCookie(url, k, output[k]);
                    });
                    return Promise.all(promises);
                });
            })
                .then(() => this.app.notify('userLoggedIn', {}));
        };
    }
}
MobileRuntimeModule.initialized = false;
MobileRuntimeModule.decorators = [
    { type: NgModule, args: [{
                declarations: [
                    AppExtComponent
                ],
                exports: [
                    AppExtComponent,
                    WmMobileComponentsModule
                ],
                imports: [
                    MobileCoreModule,
                    VariablesModule,
                    WmMobileComponentsModule
                ],
                bootstrap: []
            },] }
];
/** @nocollapse */
MobileRuntimeModule.ctorParameters = () => [
    { type: App },
    { type: CookieService },
    { type: DeviceFileOpenerService },
    { type: DeviceService },
    { type: SecurityService },
    { type: AbstractHttpService },
    { type: ExtAppMessageService },
    { type: NetworkService },
    { type: WebProcessService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9iaWxlLXJ1bnRpbWUubW9kdWxlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHdtL21vYmlsZS9ydW50aW1lLyIsInNvdXJjZXMiOlsibW9iaWxlLXJ1bnRpbWUubW9kdWxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3pELE9BQU8sRUFBdUIsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTlELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDL0QsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ2xELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUM5QyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDbEQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDOUMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzNELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDaEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUdwRCxPQUFPLEVBQ0gsR0FBRyxFQUNILG1CQUFtQixFQUNuQixZQUFZLEVBQ1osVUFBVSxFQUNWLFdBQVcsRUFDWCxNQUFNLEVBQ04sUUFBUSxFQUNSLE1BQU0sRUFDTixRQUFRLEVB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QUFlO1lBaEJwQixtQkFBbUI7WUFjMEIsb0JBQW9CO1lBQW9CLGNBQWM7WUFTOUYsaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSFRUUF9JTlRFUkNFUFRPUlMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBNb2R1bGVXaXRoUHJvdmlkZXJzLCBOZ01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBBcHBWZXJzaW9uIH0gZnJvbSAnQGlvbmljLW5hdGl2ZS9hcHAtdmVyc2lvbic7XG5pbXBvcnQgeyBCYXJjb2RlU2Nhbm5lciB9IGZyb20gJ0Bpb25pYy1uYXRpdmUvYmFyY29kZS1zY2FubmVyJztcbmltcG9ydCB7IENhbGVuZGFyIH0gZnJvbSAnQGlvbmljLW5hdGl2ZS9jYWxlbmRhcic7XG5pbXBvcnQgeyBDYW1lcmEgfSBmcm9tICdAaW9uaWMtbmF0aXZlL2NhbWVyYSc7XG5pbXBvcnQgeyBDb250YWN0cyB9IGZyb20gJ0Bpb25pYy1uYXRpdmUvY29udGFjdHMnO1xuaW1wb3J0IHsgRmlsZSB9IGZyb20gJ0Bpb25pYy1uYXRpdmUvZmlsZSc7XG5pbXBvcnQgeyBGaWxlT3BlbmVyIH0gZnJvbSAnQGlvbmljLW5hdGl2ZS9maWxlLW9wZW5lcic7XG5pbXBvcnQgeyBEZXZpY2UgfSBmcm9tICdAaW9uaWMtbmF0aXZlL2RldmljZSc7XG5pbXBvcnQgeyBNZWRpYUNhcHR1cmUgfSBmcm9tICdAaW9uaWMtbmF0aXZlL21lZGlhLWNhcHR1cmUnO1xuaW1wb3J0IHsgR2VvbG9jYXRpb24gfSBmcm9tICdAaW9uaWMtbmF0aXZlL2dlb2xvY2F0aW9uJztcbmltcG9ydCB7IE5ldHdvcmsgfSBmcm9tICdAaW9uaWMtbmF0aXZlL25ldHdvcmsnO1xuaW1wb3J0IHsgU1FMaXRlIH0gZnJvbSAnQGlvbmljLW5hdGl2ZS9zcWxpdGUnO1xuaW1wb3J0IHsgVmlicmF0aW9uIH0gZnJvbSAnQGlvbmljLW5hdGl2ZS92aWJyYXRpb24nO1xuXG5cbmltcG9ydCB7XG4gICAgQXBwLFxuICAgIEFic3RyYWN0SHR0cFNlcnZpY2UsXG4gICAgZmV0Y2hDb250ZW50LFxuICAgIGhhc0NvcmRvdmEsXG4gICAgaW5zZXJ0QWZ0ZXIsXG4gICAgaXNJcGFkLFxuICAgIGlzSXBob25lLFxuICAgIGlzSXBvZCxcbiAgICBpc09iamVjdCxcbiAgICBsb2FkU3R5bGVTaGVldCxcbiAgICBub29wLFxuICAgIHJlbW92ZU5vZGVcbn0gZnJvbSAnQHdtL2NvcmUnO1xuaW1wb3J0IHsgRmlsZUV4dGVuc2lvbkZyb21NaW1lUGlwZSB9IGZyb20gJ0B3bS9jb21wb25lbnRzJztcbmltcG9ydCB7IFdtTW9iaWxlQ29tcG9uZW50c01vZHVsZSB9IGZyb20gJ0B3bS9tb2JpbGUvY29tcG9uZW50cyc7XG5pbXBvcnQgeyBEZXZpY2VGaWxlT3BlbmVyU2VydmljZSwgRGV2aWNlU2VydmljZSwgRXh0QXBwTWVzc2FnZVNlcnZpY2UsIE1vYmlsZUNvcmVNb2R1bGUsIE5ldHdvcmtTZXJ2aWNlIH0gZnJvbSAnQHdtL21vYmlsZS9jb3JlJztcbmltcG9ydCB7IFB1c2hTZXJ2aWNlLCBQdXNoU2VydmljZUltcGwgfSBmcm9tICdAd20vbW9iaWxlL29mZmxpbmUnO1xuaW1wb3J0IHsgU2VjdXJpdHlTZXJ2aWNlIH0gZnJvbSAnQHdtL3NlY3VyaXR5JztcbmltcG9ydCB7IFZhcmlhYmxlc01vZHVsZSB9IGZyb20gJ0B3bS9tb2JpbGUvdmFyaWFibGVzJztcbmltcG9ydCB7ICRyb290U2NvcGUsIENPTlNUQU5UUyB9IGZyb20gJ0B3bS92YXJpYWJsZXMnO1xuXG5pbXBvcnQgeyBBcHBFeHRDb21wb25lbnQgfSBmcm9tICcuL2NvbXBvbmVudHMvYXBwLWV4dC5jb21wb25lbnQnO1xuaW1wb3J0IHsgQ29va2llU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvY29va2llLnNlcnZpY2UnO1xuaW1wb3J0IHsgTW9iaWxlSHR0cEludGVyY2VwdG9yIH0gZnJvbSAnLi9zZXJ2aWNlcy9odHRwLWludGVyY2VwdG9yLnNlcnZpY2UnO1xuaW1wb3J0IHsgV2ViUHJvY2Vzc1NlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL3dlYnByb2Nlc3Muc2VydmljZSc7XG5cbmRlY2xhcmUgY29uc3QgJCwgbmF2aWdhdG9yLCBfO1xuXG5leHBvcnQgY29uc3QgTUFYX1dBSVRfVElNRV80X09BVVRIX01FU1NBR0UgPSA2MDAwMDtcblxuZW51bSBPUyB7XG4gICAgSU9TID0gJ2lvcycsXG4gICAgQU5EUk9JRCA9ICdhbmRyb2lkJ1xufVxuY29uc3QgTUlOSU1VTV9UQUJfV0lEVEggPSA3Njg7XG5jb25zdCBLRVlCT0FSRF9DTEFTUyA9ICdrZXlib2FyZCc7XG5cbmNvbnN0IGlvbmljU2VydmljZXMgPSBbXG4gICAgQXBwVmVyc2lvbixcbiAgICBCYXJjb2RlU2Nhbm5lcixcbiAgICBDYWxlbmRhcixcbiAgICBDYW1lcmEsXG4gICAgQ29udGFjdHMsXG4gICAgRmlsZSxcbiAgICBGaWxlT3BlbmVyLFxuICAgIERldmljZSxcbiAgICBHZW9sb2NhdGlvbixcbiAgICBNZWRpYUNhcHR1cmUsXG4gICAgTmV0d29yayxcbiAgICBTUUxpdGUsXG4gICAgVmlicmF0aW9uXG5dO1xuXG5ATmdNb2R1bGUoe1xuICAgIGRlY2xhcmF0aW9uczogW1xuICAgICAgICBBcHBFeHRDb21wb25lbnRcbiAgICBdLFxuICAgIGV4cG9ydHM6IFtcbiAgICAgICAgQXBwRXh0Q29tcG9uZW50LFxuICAgICAgICBXbU1vYmlsZUNvbXBvbmVudHNNb2R1bGVcbiAgICBdLFxuICAgIGltcG9ydHM6IFtcbiAgICAgICAgTW9iaWxlQ29yZU1vZHVsZSxcbiAgICAgICAgVmFyaWFibGVzTW9kdWxlLFxuICAgICAgICBXbU1vYmlsZUNvbXBvbmVudHNNb2R1bGVcbiAgICBdLFxuICAgIGJvb3RzdHJhcDogW11cbn0pXG5leHBvcnQgY2xhc3MgTW9iaWxlUnVudGltZU1vZHVsZSB7XG5cbiAgICBzdGF0aWMgZm9yUm9vdCgpOiBNb2R1bGVXaXRoUHJvdmlkZXJzIHtcbiAgICAgICAgLyogYWRkIGFsbCBwcm92aWRlcnMgdGhhdCBhcmUgcmVxdWlyZWQgZm9yIG1vYmlsZSBoZXJlLiBUaGlzIGlzIHRvIHNpbXBsaWZ5IHBsYWNlaG9sZGVyLiovXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuZ01vZHVsZTogTW9iaWxlUnVudGltZU1vZHVsZSxcbiAgICAgICAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICAgICAgICAgIFdlYlByb2Nlc3NTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZTogSFRUUF9JTlRFUkNFUFRPUlMsXG4gICAgICAgICAgICAgICAgICAgIHVzZUNsYXNzOiBNb2JpbGVIdHRwSW50ZXJjZXB0b3IsXG4gICAgICAgICAgICAgICAgICAgIG11bHRpOiB0cnVlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAuLi5pb25pY1NlcnZpY2VzLFxuICAgICAgICAgICAgICAgIEZpbGVFeHRlbnNpb25Gcm9tTWltZVBpcGUsXG4gICAgICAgICAgICAgICAge3Byb3ZpZGU6IFB1c2hTZXJ2aWNlLCB1c2VDbGFzczogUHVzaFNlcnZpY2VJbXBsfVxuICAgICAgICAgICAgXVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGluaXRpYWxpemVkID0gZmFsc2U7XG4gICAgLy8gU3RhcnR1cCBzZXJ2aWNlcyBoYXZlIHRvIGJlIGFkZGVkIG9ubHkgb25jZSBpbiB0aGUgYXBwIGxpZmUtY3ljbGUuXG4gICAgcHJpdmF0ZSBzdGF0aWMgaW5pdGlhbGl6ZVJ1bnRpbWUocnVudGltZU1vZHVsZTogTW9iaWxlUnVudGltZU1vZHVsZSxcbiAgICAgICAgICAgICAgICAgICAgICBhcHA6IEFwcCxcbiAgICAgICAgICAgICAgICAgICAgICBjb29raWVTZXJ2aWNlOiBDb29raWVTZXJ2aWNlLFxuICAgICAgICAgICAgICAgICAgICAgIGRldmljZUZpbGVPcGVuZXJTZXJ2aWNlOiBEZXZpY2VGaWxlT3BlbmVyU2VydmljZSxcbiAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VTZXJ2aWNlOiBEZXZpY2VTZXJ2aWNlKSB7XG4gICAgICAgIGlmICh0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgIGFwcC5kZXBsb3llZFVybCA9IHJ1bnRpbWVNb2R1bGUuZ2V0RGVwbG95ZWRVcmwoKTtcbiAgICAgICAgcnVudGltZU1vZHVsZS5nZXREZXZpY2VPUygpLnRoZW4ob3MgPT4ge1xuICAgICAgICAgICAgYXBwLnNlbGVjdGVkVmlld1BvcnQgPSB7XG4gICAgICAgICAgICAgICAgb3M6IG9zXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcnVudGltZU1vZHVsZS5hcHBseU9TVGhlbWUob3MpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGhhc0NvcmRvdmEoKSkge1xuICAgICAgICAgICAgcnVudGltZU1vZHVsZS5oYW5kbGVLZXlCb2FyZENsYXNzKCk7XG4gICAgICAgICAgICBkZXZpY2VTZXJ2aWNlLmFkZFN0YXJ0VXBTZXJ2aWNlKGNvb2tpZVNlcnZpY2UpO1xuICAgICAgICAgICAgYXBwLnN1YnNjcmliZSgndXNlckxvZ2dlZEluJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCB1cmwgPSAkcm9vdFNjb3BlLnByb2plY3QuZGVwbG95ZWRVcmw7XG4gICAgICAgICAgICAgICAgaWYgKHVybC5lbmRzV2l0aCgnLycpKSB7XG4gICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5zdWJzdHIoMCwgdXJsLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb29raWVTZXJ2aWNlLnBlcnNpc3RDb29raWUodXJsLCAnSlNFU1NJT05JRCcpLmNhdGNoKG5vb3ApO1xuICAgICAgICAgICAgICAgIGNvb2tpZVNlcnZpY2UucGVyc2lzdENvb2tpZSh1cmwsICdTUFJJTkdfU0VDVVJJVFlfUkVNRU1CRVJfTUVfQ09PS0lFJykuY2F0Y2gobm9vcCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGFwcC5zdWJzY3JpYmUoJ2RldmljZS1maWxlLWRvd25sb2FkJywgKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICBkZXZpY2VGaWxlT3BlbmVyU2VydmljZS5vcGVuUmVtb3RlRmlsZShkYXRhLnVybCwgZGF0YS5leHRlbnNpb24sIGRhdGEubmFtZSkudGhlbihkYXRhLnN1Y2Nlc3NDYiwgZGF0YS5lcnJvckNiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgX196b25lX3N5bWJvbF9fRmlsZVJlYWRlciA9IHdpbmRvd1snX196b25lX3N5bWJvbF9fRmlsZVJlYWRlciddO1xuICAgICAgICAgICAgaWYgKF9fem9uZV9zeW1ib2xfX0ZpbGVSZWFkZXIgJiYgX196b25lX3N5bWJvbF9fRmlsZVJlYWRlci5SRUFEX0NIVU5LX1NJWkUpIHtcbiAgICAgICAgICAgICAgICAvLyBjb3Jkb3ZhIEZpbGUgUmVhZGVyIGlzIHJlcXVpcmVkLiBPdGhlcndpc2UsIGZpbGUgb3BlcmF0aW9ucyBhcmUgZmFpbGluZy5cbiAgICAgICAgICAgICAgICB3aW5kb3dbJ0ZpbGVSZWFkZXInXSA9IF9fem9uZV9zeW1ib2xfX0ZpbGVSZWFkZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIUNPTlNUQU5UUy5pc1dhdmVMZW5zKSB7XG4gICAgICAgICAgICAgICAgKHdpbmRvdyBhcyBhbnkpLnJlbW90ZVN5bmMgPSAoZmxhZyA9IHRydWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3JlbW90ZVN5bmMnLCBmbGFnID8gJ3RydWUnIDogJ2ZhbHNlJyk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJ1bnRpbWVNb2R1bGUuYWRkQXV0aEluQnJvd3NlcigpO1xuICAgICAgICB9XG4gICAgICAgIGRldmljZVNlcnZpY2Uuc3RhcnQoKTtcbiAgICAgICAgZGV2aWNlU2VydmljZS53aGVuUmVhZHkoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGlmIChoYXNDb3Jkb3ZhKCkpIHtcbiAgICAgICAgICAgICAgICBydW50aW1lTW9kdWxlLl8kYXBwRWwuYWRkQ2xhc3MoJ2NvcmRvdmEnKTtcbiAgICAgICAgICAgICAgICBydW50aW1lTW9kdWxlLmV4cG9zZU9BdXRoU2VydmljZSgpO1xuICAgICAgICAgICAgICAgIG5hdmlnYXRvci5zcGxhc2hzY3JlZW4uaGlkZSgpO1xuICAgICAgICAgICAgICAgIC8vIEZpeCBmb3IgaXNzdWU6IGlvcyBkZXZpY2UgaXMgbm90IGNvbnNpZGVyaW5nIHRoZSBiYWNrZ3JvdW5kIHN0eWxlLCBldmVudGhvdWdoIHZhbHVlIGlzIHNldCBpbiBjb25maWcueG1sLlxuICAgICAgICAgICAgICAgIGlmICh3aW5kb3dbJ1N0YXR1c0JhciddKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvd1snU3RhdHVzQmFyJ10ub3ZlcmxheXNXZWJWaWV3KGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgXyRhcHBFbDtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGFwcDogQXBwLFxuICAgICAgICBwcml2YXRlIGNvb2tpZVNlcnZpY2U6IENvb2tpZVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgZGV2aWNlRmlsZU9wZW5lclNlcnZpY2U6IERldmljZUZpbGVPcGVuZXJTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGRldmljZVNlcnZpY2U6IERldmljZVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgc2VjdXJpdHlTZXJ2aWNlOiBTZWN1cml0eVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgaHR0cFNlcnZpY2U6IEFic3RyYWN0SHR0cFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgZXh0QXBwTWVzc2FnZVNlcnZpY2U6IEV4dEFwcE1lc3NhZ2VTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIG5ldHdvcmtTZXJ2aWNlOiBOZXR3b3JrU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSB3ZWJQcm9jZXNzU2VydmljZTogV2ViUHJvY2Vzc1NlcnZpY2VcbiAgICApIHtcbiAgICAgICAgdGhpcy5fJGFwcEVsID0gJCgnLndtLWFwcDpmaXJzdCcpO1xuICAgICAgICBpZiAodGhpcy5fJGFwcEVsLndpZHRoKCkgPj0gTUlOSU1VTV9UQUJfV0lEVEgpIHtcbiAgICAgICAgICAgIGFwcC5pc1RhYmxldEFwcGxpY2F0aW9uVHlwZSA9ICB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fJGFwcEVsLmFkZENsYXNzKCd3bS10YWJsZXQtYXBwJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl8kYXBwRWwuYWRkQ2xhc3MoJ3dtLW1vYmlsZS1hcHAnKTtcbiAgICAgICAgfVxuICAgICAgICBNb2JpbGVSdW50aW1lTW9kdWxlLmluaXRpYWxpemVSdW50aW1lKHRoaXMsIHRoaXMuYXBwLCB0aGlzLmNvb2tpZVNlcnZpY2UsIHRoaXMuZGV2aWNlRmlsZU9wZW5lclNlcnZpY2UsIHRoaXMuZGV2aWNlU2VydmljZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBleHBvc2VPQXV0aFNlcnZpY2UoKSB7XG4gICAgICAgIHdpbmRvd1snT0F1dGhJbk1vYmlsZSddID0gKHByb3ZpZGVySWQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBvYXV0aEFkcmVzcyA9ICdec2VydmljZXMvb2F1dGgvJyArIHByb3ZpZGVySWQgKyAnJCc7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVyZWdpc3RlciA9IHRoaXMuZXh0QXBwTWVzc2FnZVNlcnZpY2Uuc3Vic2NyaWJlKG9hdXRoQWRyZXNzLCBtZXNzYWdlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobWVzc2FnZS5kYXRhWydhY2Nlc3NfdG9rZW4nXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXJlZ2lzdGVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXJJZCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVySWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVyZWdpc3RlcigpO1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoYFRpbWUgb3V0IGZvciBvYXV0aCBtZXNzYWdlIGFmdGVyICR7TUFYX1dBSVRfVElNRV80X09BVVRIX01FU1NBR0UgJSAxMDAwfSBzZWNvbmRzYCk7XG4gICAgICAgICAgICAgICAgfSwgTUFYX1dBSVRfVElNRV80X09BVVRIX01FU1NBR0UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGhhbmRsZU9wZW5VUkwgPSB3aW5kb3dbJ2hhbmRsZU9wZW5VUkwnXTtcbiAgICAgICAgaGFuZGxlT3BlblVSTC5pc1JlYWR5ID0gdHJ1ZTtcbiAgICAgICAgaGFuZGxlT3BlblVSTChoYW5kbGVPcGVuVVJMLmxhc3RVUkwpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXBwbHlPU1RoZW1lKG9zKSB7XG4gICAgICAgIGxldCBvbGRTdHlsZVNoZWV0ID0gJCgnbGlua1t0aGVtZT1cIndtdGhlbWVcIl06Zmlyc3QnKTtcbiAgICAgICAgY29uc3QgdGhlbWVVcmwgPSBvbGRTdHlsZVNoZWV0LmF0dHIoJ2hyZWYnKS5yZXBsYWNlKG5ldyBSZWdFeHAoJy9bYS16XSovc3R5bGUuY3NzJCcpLCBgLyR7b3MudG9Mb3dlckNhc2UoKX0vc3R5bGUuY3NzYCksXG4gICAgICAgICAgICBuZXdTdHlsZVNoZWV0ID0gbG9hZFN0eWxlU2hlZXQodGhlbWVVcmwsIHtuYW1lOiAndGhlbWUnLCB2YWx1ZTogJ3dtdGhlbWUnfSk7XG4gICAgICAgIG9sZFN0eWxlU2hlZXQgPSBvbGRTdHlsZVNoZWV0Lmxlbmd0aCA+IDAgJiYgb2xkU3R5bGVTaGVldFswXTtcbiAgICAgICAgaWYgKG5ld1N0eWxlU2hlZXQgJiYgb2xkU3R5bGVTaGVldCkge1xuICAgICAgICAgICAgaW5zZXJ0QWZ0ZXIobmV3U3R5bGVTaGVldCwgb2xkU3R5bGVTaGVldCk7XG4gICAgICAgICAgICByZW1vdmVOb2RlKG9sZFN0eWxlU2hlZXQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoYW5kbGVLZXlCb2FyZENsYXNzKCkge1xuICAgICAgICBjb25zdCBpbml0aWFsU2NyZWVuU2l6ZSA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICAgICAgLy8ga2V5Ym9hcmQgY2xhc3MgaXMgYWRkZWQgd2hlbiBrZXlib2FyZCBpcyBvcGVuLlxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5pbm5lckhlaWdodCA8IGluaXRpYWxTY3JlZW5TaXplKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fJGFwcEVsLmFkZENsYXNzKEtFWUJPQVJEX0NMQVNTKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fJGFwcEVsLnJlbW92ZUNsYXNzKEtFWUJPQVJEX0NMQVNTKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXREZXBsb3llZFVybCgpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCB3YXZlTGVuc0FwcFVybCA9IHdpbmRvd1snV2F2ZUxlbnMnXSAmJiB3aW5kb3dbJ1dhdmVMZW5zJ11bJ2FwcFVybCddO1xuICAgICAgICBsZXQgZGVwbG95ZWRVcmwgPSAkcm9vdFNjb3BlLnByb2plY3QuZGVwbG95ZWRVcmw7XG4gICAgICAgIGlmIChoYXNDb3Jkb3ZhKCkpIHtcbiAgICAgICAgICAgIGlmICh3YXZlTGVuc0FwcFVybCkge1xuICAgICAgICAgICAgICAgIC8vIFRPRE86IFRlbXBvcmFyeSBGaXggZm9yIFdNUy0xMzA3MiwgYmFzZVVybCBpcyB7e0RFVkVMT1BNRU5UX1VSTH19IGluIHdhdmVsZW5zXG4gICAgICAgICAgICAgICAgZGVwbG95ZWRVcmwgPSB3YXZlTGVuc0FwcFVybDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZmV0Y2hDb250ZW50KCdqc29uJywgJy4vY29uZmlnLmpzb24nLCB0cnVlLCAocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmVycm9yICYmIHJlc3BvbnNlLmJhc2VVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlcGxveWVkVXJsID0gcmVzcG9uc2UuYmFzZVVybDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRlcGxveWVkVXJsLmVuZHNXaXRoKCcvJykpIHtcbiAgICAgICAgICAgIGRlcGxveWVkVXJsID0gZGVwbG95ZWRVcmwgKyAnLyc7XG4gICAgICAgIH1cbiAgICAgICAgJHJvb3RTY29wZS5wcm9qZWN0LmRlcGxveWVkVXJsID0gZGVwbG95ZWRVcmw7XG4gICAgICAgIHJldHVybiBkZXBsb3llZFVybDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldERldmljZU9TKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxzdHJpbmc+KGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIGNvbnN0IG1zZ0NvbnRlbnQgPSB7a2V5OiAnb24tbG9hZCd9O1xuICAgICAgICAgICAgLy8gTm90aWZ5IHByZXZpZXcgd2luZG93IHRoYXQgYXBwbGljYXRpb24gaXMgcmVhZHkuIE90aGVyd2lzZSwgaWRlbnRpZnkgdGhlIE9TLlxuICAgICAgICAgICAgaWYgKHdpbmRvdy50b3AgIT09IHdpbmRvdykge1xuICAgICAgICAgICAgICAgIHdpbmRvdy50b3AucG9zdE1lc3NhZ2UobXNnQ29udGVudCwgJyonKTtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGZvciBwcmV2aWV3IHBhZ2VcbiAgICAgICAgICAgICAgICB3aW5kb3cub25tZXNzYWdlID0gZnVuY3Rpb24gKG1zZykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gbXNnLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc09iamVjdChkYXRhKSAmJiBkYXRhLmtleSA9PT0gJ3N3aXRjaC1kZXZpY2UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEuZGV2aWNlLm9zKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzSXBob25lKCkgfHwgaXNJcG9kKCkgfHwgaXNJcGFkKCkpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKE9TLklPUyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoT1MuQU5EUk9JRCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgYWRkQXV0aEluQnJvd3NlcigpIHtcbiAgICAgICAgdGhpcy5zZWN1cml0eVNlcnZpY2UuYXV0aEluQnJvd3NlciA9ICgpOiBQcm9taXNlPGFueT4gPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLm5ldHdvcmtTZXJ2aWNlLmlzQ29ubmVjdGVkKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ0luIG9mZmxpbmUsIGFwcCBjYW5ub3QgY29udGFjdCB0aGUgc2VydmVyLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMud2ViUHJvY2Vzc1NlcnZpY2UuZXhlY3V0ZSgnTE9HSU4nLCAnLycpXG4gICAgICAgICAgICAgICAgLnRoZW4ob3V0cHV0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHVybCA9IHRoaXMuYXBwLmRlcGxveWVkVXJsO1xuICAgICAgICAgICAgICAgICAgICBpZiAodXJsLmVuZHNXaXRoKCcvJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5zdWJzdHIoMCwgdXJsLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IEpTT04ucGFyc2Uob3V0cHV0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG91dHB1dFtDT05TVEFOVFMuWFNSRl9DT09LSUVfTkFNRV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKENPTlNUQU5UUy5YU1JGX0NPT0tJRV9OQU1FLCBvdXRwdXRbQ09OU1RBTlRTLlhTUkZfQ09PS0lFX05BTUVdKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb29raWVTZXJ2aWNlLmNsZWFyQWxsKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCAgcHJvbWlzZXMgPSBfLmtleXMob3V0cHV0KS5tYXAoayA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvb2tpZVNlcnZpY2Uuc2V0Q29va2llKHVybCwgaywgb3V0cHV0W2tdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLmFwcC5ub3RpZnkoJ3VzZXJMb2dnZWRJbicsIHt9KSk7XG4gICAgICAgIH07XG4gICAgfVxufVxuIl19