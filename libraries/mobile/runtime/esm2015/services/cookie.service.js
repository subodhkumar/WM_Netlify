import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
const STORAGE_KEY = 'wavemaker.persistedcookies';
export class CookieService {
    constructor() {
        this.cookieInfo = {};
        this.serviceName = 'CookeService';
    }
    persistCookie(hostname, cookieName, cookieValue) {
        return new Promise(resolve => {
            if (cookieValue) {
                resolve(cookieValue);
            }
            else {
                this.getCookie(hostname, cookieName)
                    .then(data => resolve(data.cookieValue));
            }
        }).then(value => {
            this.cookieInfo[hostname + '-' + cookieName] = {
                hostname: hostname.replace(/:[0-9]+/, ''),
                name: cookieName,
                value: this.rotateLTR(value)
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(this.cookieInfo));
        });
    }
    getCookie(hostname, cookieName) {
        return new Promise((resolve, reject) => {
            window['cookieEmperor'].getCookie(hostname, cookieName, resolve, reject);
        });
    }
    setCookie(hostname, cookieName, cookieValue) {
        return new Promise((resolve, reject) => {
            window['cookieEmperor'].setCookie(hostname, cookieName, cookieValue, resolve, reject);
        });
    }
    clearAll() {
        return new Promise((resolve, reject) => window['cookieEmperor'].clearAll(resolve, reject));
    }
    /**
     * Loads persisted cookies from local storage and adds them to the browser.
     * @returns {*}
     */
    start() {
        const cookieInfoStr = localStorage.getItem(STORAGE_KEY), promises = [];
        if (cookieInfoStr) {
            const cookieInfo = JSON.parse(cookieInfoStr);
            _.forEach(cookieInfo, c => {
                if (c.name && c.value) {
                    const promise = new Promise((resolve, reject) => {
                        window['cookieEmperor'].setCookie(c.hostname, c.name, this.rotateRTL(c.value), resolve, reject);
                    });
                    promises.push(promise);
                }
            });
        }
        return Promise.all(promises);
    }
    /**
     * Just rotates the given string exactly from 1/3 of string length in left to right direction.
     * @param str
     * @returns {string}
     */
    rotateLTR(str) {
        const arr = str.split(''), tArr = [], shift = Math.floor(str.length / 3);
        arr.forEach((v, i) => {
            tArr[(i + shift) % arr.length] = arr[i];
        });
        return tArr.join('');
    }
    /**
     * Just rotates the given string exactly from 1/3 of string length in  right to left direction..
     * @param str
     * @returns {string}
     */
    rotateRTL(str) {
        const arr = str.split(''), tArr = [], shift = Math.floor(str.length / 3);
        arr.forEach((v, i) => {
            tArr[(arr.length + i - shift) % arr.length] = arr[i];
        });
        return tArr.join('');
    }
}
CookieService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
CookieService.ngInjectableDef = i0.defineInjectable({ factory: function CookieService_Factory() { return new CookieService(); }, token: CookieService, providedIn: "root" });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29va2llLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ad20vbW9iaWxlL3J1bnRpbWUvIiwic291cmNlcyI6WyJzZXJ2aWNlcy9jb29raWUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQU0zQyxNQUFNLFdBQVcsR0FBRyw0QkFBNEIsQ0FBQztBQVdqRCxNQUFNLE9BQU8sYUFBYTtJQUgxQjtRQUtZLGVBQVUsR0FBRyxFQUFFLENBQUM7UUFFakIsZ0JBQVcsR0FBRyxjQUFjLENBQUM7S0FzRnZDO0lBcEZVLGFBQWEsQ0FBQyxRQUFnQixFQUFFLFVBQWtCLEVBQUUsV0FBb0I7UUFDM0UsT0FBTyxJQUFJLE9BQU8sQ0FBUyxPQUFPLENBQUMsRUFBRTtZQUM3QixJQUFJLFdBQVcsRUFBRTtnQkFDYixPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7YUFDeEI7aUJBQU07Z0JBQ0gsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsVUFBVSxDQUFDO3FCQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7YUFDaEQ7UUFDTCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDWixJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsR0FBRyxHQUFHLEdBQUcsVUFBVSxDQUFDLEdBQUc7Z0JBQzNDLFFBQVEsRUFBRSxRQUFRLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUM7Z0JBQ3pDLElBQUksRUFBRSxVQUFVO2dCQUNoQixLQUFLLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7YUFDL0IsQ0FBQztZQUNGLFlBQVksQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxD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QUFLLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUN2QyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekQsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDekIsQ0FBQzs7O1lBNUZKLFVBQVUsU0FBQztnQkFDUixVQUFVLEVBQUUsTUFBTTthQUNyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgSURldmljZVN0YXJ0VXBTZXJ2aWNlIH0gZnJvbSAnQHdtL21vYmlsZS9jb3JlJztcblxuZGVjbGFyZSBjb25zdCBfO1xuXG5jb25zdCBTVE9SQUdFX0tFWSA9ICd3YXZlbWFrZXIucGVyc2lzdGVkY29va2llcyc7XG5cbmludGVyZmFjZSBDb29raWVJbmZvIHtcbiAgICBob3N0bmFtZTogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICB2YWx1ZTogc3RyaW5nO1xufVxuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIENvb2tpZVNlcnZpY2UgaW1wbGVtZW50cyBJRGV2aWNlU3RhcnRVcFNlcnZpY2Uge1xuXG4gICAgcHJpdmF0ZSBjb29raWVJbmZvID0ge307XG5cbiAgICBwdWJsaWMgc2VydmljZU5hbWUgPSAnQ29va2VTZXJ2aWNlJztcblxuICAgIHB1YmxpYyBwZXJzaXN0Q29va2llKGhvc3RuYW1lOiBzdHJpbmcsIGNvb2tpZU5hbWU6IHN0cmluZywgY29va2llVmFsdWU/OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPHN0cmluZz4ocmVzb2x2ZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNvb2tpZVZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoY29va2llVmFsdWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0Q29va2llKGhvc3RuYW1lLCBjb29raWVOYW1lKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiByZXNvbHZlKGRhdGEuY29va2llVmFsdWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS50aGVuKHZhbHVlID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvb2tpZUluZm9baG9zdG5hbWUgKyAnLScgKyBjb29raWVOYW1lXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgaG9zdG5hbWU6IGhvc3RuYW1lLnJlcGxhY2UoLzpbMC05XSsvLCAnJyksXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGNvb2tpZU5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnJvdGF0ZUxUUih2YWx1ZSlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeSh0aGlzLmNvb2tpZUluZm8pKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRDb29raWUoaG9zdG5hbWU6IHN0cmluZywgY29va2llTmFtZTogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHdpbmRvd1snY29va2llRW1wZXJvciddLmdldENvb2tpZShob3N0bmFtZSwgY29va2llTmFtZSwgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIHNldENvb2tpZShob3N0bmFtZTogc3RyaW5nLCBjb29raWVOYW1lOiBzdHJpbmcsIGNvb2tpZVZhbHVlOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgd2luZG93Wydjb29raWVFbXBlcm9yJ10uc2V0Q29va2llKGhvc3RuYW1lLCBjb29raWVOYW1lLCBjb29raWVWYWx1ZSwgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGNsZWFyQWxsKCk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxhbnk+KChyZXNvbHZlLCByZWplY3QpID0+IHdpbmRvd1snY29va2llRW1wZXJvciddLmNsZWFyQWxsKHJlc29sdmUsIHJlamVjdCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvYWRzIHBlcnNpc3RlZCBjb29raWVzIGZyb20gbG9jYWwgc3RvcmFnZSBhbmQgYWRkcyB0aGVtIHRvIHRoZSBicm93c2VyLlxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGFydCgpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICBjb25zdCBjb29raWVJbmZvU3RyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9LRVkpLFxuICAgICAgICAgICAgcHJvbWlzZXMgPSBbXTtcbiAgICAgICAgaWYgKGNvb2tpZUluZm9TdHIpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvb2tpZUluZm8gPSBKU09OLnBhcnNlKGNvb2tpZUluZm9TdHIpIGFzIE1hcDxzdHJpbmcsIENvb2tpZUluZm8+O1xuICAgICAgICAgICAgXy5mb3JFYWNoKGNvb2tpZUluZm8sIGMgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjLm5hbWUgJiYgYy52YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Wydjb29raWVFbXBlcm9yJ10uc2V0Q29va2llKGMuaG9zdG5hbWUsIGMubmFtZSwgdGhpcy5yb3RhdGVSVEwoYy52YWx1ZSksIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKHByb21pc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSnVzdCByb3RhdGVzIHRoZSBnaXZlbiBzdHJpbmcgZXhhY3RseSBmcm9tIDEvMyBvZiBzdHJpbmcgbGVuZ3RoIGluIGxlZnQgdG8gcmlnaHQgZGlyZWN0aW9uLlxuICAgICAqIEBwYXJhbSBzdHJcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAqL1xuICAgIHByaXZhdGUgcm90YXRlTFRSKHN0cjogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgYXJyID0gc3RyLnNwbGl0KCcnKSxcbiAgICAgICAgICAgIHRBcnIgPSBbXSxcbiAgICAgICAgICAgIHNoaWZ0ID0gTWF0aC5mbG9vcihzdHIubGVuZ3RoIC8gMyk7XG4gICAgICAgIGFyci5mb3JFYWNoKCh2LCBpKSA9PiB7XG4gICAgICAgICAgICB0QXJyWyhpICsgc2hpZnQpICUgYXJyLmxlbmd0aF0gPSBhcnJbaV07XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdEFyci5qb2luKCcnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBKdXN0IHJvdGF0ZXMgdGhlIGdpdmVuIHN0cmluZyBleGFjdGx5IGZyb20gMS8zIG9mIHN0cmluZyBsZW5ndGggaW4gIHJpZ2h0IHRvIGxlZnQgZGlyZWN0aW9uLi5cbiAgICAgKiBAcGFyYW0gc3RyXG4gICAgICogQHJldHVybnMge3N0cmluZ31cbiAgICAgKi9cbiAgICBwcml2YXRlIHJvdGF0ZVJUTChzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGFyciA9IHN0ci5zcGxpdCgnJyksXG4gICAgICAgICAgICB0QXJyID0gW10sXG4gICAgICAgICAgICBzaGlmdCA9IE1hdGguZmxvb3Ioc3RyLmxlbmd0aCAvIDMpO1xuICAgICAgICBhcnIuZm9yRWFjaCgodiwgaSkgPT4ge1xuICAgICAgICAgICAgdEFyclsoYXJyLmxlbmd0aCArIGkgLSBzaGlmdCkgJSBhcnIubGVuZ3RoXSA9IGFycltpXTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0QXJyLmpvaW4oJycpO1xuICAgIH1cbn1cbiJdfQ==