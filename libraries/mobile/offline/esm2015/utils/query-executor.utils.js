import { from } from 'rxjs';
import { WM_LOCAL_OFFLINE_CALL } from './utils';
const NUMBER_REGEX = /^\d+(\.\d+)?$/;
let isOfflineBehaviourAdded = false;
export class NamedQueryExecutionOfflineBehaviour {
    constructor(changeLogService, httpService, localDBManagementService, networkService) {
        this.changeLogService = changeLogService;
        this.httpService = httpService;
        this.localDBManagementService = localDBManagementService;
        this.networkService = networkService;
    }
    add() {
        if (isOfflineBehaviourAdded) {
            return;
        }
        isOfflineBehaviourAdded = true;
        const orig = this.httpService.sendCallAsObservable;
        this.httpService.sendCallAsObservable = (reqParams, params) => {
            if (!params && _.get(reqParams, 'url')) {
                params = { url: reqParams.url };
            }
            if (!this.networkService.isConnected() && params.url.indexOf('/queryExecutor/') > 0) {
                return from(this.executeLocally(params));
            }
            else {
                return orig.call(this.httpService, reqParams, params);
            }
        };
    }
    executeLocally(params) {
        const url = params.url, hasUrlParams = url.indexOf('?') > 0, dbName = this.substring(url, 'services/', '/queryExecutor'), queryName = this.substring(url, 'queries/', hasUrlParams ? '?' : undefined), urlParams = hasUrlParams ? this.getHttpParamMap(this.substring(url, '?', undefined)) : {}, dataParams = this.getHttpParamMap(params.dataParams), queryParams = _.extend(urlParams, dataParams);
        return this.localDBManagementService.executeNamedQuery(dbName, queryName, queryParams)
            .then(result => {
            const rows = result.rows;
            if (result.rowsAffected) {
                return this.changeLogService.add('WebService', 'invokeJavaService', params)
                    .then(() => result.rowsAffected);
            }
            else {
                return {
                    type: WM_LOCAL_OFFLINE_CALL,
                    body: {
                        totalPages: rows && rows.length > 0 ? 1 : 0,
                        totalElements: rows.length,
                        first: true,
                        sort: null,
                        numberOfElements: rows.length,
                        last: true,
                        size: params.size,
                        number: 0,
                        content: rows
                    }
                };
            }
        });
    }
    substring(source, start, end) {
        if (start) {
            const startIndex = source.indexOf(start) + start.length, endIndex = end ? source.indexOf(end) : undefined;
            return source.substring(startIndex, endIndex);
        }
        return undefined;
    }
    getHttpParamMap(str) {
        const result = {};
        if (str) {
            str = decodeURIComponent(str);
            str.split('&').forEach(c => {
                const csplits = c.split('=');
                if (_.isEmpty(_.trim(csplits[1])) || !NUMBER_REGEX.test(csplits[1])) {
                    result[csplits[0]] = csplits[1];
                }
                else {
                    result[csplits[0]] = parseInt(csplits[1], 10);
                }
            });
        }
        return result;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlcnktZXhlY3V0b3IudXRpbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ad20vbW9iaWxlL29mZmxpbmUvIiwic291cmNlcyI6WyJ1dGlscy9xdWVyeS1leGVjdXRvci51dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsSUFBSSxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBT3hDLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUdoRCxNQUFNLFlBQVksR0FBRyxlQUFlLENBQUM7QUFDckMsSUFBSSx1QkFBdUIsR0FBRyxLQUFLLENBQUM7QUFDcEMsTUFBTSxPQUFPLG1DQUFtQztJQUU1QyxZQUNZLGdCQUFrQyxFQUNsQyxXQUFnQyxFQUNoQyx3QkFBa0QsRUFDbEQsY0FBOEI7UUFIOUIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNsQyxnQkFBVyxHQUFYLFdBQVcsQ0FBcUI7UUFDaEMsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtRQUNsRCxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7SUFHMUMsQ0FBQztJQUVNLEdBQUc7UUFDTixJQUFJLHVCQUF1QixFQUFFO1lBQ3pCLE9BQU87U0FDVjtRQUNELHVCQUF1QixHQUFHLElBQUksQ0FBQztRQUMvQixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLG9CQUFvQixDQUFDO1FBQ25ELElBQUksQ0FBQyxXQUFXLENBQUMsb0JBQW9CLEdBQUcsQ0FBQyxTQUFjLEVBQUUsTUFBWSxFQUFtQixFQUFFO1lBQ3RGLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLEVBQUU7Z0JBQ3BDLE1BQU0sR0FBRyxFQUFDLEdBQUcsRUFBRSxTQUFTLENBQUMsR0FBRyxFQUFDLENBQUM7YUFDakM7WUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxXQUFXLEVBQUUsSUFBSSxNQUFNLENBQUMs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RU8sZUFBZSxDQUFDLEdBQVc7UUFDL0IsTUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLElBQUksR0FBRyxFQUFFO1lBQ0wsR0FBRyxHQUFHLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzlCLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUN2QixNQUFNLE9BQU8sR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUM3QixJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTtvQkFDakUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztpQkFDbkM7cUJBQU07b0JBQ0gsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7aUJBQ2pEO1lBQ0wsQ0FBQyxDQUFDLENBQUM7U0FDTjtRQUNELE9BQU8sTUFBTSxDQUFDO0lBQ2xCLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGZyb20sIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgQWJzdHJhY3RIdHRwU2VydmljZSB9IGZyb20gJ0B3bS9jb3JlJztcbmltcG9ydCB7IE5ldHdvcmtTZXJ2aWNlIH0gZnJvbSAnQHdtL21vYmlsZS9jb3JlJztcblxuaW1wb3J0IHsgQ2hhbmdlTG9nU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2NoYW5nZS1sb2cuc2VydmljZSc7XG5pbXBvcnQgeyBMb2NhbERCTWFuYWdlbWVudFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9sb2NhbC1kYi1tYW5hZ2VtZW50LnNlcnZpY2UnO1xuaW1wb3J0IHsgV01fTE9DQUxfT0ZGTElORV9DQUxMIH0gZnJvbSAnLi91dGlscyc7XG5cbmRlY2xhcmUgY29uc3QgXztcbmNvbnN0IE5VTUJFUl9SRUdFWCA9IC9eXFxkKyhcXC5cXGQrKT8kLztcbmxldCBpc09mZmxpbmVCZWhhdmlvdXJBZGRlZCA9IGZhbHNlO1xuZXhwb3J0IGNsYXNzIE5hbWVkUXVlcnlFeGVjdXRpb25PZmZsaW5lQmVoYXZpb3VyIHtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGNoYW5nZUxvZ1NlcnZpY2U6IENoYW5nZUxvZ1NlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgaHR0cFNlcnZpY2U6IEFic3RyYWN0SHR0cFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgbG9jYWxEQk1hbmFnZW1lbnRTZXJ2aWNlOiBMb2NhbERCTWFuYWdlbWVudFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgbmV0d29ya1NlcnZpY2U6IE5ldHdvcmtTZXJ2aWNlXG4gICAgKSB7XG5cbiAgICB9XG5cbiAgICBwdWJsaWMgYWRkICgpIHtcbiAgICAgICAgaWYgKGlzT2ZmbGluZUJlaGF2aW91ckFkZGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaXNPZmZsaW5lQmVoYXZpb3VyQWRkZWQgPSB0cnVlO1xuICAgICAgICBjb25zdCBvcmlnID0gdGhpcy5odHRwU2VydmljZS5zZW5kQ2FsbEFzT2JzZXJ2YWJsZTtcbiAgICAgICAgdGhpcy5odHRwU2VydmljZS5zZW5kQ2FsbEFzT2JzZXJ2YWJsZSA9IChyZXFQYXJhbXM6IGFueSwgcGFyYW1zPzogYW55KTogT2JzZXJ2YWJsZTxhbnk+ID0+IHtcbiAgICAgICAgICAgIGlmICghcGFyYW1zICYmIF8uZ2V0KHJlcVBhcmFtcywgJ3VybCcpKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zID0ge3VybDogcmVxUGFyYW1zLnVybH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMubmV0d29ya1NlcnZpY2UuaXNDb25uZWN0ZWQoKSAmJiBwYXJhbXMudXJsLmluZGV4T2YoJy9xdWVyeUV4ZWN1dG9yLycpID4gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmcm9tKHRoaXMuZXhlY3V0ZUxvY2FsbHkocGFyYW1zKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBvcmlnLmNhbGwodGhpcy5odHRwU2VydmljZSwgcmVxUGFyYW1zLCBwYXJhbXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgZXhlY3V0ZUxvY2FsbHkocGFyYW1zOiBhbnkpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICBjb25zdCB1cmwgPSBwYXJhbXMudXJsLFxuICAgICAgICAgICAgaGFzVXJsUGFyYW1zID0gdXJsLmluZGV4T2YoJz8nKSA+IDAsXG4gICAgICAgICAgICBkYk5hbWUgPSB0aGlzLnN1YnN0cmluZyh1cmwsICdzZXJ2aWNlcy8nLCAnL3F1ZXJ5RXhlY3V0b3InKSxcbiAgICAgICAgICAgIHF1ZXJ5TmFtZSA9IHRoaXMuc3Vic3RyaW5nKHVybCwgJ3F1ZXJpZXMvJywgaGFzVXJsUGFyYW1zID8gJz8nIDogdW5kZWZpbmVkKSxcbiAgICAgICAgICAgIHVybFBhcmFtcyA9IGhhc1VybFBhcmFtcyA/IHRoaXMuZ2V0SHR0cFBhcmFtTWFwKHRoaXMuc3Vic3RyaW5nKHVybCwgJz8nLCB1bmRlZmluZWQpKSA6IHt9LFxuICAgICAgICAgICAgZGF0YVBhcmFtcyA9IHRoaXMuZ2V0SHR0cFBhcmFtTWFwKHBhcmFtcy5kYXRhUGFyYW1zKSxcbiAgICAgICAgICAgIHF1ZXJ5UGFyYW1zID0gXy5leHRlbmQodXJsUGFyYW1zLCBkYXRhUGFyYW1zKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxEQk1hbmFnZW1lbnRTZXJ2aWNlLmV4ZWN1dGVOYW1lZFF1ZXJ5KGRiTmFtZSwgcXVlcnlOYW1lLCBxdWVyeVBhcmFtcylcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm93cyA9IHJlc3VsdC5yb3dzO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucm93c0FmZmVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoYW5nZUxvZ1NlcnZpY2UuYWRkKCdXZWJTZXJ2aWNlJywgJ2ludm9rZUphdmFTZXJ2aWNlJywgcGFyYW1zKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gcmVzdWx0LnJvd3NBZmZlY3RlZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFdNX0xPQ0FMX09GRkxJTkVfQ0FMTCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFBhZ2VzOiByb3dzICYmIHJvd3MubGVuZ3RoID4gMCA/IDEgOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsRWxlbWVudHM6IHJvd3MubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcnQ6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyT2ZFbGVtZW50czogcm93cy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBwYXJhbXMuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogcm93c1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3Vic3RyaW5nKHNvdXJjZTogc3RyaW5nLCBzdGFydDogc3RyaW5nLCBlbmQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGlmIChzdGFydCkge1xuICAgICAgICAgICAgY29uc3Qgc3RhcnRJbmRleCA9IHNvdXJjZS5pbmRleE9mKHN0YXJ0KSArIHN0YXJ0Lmxlbmd0aCxcbiAgICAgICAgICAgICAgICBlbmRJbmRleCA9IGVuZCA/IHNvdXJjZS5pbmRleE9mKGVuZCkgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICByZXR1cm4gc291cmNlLnN1YnN0cmluZyhzdGFydEluZGV4LCBlbmRJbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEh0dHBQYXJhbU1hcChzdHI6IHN0cmluZyk6IGFueSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuICAgICAgICBpZiAoc3RyKSB7XG4gICAgICAgICAgICBzdHIgPSBkZWNvZGVVUklDb21wb25lbnQoc3RyKTtcbiAgICAgICAgICAgIHN0ci5zcGxpdCgnJicpLmZvckVhY2goYyA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3NwbGl0cyA9IGMuc3BsaXQoJz0nKTtcbiAgICAgICAgICAgICAgICBpZiAoXy5pc0VtcHR5KF8udHJpbShjc3BsaXRzWzFdKSkgfHwgIU5VTUJFUl9SRUdFWC50ZXN0KGNzcGxpdHNbMV0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFtjc3BsaXRzWzBdXSA9IGNzcGxpdHNbMV07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2NzcGxpdHNbMF1dID0gcGFyc2VJbnQoY3NwbGl0c1sxXSwgMTApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxufVxuIl19