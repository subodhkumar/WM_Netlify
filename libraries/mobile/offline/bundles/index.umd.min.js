!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@ionic-native/app-version"),require("@ionic-native/file"),require("@ionic-native/sqlite"),require("@wm/security"),require("rxjs"),require("@angular/core"),require("@wm/core"),require("@wm/mobile/core"),require("@wm/variables")):"function"==typeof define&&define.amd?define("@wm/mobile/offline",["exports","@angular/common","@ionic-native/app-version","@ionic-native/file","@ionic-native/sqlite","@wm/security","rxjs","@angular/core","@wm/core","@wm/mobile/core","@wm/variables"],t):t((e.wm=e.wm||{},e.wm.mobile=e.wm.mobile||{},e.wm.mobile.offline={}),e.ng.common,e.ionicNative.plugins,e.ionicNative.plugins,e.ionicNative.plugins,e.wm.security,e.rxjs,e.ng.core,e.wm.core,e.wm.mobile.core,e.wm.variables)}(this,function(e,t,n,r,a,i,s,o,v,u,c){"use strict";var p,l,f=function(){function e(){}return e.prototype.get=function(e){return this.fetchEntry(e).then(function(e){var t;return e&&0<e.length&&(t=e[0].value)&&(t=JSON.parse(t)),t})},e.prototype.init=function(e){this.store=e},e.prototype.put=function(t,n){var r=this;return n&&(n=JSON.stringify(n)),this.fetchEntry(t).then(function(e){return e&&0<e.length?r.store.save({id:e[0].id,key:t,value:n}):r.store.add({key:t,value:n})})},e.prototype.remove=function(e){var t=this;return this.fetchEntry(e).then(function(e){if(e&&0<e.length)return t.store["delete"](e[0].id)})},e.prototype.fetchEntry=function(e){var t=[{attributeName:"key",attributeValue:e,attributeType:"STRING",filterCondition:"EQUALS"}];return this.store.filter(t)},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=o.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),h="WM_LOCAL_OFFLINE_CALL",S=function(e){if(e)return'"'+(e=e.replace(/"/g,'""'))+'"'},m=function(e,t){var n,i=e.fieldToColumnMapping,o=e.entitySchema.name;return!_.isEmpty(t)&&_.isString(t)?" WHERE "+t:(t&&(n=t.map(function(e){var t=i[e.attributeName],n=e.filterCondition,r=e.attributeValue,a="=";return"STRING"===e.attributeType?("STARTING_WITH"===n?(r+="%",a="like"):"ENDING_WITH"===n?(r="%"+r,a="like"):"CONTAINING"===n&&(r="%"+r+"%",a="like"),r="'"+r+"'"):"BOOLEAN"===e.attributeType&&(r=!0===r?1:0),S(o)+"."+S(t)+" "+a+" "+r})),n&&0<n.length?" WHERE "+n.join(" AND "):"")},d=function(e,a){return e.columns.forEach(function(e){var t=a[e.fieldName];e.foreignRelations?e.foreignRelations.forEach(function(e){var r=null;_.forEach(e.dataMapper,function(e,t){var n=a[t];v.isDefined(n)&&null!==n&&""!==n&&((r=r||{})[e.fieldName]=a[t]),delete a[t]}),a[e.sourceFieldName]=r}):"boolean"!==e.sqlType||_.isNil(t)||(a[e.fieldName]=1===t)}),a},y=function(t,e){var n=t[e.fieldName];return e.foreignRelations&&e.foreignRelations.some(function(e){return!(!e.targetEntity||!t[e.sourceFieldName])&&(n=t[e.sourceFieldName][e.targetFieldName],!0)}),_.isNil(n)?e.defaultValue:"boolean"===e.sqlType?!0===n?1:0:n},g=function(e,t){var n={};return e.entitySchema.columns.forEach(function(e){return n[e.name]=y(t,e)}),n},b=function(){function e(e,t,n,r,a){var i,o,s,u,c,l,p,f,h,m,d,y,v,g=this;this.deviceFileService=e,this.entitySchema=t,this.file=n,this.localDbManagementService=r,this.sqliteObject=a,this.fieldToColumnMapping={},this.primaryKeyField=_.find(this.entitySchema.columns,"primaryKey"),this.primaryKeyName=this.primaryKeyField?this.primaryKeyField.fieldName:undefined,this.entitySchema.columns.forEach(function(e){g.fieldToColumnMapping[e.fieldName]=e.name,e.foreignRelations&&e.foreignRelations.forEach(function(n){g.fieldToColumnMapping[n.targetPath]=e.name,_.forEach(n.dataMapper,function(e,t){g.fieldToColumnMapping[t]=n.sourceFieldName+"."+e.name})})}),this.insertRecordSqlTemplate=(i=this.entitySchema,o=[],s=[],_.forEach(i.columns,function(e){o.push(S(e.name)),s.push("?")}),"INSERT INTO "+S(i.name)+" ("+o.join(",")+") VALUES ("+s.join(",")+")"),this.replaceRecordSqlTemplate=(u=this.entitySchema,c=[],l=[],_.forEach(u.columns,function(e){c.push(S(e.name)),l.push("?")}),"REPLACE INTO "+S(u.name)+" ("+c.join(",")+") VALUES ("+l.join(",")+")"),this.deleteRecordTemplate=(p=this.entitySchema,(f=_.find(p.columns,"primaryKey"))?"DELETE FROM "+S(p.name)+" WHERE "+S(f.name)+" = ?":""),this.selectSqlTemplate=(h=this.entitySchema,m=[],d=[],h.columns.forEach(function(t){var n;m.push(S(h.name)+"."+S(t.name)+" as "+t.fieldName),t.foreignRelations&&t.foreignRelations.forEach(function(e){n=e.sourceFieldName,_.forEach(e.dataMapper,function(e,t){m.push(n+"."+S(e.name)+" as '"+t+"'")}),d.push(" LEFT JOIN "+S(e.targetTable)+" "+n+"\n                         ON "+n+"."+S(e.targetColumn)+" = "+S(h.name)+"."+S(t.name))})}),"SELECT "+m.join(",")+" FROM "+S(h.name)+" "+d.join(" ")),this.countQuery=(y=this.entitySchema,v=[],y.columns.forEach(function(t){var n;t.foreignRelations&&t.foreignRelations.forEach(function(e){n=e.sourceFieldName,v.push(" LEFT JOIN "+S(e.targetTable)+" "+n+"\n                         ON "+n+"."+S(e.targetColumn)+" = "+S(y.name)+"."+S(t.name))})}),"SELECT count(*) as count FROM "+S(y.name)+" "+v.join(" "))}return e.prototype.add=function(e){if(this.primaryKeyName){var t=e[this.primaryKeyName];if("number"===this.primaryKeyField.sqlType&&(!v.isDefined(t)||_.isString(t)&&_.isEmpty(_.trim(t))))if("identity"===this.primaryKeyField.generatorType)e[this.primaryKeyName]=this.localDbManagementService.nextIdCount();else{var n=this.getValue(e,this.primaryKeyName);e[this.primaryKeyName]=n}}var r=g(this,e),a=this.entitySchema.columns.map(function(e){return r[e.name]});return this.sqliteObject.executeSql(this.insertRecordSqlTemplate,a).then(function(e){return e.insertId})},e.prototype.clear=function(){return this.sqliteObject.executeSql("DELETE FROM "+S(this.entitySchema.name))},e.prototype.create=function(){var e=this;return this.sqliteObject.executeSql(this.createTableSql(this.entitySchema)).then(function(){return e})},e.prototype.count=function(e){var t=this.countQuery+m(this,e);return this.sqliteObject.executeSql(t).then(function(e){return e.rows.item(0).count})},e.prototype.deserialize=function(e){return this.deserializeMapToFormData(e)},e.prototype.filter=function(e,t,n){var r,a,i,o=this,s=this.selectSqlTemplate;return s+=m(this,e),s+=(r=this,(a=t)?" ORDER BY "+_.map(a.split(","),function(e){var t=_.trim(e).split(" ");return t[0]=S(r.entitySchema.name)+"."+S(r.fieldToColumnMapping[t[0]]),t.join(" ")}).join(","):""),s+=" LIMIT "+((i=(i=n)||{}).limit||100)+" OFFSET "+(i.offset||0),this.sqliteObject.executeSql(s).then(function(e){for(var t=[],n=e.rows.length,r=0;r<n;r++)t.push(d(o.entitySchema,e.rows.item(r)));return t})},e.prototype.refresh=function(e){var t=this.primaryKeyName,n=this.getValue(e,t);return n?this.get(n):Promise.resolve(e)},e.prototype["delete"]=function(e){return this.sqliteObject.executeSql(this.deleteRecordTemplate,[e])},e.prototype.get=function(e){var t=[{attributeName:this.primaryKeyName,filterCondition:"=",attributeValue:e,attributeType:this.primaryKeyField.sqlType.toUpperCase()}];return this.filter(t).then(function(e){return e&&1===e.length?e[0]:undefined})},e.prototype.getValue=function(e,t){var n=this.entitySchema.columns.find(function(e){return e.fieldName===t});return y(e,n)},e.prototype.save=function(e){return this.saveAll([e])},e.prototype.saveAll=function(e){var r=this;e=_.filter(e,null);var t=_.map(e,function(e){var t=g(r,e),n=r.entitySchema.columns.map(function(e){return t[e.name]});return[r.replaceRecordSqlTemplate,n]});return this.sqliteObject.sqlBatch(t)},e.prototype.serialize=function(e){return this.serializeFormDataToMap(e)},e.prototype.saveBlobToFile=function(e){var t=this.deviceFileService.appendToFileName(e.name),n=this.deviceFileService.getUploadDirectory();return this.file.writeFile(n,t,e).then(function(){return{name:e.name,type:e.type,lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,size:e.size,wmLocalPath:n+"/"+t}})},e.prototype.serializeFormDataToMap=function(e){var n=this,r=_.filter(this.entitySchema.columns,{sqlType:"blob"}),a=[],i={};return e&&"function"==typeof e.append&&e.rowData?_.forEach(e.rowData,function(e,t){e&&_.find(r,{fieldName:t})?a.push(n.saveBlobToFile(e).then(function(e){i[t]=e})):i[t]=e}):i=e,Promise.all(a).then(function(){return i})},e.prototype.deserializeMapToFormData=function(e){var r=new FormData,t=this.entitySchema.columns.filter(function(e){return"blob"===e.sqlType}),a=[];return _.forEach(t,function(t){var n=e[t.fieldName];n&&n.wmLocalPath&&(a.push(v.convertToBlob(n.wmLocalPath).then(function(e){return r.append(t.fieldName,e.blob,n.name)})),e[t.fieldName]="")}),r.append(c.SWAGGER_CONSTANTS.WM_DATA_JSON,new Blob([JSON.stringify(e)],{type:"application/json"})),Promise.all(a).then(function(){return r})},e.prototype.createTableSql=function(e){var t=_.reduce(e.columns,function(e,t){var n=S(t.name);return t.primaryKey&&("number"===t.sqlType&&"databaseIdentity"===t.generatorType?n+=" INTEGER PRIMARY KEY AUTOINCREMENT":n+=" PRIMARY KEY"),e?e+","+n:n},!1);return"CREATE TABLE IF NOT EXISTS "+S(e.name)+" ("+t+")"},e}(),D=function re(){this.schema={name:"",isInternal:!1,entities:new Map},this.stores=new Map,this.queries=new Map},T=function ae(e,t){this.name=e,this.fieldName=t,this.primaryKey=!1,this.fieldName=this.fieldName||this.name};(l=p||(p={})).LIVE="LIVE",l.BUNDLED="BUNDLED",l.APP_START="APP_START";var N="localDBStore.nextIdCount",C="www/metadata/app",E={name:"wavemaker",version:1,isInternal:!0,tables:[{name:"key_value",entityName:"key-value",columns:[{fieldName:"id",name:"id",generatorType:"databaseIdentity",sqlType:"number",primaryKey:!0},{fieldName:"key",name:"key"},{name:"value",fieldName:"value"}]},{name:"offlineChangeLog",entityName:"offlineChangeLog",columns:[{fieldName:"id",name:"id",generatorType:"databaseIdentity",sqlType:"number",primaryKey:!0},{name:"service",fieldName:"service"},{name:"operation",fieldName:"operation"},{name:"params",fieldName:"params"},{name:"timestamp",fieldName:"timestamp"},{name:"hasError",fieldName:"hasError"},{name:"errorMessage",fieldName:"errorMessage"}]}]},I=function(){function e(e,t,n,r,a,i,o){var s=this;this.appVersion=e,this.deviceService=t,this.deviceFileService=n,this.file=r,this.localKeyValueService=a,this.securityService=i,this.sqlite=o,this.callbacks=[],this._logSql=!1,this.nextId=1e11,this.systemProperties={USER_ID:{name:"USER_ID",value:function(){return s.securityService.getLoggedInUser().then(function(e){return e.userId})}},USER_NAME:{name:"USER_NAME",value:function(){return s.securityService.getLoggedInUser().then(function(e){return e.userName})}},DATE_TIME:{name:"DATE_TIME",value:function(){return moment().format("YYYY-MM-DDThh:mm:ss")}},DATE:{name:"CURRENT_DATE",value:function(){return moment().format("YYYY-MM-DD")}},TIME:{name:"TIME",value:function(){return moment().format("hh:mm:ss")}}}}return e.prototype.close=function(){var r=this;return new Promise(function(t,n){setTimeout(function(){var e=_.map(_.values(r.databases),function(e){return e.sqliteObject.close()});Promise.all(e).then(t,n)},1e3)})},e.prototype.nextIdCount=function(){return this.nextId=this.nextId+1,this.localKeyValueService.put(N,this.nextId),this.nextId},e.prototype.executeNamedQuery=function(e,t,n){var o,r,s=this;return this.databases[e]&&this.databases[e].queries[t]?(o=this.databases[e].queries[t],r=_.chain(o.params).filter(function(e){return"PROMPT"!==e.variableType}).forEach(function(t){var e=s.systemProperties[t.variableType].value(t.name,n);return v.toPromise(e).then(function(e){return n[t.name]=e})}).value(),Promise.all(r).then(function(){return n=_.map(o.params,function(e){return"string"==typeof n[e.name]||e.type!==v.DataType.DATETIME&&e.type!==v.DataType.LOCALDATETIME?e.type===v.DataType.BOOLEAN?s.convertBoolToInt(n[e.name]):n[e.name]:c.formatDate(n[e.name],e.type)}),s.executeSQLQuery(e,o.query,n).then(function(e){var t,n;return _.isEmpty(e.rows)||(t=e.rows[0],n=_.find(o.response.properties,function(e){return!t.hasOwnProperty(e.fieldName)}),_.isUndefined(n)||(e.rows=_.map(e.rows,function(r){var a={},i={};return _.forEach(r,function(e,t){return i[t.toUpperCase()]=e}),_.forEach(o.response.properties,function(e){var t=v.extractType(e.fieldType.typeRef),n=(v.DEFAULT_FORMATS[_.toUpper(t)],r[e.name]);!n||"string"==typeof n||t!==v.DataType.DATETIME&&t!==v.DataType.LOCALDATETIME&&t!==v.DataType.DATE||(moment(n).isValid()?r[e.name]=c.formatDate(n,t):moment(n,"HH:mm").isValid()&&(r[e.name]=moment().format("YYYY-MM-DD")+"T"+n)),t===v.DataType.BOOLEAN&&(r[e.name]=s.convertIntToBool(n)),i[e.nameInUpperCase]=r[e.name],a[e.name]=r[e.name],a[e.fieldName]=r[e.fieldName]||i[e.nameInUpperCase]}),a}))),e})})):Promise.reject("Query by name ' "+t+" ' Not Found")},e.prototype.exportDB=function(){var o=this;return new Promise(function(e,t){var r,n="offline_temp_"+_.now(),a=cordova.file.cacheDirectory+n+"/",i={app:null,OS:"",createdOn:0};r=v.isIos()?cordova.file.documentsDirectory:cordova.file.externalRootDirectory+"Download/",o.file.createDir(cordova.file.cacheDirectory,n,!1).then(function(){return o.file.copyDir(o.dbInstallParentDirectory,o.dbInstallDirectoryName,a,"databases").then(function(){return o.getAppInfo()}).then(function(e){return i.app=e,v.isIos()?i.OS="IOS":v.isAndroid()&&(i.OS="ANDROID"),i.createdOn=_.now(),i}).then(function(){return v.executePromiseChain(o.getCallbacksFor("preExport"),[a,i])}).then(function(){return o.file.writeFile(a,"META.json",JSON.stringify(i))})}).then(function(){var e=i.app.name;return e=e.replace(/\s+/g,"_"),o.deviceFileService.newFileName(r,e+"_offline_data.zip").then(function(n){return new Promise(function(e,t){Zeep.zip({from:a,to:r+n},function(){return e(r+n)},t)})})}).then(e,t)["catch"](v.noop).then(function(){return o.deviceFileService.removeDir(cordova.file.cacheDirectory+n)})})},e.prototype.getStore=function(n,r){var a=this;return new Promise(function(e,t){a.databases[n]&&e(a.databases[n].stores[r]),t("store with name'"+r+"' in datamodel '"+n+"' is not found")})},e.prototype.importDB=function(i,o){var s=this;return new Promise(function(e,t){var n,r="offline_temp_"+_.now(),a=cordova.file.cacheDirectory+r+"/";s.file.createDir(cordova.file.cacheDirectory,r,!1).then(function(){return new Promise(function(e,t){Zeep.unzip({from:i,to:a},e,t)})}).then(function(){return s.file.readAsText(a,"META.json").then(function(e){return n=JSON.parse(e),s.getAppInfo()}).then(function(e){return n.app?n.app.packageName!==e.packageName?Promise.reject("database zip of app with same package name can only be imported"):void 0:Promise.reject("meta information is not found in zip")})}).then(function(){var t;return s.close().then(function(){if(o)return s.exportDB().then(function(e){return t=e})}).then(function(){return s.deviceFileService.removeDir(s.dbInstallDirectory)}).then(function(){return s.file.copyDir(a,"databases",s.dbInstallParentDirectory,s.dbInstallDirectoryName)}).then(function(){return s.databases=null,s.loadDatabases()}).then(function(){return v.executePromiseChain(s.getCallbacksFor("postImport"),[a,n])}).then(function(){if(t)return s.deviceFileService.removeFile(t)},function(e){return t?s.importDB(t,!1).then(function(){return s.deviceFileService.removeFile(t),Promise.reject(e)}):Promise.reject(e)})}).then(e,t)["catch"](v.noop).then(function(){return s.deviceFileService.removeDir(cordova.file.cacheDirectory+r)})})},e.prototype.isOperationAllowed=function(e,t,n){return this.getStore(e,t).then(function(e){return!!e&&("READ"===n?e.entitySchema.pushConfig.readEnabled:"INSERT"===n?e.entitySchema.pushConfig.insertEnabled:"UPDATE"===n?e.entitySchema.pushConfig.updateEnabled:"DELETE"===n&&e.entitySchema.pushConfig.deleteEnabled)})["catch"](function(){return!1})},e.prototype.loadDatabases=function(){var n=this,t=!1;return this.databases?Promise.resolve(this.databases):(v.isIos()?(this.dbInstallDirectoryName="LocalDatabase",this.dbInstallParentDirectory=cordova.file.applicationStorageDirectory+"Library/"):(this.dbInstallDirectoryName="databases",this.dbInstallParentDirectory=cordova.file.applicationStorageDirectory),this.dbInstallDirectory=this.dbInstallParentDirectory+this.dbInstallDirectoryName,this.databases=new Map,this.setUpDatabases().then(function(e){return t=e}).then(function(){return n.loadDBSchemas()}).then(function(e){return n.loadNamedQueries(e)}).then(function(e){return n.loadOfflineConfig(e)}).then(function(e){return Promise.all(_.map(e,function(t){return n.openDatabase(t).then(function(e){n.databases[t.schema.name]=e})}))}).then(function(){return n.getStore("wavemaker","key-value").then(function(e){return n.localKeyValueService.init(e),n.localKeyValueService.get(N).then(function(e){n.nextId=e||n.nextId})})}).then(function(){return t?n.normalizeData().then(function(){return n.disableForeignKeys()}).then(function(){return n.deviceService.getAppBuildTime()}).then(function(e){return v.executePromiseChain(_.map(n.callbacks,"onDbCreate"),[{databases:n.databases,dbCreatedOn:_.now(),dbSeedCreatedOn:e}])}).then(function(){return n.databases}):n.databases}))},e.prototype.registerCallback=function(e){this.callbacks.push(e)},e.prototype.setLogSQl=function(e){this._logSql=e},e.prototype.cleanAndCopyDatabases=function(){var t=this,n=cordova.file.applicationDirectory+C;return this.file.createDir(this.dbInstallParentDirectory,this.dbInstallDirectoryName,!1)["catch"](v.noop).then(function(){return t.deviceFileService.listFiles(t.dbInstallDirectory,/.+\.db$/)}).then(function(e){if(e&&0<e.length)return Promise.all(e.map(function(e){if("wavemaker.db"!==e.name)return t.file.removeFile(t.dbInstallDirectory,e.name)}))}).then(function(){return t.deviceFileService.listFiles(n,/.+\.db$/)}).then(function(e){if(e&&0<e.length)return t.file.createDir(t.dbInstallParentDirectory,t.dbInstallDirectoryName,!1)["catch"](v.noop).then(function(){return Promise.all(e.map(function(e){return t.file.copyFile(n,e.name,t.dbInstallDirectory,e.name)}))})})},e.prototype.compactEntitySchema=function(s,e,t){var u=t[e.entityName];return u.entityName=e.entityName,u.name=e.name,u.columns=[],e.columns.forEach(function(e){var t=e.columnValue?e.columnValue.defaultValue:"",n=e.sqlType;t="number"!==n||e.primaryKey?"boolean"===n?_.isEmpty(t)?null:"true"===t?1:0:_.isEmpty(t)?null:t:_.isEmpty(t)?null:_.parseInt(t),u.columns.push({name:e.name,fieldName:e.fieldName,generatorType:e.generatorType,sqlType:e.sqlType,primaryKey:e.primaryKey,defaultValue:t})}),_.forEach(e.relations,function(t){var e,n,r,a,i;if(("ManyToOne"===t.cardinality||"OneToOne"===t.cardinality)&&(n=_.find(s.tables,function(e){return e.name===t.targetTable}),i=t.mappings[0],n)){n=n.entityName,a=i.sourceColumn,r=u.columns.find(function(e){return e.name===a}),e=s.tables.find(function(e){return e.name===t.targetTable});var o={sourceFieldName:t.fieldName,targetEntity:n,targetTable:t.targetTable,targetColumn:i.targetColumn,targetPath:"",dataMapper:[],targetFieldName:e.columns.find(function(e){return e.name===i.targetColumn}).fieldName};o.targetPath=o.sourceFieldName+"."+o.targetFieldName,o.dataMapper=_.chain(e.columns).keyBy(function(e){return o.sourceFieldName+"."+e.fieldName}).mapValues(function(e){return new T(e.name,e.fieldName)}).value(),r.foreignRelations=r.foreignRelations||[],r.foreignRelations.push(o)}}),u},e.prototype.compactQueries=function(e){var r=this,a=new Map;return _.forEach(e.queries,function(n){var t,e;n.nativeSql&&"SELECT"===n.type&&(t=_.isEmpty(n.offlineQueryString)?n.queryString:n.offlineQueryString,(e=_.map(r.extractQueryParams(t),function(e){var t=_.find(n.parameters,{name:e});return{name:t.name,type:t.type,variableType:t.variableType}})).forEach(function(e){return t=_.replace(t,":"+e.name,"?")}),a[n.name]={name:n.name,query:t,params:e,response:{properties:_.map(n.response.properties,function(e){return e.nameInUpperCase=e.name.toUpperCase(),e})}})}),a},e.prototype.compactSchema=function(t){var n=this,e=new D,r=new Map;return t.tables.forEach(function(e){r[e.entityName]={}}),t.tables.forEach(function(e){n.compactEntitySchema(t,e,r)}),e.schema.name=t.name,e.schema.isInternal=t.isInternal,e.schema.entities=r,e},e.prototype.convertBoolToInt=function(e){return"true"===_.toString(e)?1:0},e.prototype.convertIntToBool=function(e){return!!e},e.prototype.disableForeignKeys=function(){var t=this;return Promise.all(_.map(this.databases,function(e){return t.executeSQLQuery(e.schema.name,"PRAGMA foreign_keys = OFF")}))},e.prototype.executeSQLQuery=function(e,t,n,r){var a=this.databases[e];return a?a.sqliteObject.executeSql(t,n,r).then(function(e){for(var t=[],n=e.rows,r=0;r<n.length;r++)t.push(n.item(r));return{rowsAffected:e.rowsAffected,rows:t}}):Promise.reject("No Database with name "+e+" found")},e.prototype.extractQueryParams=function(e){var t;return(t=e.match(/[^"'\w\\]:\s*\w+\s*/g)||[]).length?t.map(function(e){return/[=|\W]/g.test(e)?e.replace(/\W/g,"").trim():e.trim()}):null},e.prototype.getAppInfo=function(){var t=this,n={name:"",packageName:"",versionNumber:"",versionCode:null};return this.appVersion.getPackageName().then(function(e){return n.packageName=e,t.appVersion.getAppName()}).then(function(e){return n.name=e,t.appVersion.getVersionNumber()}).then(function(e){return n.versionNumber=e,t.appVersion.getVersionCode()}).then(function(e){return n.versionCode=e,n})},e.prototype.getCallbacksFor=function(t){return this.callbacks.map(function(e){return e[t]?e[t].bind(e):null})},e.prototype.getMetaInfo=function(e){var r=cordova.file.applicationDirectory+C+"/";return this.deviceFileService.listFiles(r,e).then(function(e){return Promise.all(_.map(e,function(n){return new Promise(function(t,e){$.getJSON(r+n.name,function(e){return t(e)})})}))})},e.prototype.isBundled=function(e,t){return this.getStore(e,t).then(function(e){return e.entitySchema.pullConfig.pullType===p.BUNDLED})},e.prototype.loadDBSchemas=function(){var n=this;return this.getMetaInfo(/.+_dataModel\.json$/).then(function(e){var t=new Map;return(e=v.isArray(e)?e:[e]).push(E),e.map(function(e){return n.compactSchema(e)}).forEach(function(e){t[e.schema.name]=e}),t})},e.prototype.loadNamedQueries=function(t){var n=this;return this.getMetaInfo(/.+_query\.json$/).then(function(e){return(e=_.isArray(e)?e:[e]).map(function(e){return t[e.name].queries=n.compactQueries(e)}),t})},e.prototype.loadOfflineConfig=function(r){return this.getMetaInfo(/.+_offline\.json$/).then(function(e){return _.forEach(e,function(n){_.forEach(n.entities,function(t){var e=_.find(r[n.name].schema.entities,function(e){return e.name===t.name});_.assignIn(e,t)})}),r})},e.prototype.logSql=function(e){var u=this,c=console,t=e.executeSql;e.executeSql=function(a,i,o){var s=_.now();return t.call(e,a,i).then(function(e){if(o||u._logSql){for(var t=[],n=e.rows.length,r=0;r<n;r++)t.push(e.rows.item(r));c.debug('SQL "%s"  with params %O took [%d ms]. And the result is %O',a,i,_.now()-s,t)}return e},function(e){return c.error('SQL "%s" with params %O failed with error message %s',a,i,e.message),Promise.reject(e)})}},e.prototype.normalizeBooleanData=function(e,t,n){var r=this,a="update "+S(t)+" set "+S(n)+" = 1 where "+S(n)+" = 'true'",i="update "+S(t)+" set "+S(n)+" = 0\n                                  where "+S(n)+" is not null and "+S(n)+" != 1";return this.executeSQLQuery(e,a).then(function(){return r.executeSQLQuery(e,i)})},e.prototype.normalizeData=function(){var r=this;return Promise.all(_.map(this.databases,function(n){return Promise.all(_.map(n.schema.entities,function(t){return Promise.all(_.map(t.columns,function(e){if("boolean"===e.sqlType)return r.normalizeBooleanData(n.schema.name,t.name,e.name)}))}))}))},e.prototype.openDatabase=function(n){var r=this;return this.sqlite.create({name:n.schema.name+".db",location:"default"}).then(function(t){n.sqliteObject=t,r.logSql(t);var e=_.map(n.schema.entities,function(e){return new b(r.deviceFileService,e,r.file,r,t).create()});return Promise.all(e).then(function(e){return _.forEach(e,function(e){n.stores[e.entitySchema.entityName]=e}),n})})},e.prototype.setUpDatabases=function(){var n=this;return this.deviceService.getAppBuildTime().then(function(e){var t=n.deviceService.getEntry("database")||{};return(!t.lastBuildTime||t.lastBuildTime!==e)&&n.cleanAndCopyDatabases().then(function(){return t.lastBuildTime=e,n.deviceService.storeEntry("database",t)}).then(function(){return!0})})},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:n.AppVersion},{type:u.DeviceService},{type:u.DeviceFileService},{type:r.File},{type:f},{type:i.SecurityService},{type:a.SQLite}]},e.ngInjectableDef=o.defineInjectable({factory:function(){return new e(o.inject(n.AppVersion),o.inject(u.DeviceService),o.inject(u.DeviceFileService),o.inject(r.File),o.inject(f),o.inject(i.SecurityService),o.inject(a.SQLite))},token:e,providedIn:"root"}),e}(),P=function ie(){},w="changeLogService.flushContext",F="changeLogService.lastPushInfo",M=function(){function e(e,t,n,r){this.localDBManagementService=e,this.localKeyValueService=t,this.pushService=n,this.networkService=r,this.workers=[],this.currentPushInfo={},this.addWorker(new L(this,this.localKeyValueService,this.currentPushInfo))}return e.prototype.add=function(e,t,n){var r=this,a={service:e,operation:t,params:n,hasError:0};return v.executePromiseChain(this.getWorkers("transformParamsToMap"),[a]).then(function(){return v.executePromiseChain(r.getWorkers("onAddCall"),[a])}).then(function(){return a.params=JSON.stringify(a.params),r.getStore().then(function(e){return e.add(a)}).then(v.noop)})},e.prototype.addWorker=function(e){this.workers.push(e)},e.prototype.clearLog=function(){return this.getStore().then(function(e){return e.clear()})},e.prototype.flush=function(e){var t,n=this;return this.deferredFlush||(this.deferredFlush=v.getAbortableDefer(),this.createContext().then(function(e){return n.flushContext=e,v.executePromiseChain(n.getWorkers("preFlush"),[n.flushContext])}).then(function(){return t=n._flush(e),n.deferredFlush.onAbort=function(){return t.abort()},t})["catch"](v.noop).then(function(){Promise.resolve().then(function(){if(n.currentPushInfo.totalTaskCount===n.currentPushInfo.completedTaskCount)return n.flushContext.clear().then(function(){return n.flushContext=null})}).then(function(){e.complete(),0<n.currentPushInfo.failedTaskCount?n.deferredFlush.reject(n.currentPushInfo):n.deferredFlush.resolve(n.currentPushInfo),n.deferredFlush=null}).then(function(){return v.executePromiseChain(n.getWorkers("postFlush"),[n.currentPushInfo,n.flushContext])})})),this.deferredFlush.promise},e.prototype.getChanges=function(){return this.getStore().then(function(e){return e.filter(undefined,"id",{offset:0,limit:500})}).then(function(e){return e.forEach(function(e){e.params=JSON.parse(e.params)}),e})},e.prototype.getErrors=function(){return this.getStore().then(function(e){return e.filter([{attributeName:"hasError",attributeValue:1,attributeType:"NUMBER",filterCondition:"EQUALS"}])})},e.prototype.getLastPushInfo=function(){return this.localKeyValueService.get(F).then(function(e){return v.isString(e.startTime)&&(e.startTime=new Date(e.startTime)),v.isString(e.endTime)&&(e.endTime=new Date(e.endTime)),e})},e.prototype.getLogLength=function(){return this.getStore().then(function(e){return e.count([{attributeName:"hasError",attributeValue:0,attributeType:"NUMBER",filterCondition:"EQUALS"}])})},e.prototype.getStore=function(){return this.localDBManagementService.getStore("wavemaker","offlineChangeLog")},e.prototype.isFlushInProgress=function(){return!(_.isUndefined(this.deferredFlush)||_.isNull(this.deferredFlush))},e.prototype.stop=function(){var t=this;return new Promise(function(e){t.deferredFlush?(t.deferredFlush.promise["catch"]().then(e),t.deferredFlush.promise.abort()):e()})},e.prototype.createContext=function(){var e=this;return this.localKeyValueService.get(w).then(function(n){return n=n||{},{clear:function(){return n={},e.localKeyValueService.remove(w)},get:function(e){var t=n[e];return t||(t={},n[e]=t),t},save:function(){return e.localKeyValueService.put(w,n)}}})},e.prototype._flush=function(n,r){var a=this;return(r=r||v.getAbortableDefer()).isAborted?Promise.resolve():(this.getNextChange().then(function(e){if(e)return e.params=JSON.parse(e.params),a.flushChange(e)}).then(function(t){if(n.next(a.currentPushInfo),t)return a.getStore().then(function(e){return e["delete"](t.id)}).then(function(){return a._flush(n,r)});r.resolve()},function(t){if(a.networkService.isConnected())t.hasError=1,t.params=JSON.stringify(t.params),a.getStore().then(function(e){return e.save(t)}).then(function(){return a._flush(n,r)});else{var e=a.networkService.onConnect();r.promise["catch"](function(){e&&e.abort()}),e.then(function(){a._flush(n,r),e=null})}}),r.promise)},e.prototype.flushChange=function(e){var t=this,n=this;return v.executePromiseChain(this.getWorkers("preCall"),[e]).then(function(){return e.hasError?Promise.reject(e.errorMessage):""}).then(function(){return v.executePromiseChain(t.getWorkers("transformParamsFromMap"),[e])}).then(function(){return t.pushService.push(e)}).then(function(){return v.executePromiseChain(_.reverse(n.getWorkers("postCallSuccess")),[e,arguments]).then(function(){return e})})["catch"](function(){return n.networkService.isConnected()?v.executePromiseChain(_.reverse(n.getWorkers("postCallError")),[e,arguments])["catch"](v.noop).then(function(){return Promise.reject(e)}):Promise.reject(e)})},e.prototype.getNextChange=function(){var t=[{attributeName:"hasError",attributeValue:0,attributeType:"NUMBER",filterCondition:"EQUALS"}];return this.getStore().then(function(e){return e.filter(t,"id",{offset:0,limit:1})}).then(function(e){return e&&e[0]})},e.prototype.getWorkers=function(t){return _.map(this.workers,function(e){return e[t]&&e[t].bind(e)})},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:I},{type:f},{type:P},{type:u.NetworkService}]},e.ngInjectableDef=o.defineInjectable({factory:function(){return new e(o.inject(I),o.inject(f),o.inject(P),o.inject(u.NetworkService))},token:e,providedIn:"root"}),e}(),L=function(){function e(e,t,n){this.changeLogService=e,this.localKeyValueService=t,this.pushInfo=n,this.logger=window.console}return e.prototype.onAddCall=function(e){this.logger.debug("Added the following call %o to log.",e)},e.prototype.preFlush=function(e){var t=this;return this.pushInfo.totalTaskCount=0,this.pushInfo.successfulTaskCount=0,this.pushInfo.failedTaskCount=0,this.pushInfo.completedTaskCount=0,this.pushInfo.inProgress=!0,this.pushInfo.startTime=new Date,this.flushContext=e,this.logger.debug("Starting flush"),this.changeLogService.getStore().then(function(e){return e.count([{attributeName:"hasError",attributeValue:0,attributeType:"NUMBER",filterCondition:"EQUALS"}])}).then(function(e){return t.pushInfo.totalTaskCount=e})},e.prototype.postFlush=function(e,t){this.logger.debug("flush completed. {Success : %i , Error : %i , completed : %i, total : %i }.",this.pushInfo.successfulTaskCount,this.pushInfo.failedTaskCount,this.pushInfo.completedTaskCount,this.pushInfo.totalTaskCount),this.pushInfo.inProgress=!1,this.pushInfo.endTime=new Date,this.localKeyValueService.put(F,this.pushInfo),this.flushContext=null},e.prototype.preCall=function(e){this.logger.debug("%i. Invoking call %o",1+this.pushInfo.completedTaskCount,e)},e.prototype.postCallError=function(e,t){return this.pushInfo.completedTaskCount++,this.pushInfo.failedTaskCount++,this.logger.error("call failed with the response %o.",t),this.flushContext.save()},e.prototype.postCallSuccess=function(e,t){return this.pushInfo.completedTaskCount++,this.pushInfo.successfulTaskCount++,this.logger.debug("call returned the following response %o.",t),this.flushContext.save()},e}(),k=function(){function e(e){this.localDBManagementService=e,this.searchTableData=this.readTableData.bind(this),this.searchTableDataWithQuery=this.readTableData.bind(this),this.getDistinctDataByFields=this.readTableData.bind(this)}return e.prototype.getStore=function(e){return this.localDBManagementService.getStore(e.dataModelName,e.entityName)},e.prototype.insertTableData=function(t,n,e){this.getStore(t).then(function(e){return e.primaryKeyField&&"identity"===e.primaryKeyField.generatorType&&t.data[e.primaryKeyName]&&delete t.data[e.primaryKeyName],e.add(t.data).then(function(){e.refresh(t.data).then(n)})})["catch"](e)},e.prototype.insertMultiPartTableData=function(t,n,r){var a=this;this.getStore(t).then(function(e){e.serialize(t.data).then(function(e){t.data=e,a.insertTableData(t,n,r)})})["catch"](r)},e.prototype.updateTableData=function(t,n,e){this.getStore(t).then(function(e){return e.save(t.data).then(function(){e.refresh(t.data).then(n)})})["catch"](e)},e.prototype.updateMultiPartTableData=function(e,t,n){var r=e.data&&e.data.rowData||e.data;this.getStore(e).then(function(e){return e.save(r)}).then(function(){t&&t(r)})["catch"](n)},e.prototype.deleteTableData=function(r,a,e){this.getStore(r).then(function(e){var t=e.primaryKeyField,n=r[t.fieldName]||r[t.name]||r.data&&r.data[t.fieldName]||r.id;e["delete"](n).then(a)})["catch"](e)},e.prototype.readTableData=function(i,o,e){var n=this;this.getStore(i).then(function(a){var e=i.filter(function(e,t){n.convertFieldNameToColumnName(a,e,t)},!0);return e=e.replace(/wm_bool\('true'\)/g,1).replace(/wm_bool\('false'\)/g,0),a.count(e).then(function(n){var r=i.sort.split("=")[1];return a.filter(e,r,{offset:(i.page-1)*i.size,limit:i.size}).then(function(e){var t=Math.ceil(n/i.size);o({content:e,first:1===i.page,last:i.page===t,number:i.page-1,numberOfElements:e.length,size:i.size,sort:{sorted:!!r,unsorted:!r},totalElements:n,totalPages:t})})})})["catch"](e)},e.prototype.escapeName=function(e){return e?'"'+(e=e.replace(/"/g,'""')).replace(/\./g,'"."')+'"':e},e.prototype.getColumnName=function(e,t){if(e.fieldToColumnMapping[t]){var n=this.escapeName(e.fieldToColumnMapping[t]);return n.indexOf(".")<0?this.escapeName(e.entitySchema.name)+"."+n:n}return t},e.prototype.convertFieldNameToColumnName=function(n,e,t){var r=this;_.forEach(e.rules,function(e){e.rules?r.convertFieldNameToColumnName(n,e):e.target=r.getColumnName(n,e.target)}),t&&t.filterFields&&(t.filterFields=_.mapKeys(t.filterFields,function(e,t){return r.getColumnName(n,t)}))},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:I}]},e.ngInjectableDef=o.defineInjectable({factory:function(){return new e(o.inject(I))},token:e,providedIn:"root"}),e}(),O=function(){function e(){this.logger=window.console}return e.prototype.preFlush=function(e){this.fileStore=e.get("offlineFileUpload")},e.prototype.preCall=function(e){var n=this;"DatabaseService"===e.service&&(e.params.data=_.mapValues(e.params.data,function(e){var t=n.fileStore[e];return t?(n.logger.debug("swapped file path from %s -> %s",e,t),t):e}))},e.prototype.postCallSuccess=function(e,t){if("OfflineFileUploadService"===e.service&&"uploadToServer"===e.operation){var n=JSON.parse(t[0].text)[0];this.fileStore[e.params.file]=n.path,this.fileStore[e.params.file+"?inline"]=n.inlinePath}},e}(),A=function(){function e(e,t,n,r){this.changeLogService=e,this.deviceFileService=t,this.localDBManagementService=n,this.file=r}return e.prototype.preExport=function(e,t){var n=this.deviceFileService.getUploadDirectory(),r=n.lastIndexOf("/"),a=n.substring(0,r+1),i=n.substring(r+1);return t.uploadDir=n,this.file.copyDir(a,i,e,"uploads")},e.prototype.postImport=function(e,t){var n=this,r=this.deviceFileService.getUploadDirectory(),a=r.lastIndexOf("/"),i=r.substring(0,a+1),o=r.substring(a+1);return this.uploadDir=r,this.file.checkDir(e,"uploads").then(function(){return n.deviceFileService.removeDir(r).then(function(){return n.file.copyDir(e,"uploads",i,o)}).then(function(){return n.updateChanges(t)})},v.noop)},e.prototype.getChanges=function(t,n){return this.changeLogService.getStore().then(function(e){return e.filter([],"id",{offset:(t-1)*n,limit:n})})},e.prototype.updateDBChange=function(r,a,i){var e=this,o={},t=r.params.entityName,n=r.params.dataModelName;r.params.data=_.mapValues(r.params.data,function(e,t){var n=e,r=!1;return _.isString(e)?(n=_.replace(e,a,i),r=!_.isEqual(n,e)):_.isObject(e)&&e.wmLocalPath&&(n=_.replace(e.wmLocalPath,a,i),r=!_.isEqual(n,e.wmLocalPath)),r&&(o[t]=n),n}),_.isEmpty(o)||this.localDBManagementService.getStore(n,t).then(function(t){if(t.primaryKeyField&&"identity"===t.primaryKeyField.generatorType){var e=t.primaryKeyName,n=r.params.data[e];return t.get(n).then(function(e){return t.save(_.assignIn(e,o))})}}).then(function(){return r.params=JSON.stringify(r.params),e.changeLogService.getStore().then(function(e){return e.save(r)})})},e.prototype.updateChange=function(t,e){return t.params=JSON.parse(t.params),"OfflineFileUploadService"===t.service&&"uploadToServer"===t.operation?(t.params.file=_.replace(t.params.file,e.uploadDir,this.uploadDir),t.params=JSON.stringify(t.params),this.changeLogService.getStore().then(function(e){return e.save(t)})):"DatabaseService"===t.service?this.updateDBChange(t,e.uploadDir,this.uploadDir):void 0},e.prototype.updateChanges=function(t,n){var r=this;void 0===n&&(n=1);return this.getChanges(n,10).then(function(e){if(e&&0<e.length)return Promise.all(e.map(function(e){return r.updateChange(e,t)}))}).then(function(e){if(e&&10===e.length)return r.updateChanges(t,n+1)})},e}(),x=function(){function e(e){this.localDBManagementService=e}return e.prototype.preFlush=function(e){this.errorStore=e.get("errorBlockerStore")},e.prototype.preCall=function(t){var n=this;if(t&&"DatabaseService"===t.service){var r=t.params.entityName,a=t.params.dataModelName;switch(t.operation){case"insertTableData":case"insertMultiPartTableData":case"updateTableData":case"updateMultiPartTableData":return this.localDBManagementService.getStore(a,r).then(function(e){n.blockCall(e,t,a,r,t.params.data)});case"deleteTableData":return this.localDBManagementService.getStore(a,r).then(function(e){n.blockCall(e,t,a,r,t.params)})}}},e.prototype.postCallSuccess=function(n){var r=this;if(n&&"DatabaseService"===n.service){var a=n.params.entityName,i=n.params.dataModelName;return this.localDBManagementService.getStore(i,a).then(function(e){var t=n.dataLocalId||n.params.data[e.primaryKeyName];_.isUndefined(t)||_.isNull(t)||r.removeError(i,a,t)})}},e.prototype.postCallError=function(n){var r=this;if(n&&"DatabaseService"===n.service){var a=n.params.entityName,i=n.params.dataModelName;return this.localDBManagementService.getStore(i,a).then(function(e){var t=n.dataLocalId||n.params.data&&n.params.data[e.primaryKeyName]||n.params[e.primaryKeyName]||n.params.id;_.isUndefined(t)||_.isNull(t)||r.recordError(i,a,t)})}},e.prototype.blockCall=function(n,r,a,e,i){var o=this;0===r.hasError&&(this.checkForPreviousError(n,r,a,e,i),n.entitySchema.columns.forEach(function(t){t.foreignRelations&&t.foreignRelations.some(function(e){return i[e.sourceFieldName]?o.blockCall(n,r,a,e.targetEntity,i[e.sourceFieldName]):i[t.fieldName]&&o.checkForPreviousError(n,r,a,e.targetEntity,i,t.fieldName),1===r.hasError})}))},e.prototype.checkForPreviousError=function(e,t,n,r,a,i){var o=i||e.primaryKeyName;this.hasError(n,r,a[o])&&(t.hasError=1,t.errorMessage="Blocked call due to error in previous call of entity [ "+r+" ] with id [ "+a[o]+" ]")},e.prototype.hasError=function(e,t,n){return!!(this.errorStore[e]&&this.errorStore[e][t]&&this.errorStore[e][t][n])},e.prototype.removeError=function(e,t,n){this.errorStore[e]&&this.errorStore[e][t]&&this.errorStore[e][t][n]&&delete this.errorStore[e][t][n]},e.prototype.recordError=function(e,t,n){this.errorStore[e]=this.errorStore[e]||{},this.errorStore[e][t]=this.errorStore[e][t]||{},this.errorStore[e][t][n]=!0},e}(),R=function(){function e(e){this.localDBManagementService=e,this.logger=window.console}return e.prototype.preFlush=function(e){this.idStore=e.get("idConflictResolution")},e.prototype.preCall=function(r){var a=this;if(r&&"DatabaseService"===r.service){var i=r.params.entityName,o=r.params.dataModelName;switch(r.operation){case"insertTableData":case"insertMultiPartTableData":return r.params.skipLocalDB=!0,this.localDBManagementService.getStore(o,i).then(function(t){var n=t.primaryKeyName;return n&&(a.transactionLocalId=r.params.data[n],r.dataLocalId=a.transactionLocalId),a.exchangeIds(t,o,i,r.params.data).then(function(){if(t.primaryKeyField&&"identity"===t.primaryKeyField.generatorType)delete r.params.data[n];else{var e=t.getValue(r.params.data,t.primaryKeyName);v.isDefined(e)&&(r.params.data[n]=e,null!==a.transactionLocalId&&a.pushIdToStore(o,i,a.transactionLocalId,e)),a.transactionLocalId=null}})});case"updateTableData":case"updateMultiPartTableData":case"deleteTableData":return this.localDBManagementService.getStore(o,i).then(function(e){if(a.exchangeId(e,o,i,r.params,"id"),r.params.data)return a.exchangeIds(e,o,i,r.params.data)})}}},e.prototype.postCallSuccess=function(e,t){var n=this;if(e&&"DatabaseService"===e.service&&("insertTableData"===e.operation||"insertMultiPartTableData"===e.operation)&&this.transactionLocalId){var r=t[0].body,a=e.params.entityName,i=e.params.dataModelName;return this.localDBManagementService.getStore(i,a).then(function(e){return n.pushIdToStore(i,a,n.transactionLocalId,r[e.primaryKeyName]),e["delete"](n.transactionLocalId)["catch"](v.noop).then(function(){return n.transactionLocalId=null,e.save(r)})})}},e.prototype.postCallError=function(t){var n=this;if(t&&"DatabaseService"===t.service&&("insertTableData"===t.operation||"insertMultiPartTableData"===t.operation)&&this.transactionLocalId){var e=t.params.entityName,r=t.params.dataModelName;return this.localDBManagementService.getStore(r,e).then(function(e){t.params.data[e.primaryKeyName]=n.transactionLocalId})}},e.prototype.getEntityIdStore=function(e,t){return this.idStore[e]=this.idStore[e]||{},this.idStore[e][t]=this.idStore[e][t]||{},this.idStore[e][t]},e.prototype.pushIdToStore=function(e,t,n,r){n!==r&&(this.getEntityIdStore(e,t)[n]=r,this.logger.debug("Conflict found for entity (%s) with local id (%i) and remote Id (%i)",t,n,r))},e.prototype.logResolution=function(e,t,n){this.logger.debug("Conflict resolved found for entity (%s) with local id (%i) and remote Id (%i)",e,t,n)},e.prototype.exchangeId=function(e,t,n,r,a){var i=a||e.primaryKeyName,o=this.getEntityIdStore(t,n);if(r&&i){for(var s=r[i],u=s;o[u];)u=o[u];u!==s&&(r[i]=u,this.logResolution(n,s,u))}},e.prototype.exchangeIds=function(n,r,e,a){var i=this;this.exchangeId(n,r,e,a);var o=[];return n.entitySchema.columns.forEach(function(e){e.foreignRelations&&e.foreignRelations.forEach(function(t){a[e.fieldName]&&i.exchangeId(n,r,t.targetEntity,a,e.fieldName),a[t.sourceFieldName]&&o.push(i.localDBManagementService.getStore(r,t.targetEntity).then(function(e){return i.exchangeIds(e,r,t.targetEntity,a[t.sourceFieldName])}))})}),Promise.all(o)},e.decorators=[{type:o.Injectable}],e.ctorParameters=function(){return[{type:I}]},e}(),B=function(){function e(e,t){this.deviceFileService=e,this.localDBManagementService=t}return e.prototype.postCallSuccess=function(e){var t=this;if(e&&"DatabaseService"===e.service)switch(e.operation){case"insertMultiPartTableData":case"updateMultiPartTableData":_.forEach(e.params.data,function(e){_.isObject(e)&&e.wmLocalPath&&t.deviceFileService.removeFile(e.wmLocalPath)})}},e.prototype.transformParamsFromMap=function(t){if(t&&"DatabaseService"===t.service)switch(t.operation){case"insertMultiPartTableData":case"updateMultiPartTableData":return this.localDBManagementService.getStore(t.params.dataModelName,t.params.entityName).then(function(e){return e.deserialize(t.params.data).then(function(e){t.params.data=e})})}},e.prototype.transformParamsToMap=function(n){if(n&&"DatabaseService"===n.service)switch(n.operation){case"insertMultiPartTableData":case"updateMultiPartTableData":return this.localDBManagementService.getStore(n.params.dataModelName,n.params.entityName).then(function(t){return t.serialize(n.params.data).then(function(e){return n.params.data=e,t.save(_.mapValues(e,function(e){return _.isObject(e)&&e.wmLocalPath||e})),e})})}},e}(),j=[{name:"insertTableData",type:"INSERT"},{name:"insertMultiPartTableData",type:"INSERT"},{name:"updateTableData",type:"UPDATE"},{name:"updateMultiPartTableData",type:"UPDATE"},{name:"deleteTableData",type:"DELETE"},{name:"readTableData",type:"READ",saveResponse:!0},{name:"searchTableData",type:"READ",saveResponse:!0},{name:"searchTableDataWithQuery",type:"READ",saveResponse:!0},{name:"getDistinctDataByFields",type:"READ",saveResponse:!1}],q=!1,U=function(){function e(e,t,n,r,a){this.changeLogService=e,this.httpService=t,this.localDBManagementService=n,this.networkService=r,this.offlineDBService=a,this.onlineDBService=c.LVService}return e.prototype.add=function(){var o=this;if(!q){q=!0;var t=this.httpService.sendCallAsObservable;t&&(this.httpService.sendCallAsObservable=function(e,r){!r&&_.get(e,"url")&&(r={url:e.url});var a=_.clone(r.url);r=_.extend(r,e);var i=_.find(j,{name:_.get(r,"operation")});return o.networkService.isConnected()||r.onlyOnline||!i||!r.dataModelName?s.from(o.remoteDBcall(i,t,r)):s.from(o.localDBManagementService.isOperationAllowed(r.dataModelName,r.entityName,i.type).then(function(e){var n;return e?Promise.resolve().then(function(){if(!r.isCascadingStopped&&("insertTableData"===i.name||"updateTableData"===i.name))return o.prepareToCascade(r).then(function(e){return n=e})}).then(function(){return new Promise(function(e,t){o.localDBcall(i,r,e,t,a)})}).then(function(t){return n?n.cascade().then(function(){return o.getStore(r).then(function(e){return e.refresh(t.body)}).then(function(e){return t&&t.body&&(t.body=e),t})}):t}):o.remoteDBcall(i,t,r)}))})}},e.prototype.getStore=function(e){return this.localDBManagementService.getStore(e.dataModelName,e.entityName)},e.prototype.hasBlob=function(e){return!!_.filter(e.entitySchema.columns,{sqlType:"blob"}).length},e.prototype.localDBcall=function(n,r,t,e,a){var i=this;return new Promise(function(t,e){i.offlineDBService[n.name](r,function(e){if("READ"!==n.type)return r.onlyOnline=!0,r.url=a,i.changeLogService.add("DatabaseService",n.name,r).then(function(){return t(e)});t(e)})}).then(function(e){return e={body:e,type:h},v.triggerFn(t,e),e},e)},e.prototype.remoteDBcall=function(n,r,a){var i=this;return new Promise(function(e,t){r.call(i.httpService,a).subscribe(function(t){t&&t.type&&(a.skipLocalDB||i.offlineDBService.getStore(a).then(function(e){"READ"===n.type&&n.saveResponse?e.saveAll(t.body.content):("INSERT"===n.type&&((a=_.clone(a)).data=_.clone(t.body)),i.offlineDBService[n.name](a,v.noop,v.noop))})["catch"](v.noop),e(t))},function(e){t(e)})})},e.prototype.prepareToCascade=function(u){var c=this;return this.getStore(u).then(function(s){var r=[];return _.forEach(u.data,function(e,a){var t,i,o;if(_.isObject(e)&&!_.isArray(e)&&(t=s.entitySchema.columns.find(function(e){return e.primaryKey&&e.foreignRelations&&(i=e.foreignRelations.find(function(e){return e.sourceFieldName===a})),!!i})),t){(o=_.cloneDeep(u)).entityName=i.targetEntity,o.data=e;var n=c.getStore(o).then(function(t){var e=u.data,n=t.entitySchema.columns.find(function(e){return e.name===i.targetColumn});if(n&&n.foreignRelations){var r=n.foreignRelations.find(function(e){return e.targetTable===s.entitySchema.name}).sourceFieldName;o.data[r]=e}return e[a]=null,o.onlyOnline=!1,o.isCascadingStopped=!0,o.hasBlob=c.hasBlob(t),o.url="",function(){return Promise.resolve().then(function(){var e=t.getValue(o.data,t.primaryKeyField.fieldName);return e?t.get(e):null}).then(function(e){var t;return t=e?o.hasBlob?"updateMultiPartTableData":"updateTableData":o.hasBlob?"insertMultiPartTableData":"insertTableData",c.onlineDBService[t](o).toPromise()})}});r.push(n)}}),Promise.all(r).then(function(e){return{cascade:function(){return Promise.all(e.map(function(e){return e()}))}}})})},e}(),K=!1,V=function(){function e(e,t,n,r,a,i){this.changeLogService=e,this.deviceFileService=t,this.deviceFileUploadService=n,this.file=r,this.networkService=a,this.uploadDir=i}return e.prototype.add=function(){var o=this;if(!K){K=!0;var s=this.deviceFileUploadService.upload;this.deviceFileUploadService.uploadToServer=s,this.deviceFileUploadService.upload=function(e,t,n,r,a,i){return o.networkService.isConnected()?s.call(o.deviceFileUploadService,e,t,n,r,a,i):o.uploadLater(e,t,n,r,a,i).then(function(e){return{text:JSON.stringify(e),headers:null,response:e}})}}},e.prototype.uploadLater=function(e,t,n,r,a,i){var o=this,s=n.lastIndexOf("/"),u=n.substring(0,s),c=n.substring(s+1),l=this.deviceFileService.appendToFileName(c),p=this.uploadDir+"/"+l;return this.file.copyFile(u,c,this.uploadDir,l).then(function(){return o.changeLogService.add("OfflineFileUploadService","uploadToServer",{file:p,ftOptions:{fileKey:t,fileName:r},params:a,headers:i,serverUrl:e,deleteOnUpload:!0})}).then(function(){return[{fileName:c,path:p,length:0,success:!0,inlinePath:p+"?inline"}]})},e}(),Q=/^\d+(\.\d+)?$/,z=!1,W=function(){function e(e,t,n,r){this.changeLogService=e,this.httpService=t,this.localDBManagementService=n,this.networkService=r}return e.prototype.add=function(){var n=this;if(!z){z=!0;var r=this.httpService.sendCallAsObservable;this.httpService.sendCallAsObservable=function(e,t){return!t&&_.get(e,"url")&&(t={url:e.url}),!n.networkService.isConnected()&&0<t.url.indexOf("/queryExecutor/")?s.from(n.executeLocally(t)):r.call(n.httpService,e,t)}}},e.prototype.executeLocally=function(n){var r=this,e=n.url,t=0<e.indexOf("?"),a=this.substring(e,"services/","/queryExecutor"),i=this.substring(e,"queries/",t?"?":undefined),o=t?this.getHttpParamMap(this.substring(e,"?",undefined)):{},s=this.getHttpParamMap(n.dataParams),u=_.extend(o,s);return this.localDBManagementService.executeNamedQuery(a,i,u).then(function(e){var t=e.rows;return e.rowsAffected?r.changeLogService.add("WebService","invokeJavaService",n).then(function(){return e.rowsAffected}):{type:h,body:{totalPages:t&&0<t.length?1:0,totalElements:t.length,first:!0,sort:null,numberOfElements:t.length,last:!0,size:n.size,number:0,content:t}}})},e.prototype.substring=function(e,t,n){if(t){var r=e.indexOf(t)+t.length,a=n?e.indexOf(n):undefined;return e.substring(r,a)}return undefined},e.prototype.getHttpParamMap=function(e){var n={};return e&&(e=decodeURIComponent(e)).split("&").forEach(function(e){var t=e.split("=");_.isEmpty(_.trim(t[1]))||!Q.test(t[1])?n[t[0]]=t[1]:n[t[0]]=parseInt(t[1],10)}),n},e}(),Y="logged-in-user.info",J=!1,H=function(){function e(e,t,n,r,a){var i=this;this.app=e,this.file=t,this.deviceService=n,this.networkService=r,this.securityService=a,this.saveSecurityConfigLocally=_.debounce(function(e){i._saveSecurityConfigLocally(e)},1e3)}return e.prototype.add=function(){var n=this;if(!J){J=!0;var r=this.securityService.load,a=this.securityService.appLogout;this.securityService.load=function(){return new Promise(function(t,e){n.networkService.isConnected()?r.call(n.securityService).then(function(e){n.securityConfig=e,n.saveSecurityConfigLocally(e),t(n.securityConfig)},e):n.readLocalSecurityConfig().then(function(e){return void 0===e&&(e={}),n.securityConfig=e,n.securityService.config=e},function(){return r.call(n.securityConfig)}).then(t,e)})},this.securityService.appLogout=function(e,t){n.securityConfig={authenticated:!1,loggedOut:!0,securityEnabled:n.securityConfig&&n.securityConfig.securityEnabled,loggedOutOffline:!n.networkService.isConnected(),loginConfig:n.securityConfig&&n.securityConfig.loginConfig,userInfo:null},n._saveSecurityConfigLocally(n.securityConfig)["catch"](v.noop).then(function(){n.networkService.isConnected()?a.call(n.securityService,e,t):location.assign(window.location.origin+window.location.pathname)})},this.securityService.isAuthenticated=function(e){v.triggerFn(e,!0===n.securityConfig.authenticated)},this.deviceService.whenReady().then(function(){return n.clearLastLoggedInUser()}),this.app.subscribe("onNetworkStateChange",function(e){e.isConnected&&n.clearLastLoggedInUser()})}},e.prototype._saveSecurityConfigLocally=function(e){return this.file.writeFile(cordova.file.dataDirectory,Y,JSON.stringify(e),{replace:!0})},e.prototype.clearLastLoggedInUser=function(){var t=this;return this.readLocalSecurityConfig().then(function(e){e&&e.loggedOutOffline?t.securityService.appLogout(null,null):t.networkService.isConnected()||(t.securityConfig=e||{})})},e.prototype.readLocalSecurityConfig=function(){var r=this;return new Promise(function(t,n){var e=cordova.file.dataDirectory;r.file.checkFile(e,Y).then(function(){return r.readFileAsTxt(e,Y).then(t,n)},function(){var e=cordova.file.applicationDirectory+"www/metadata/app";return r.readFileAsTxt(e,"security-config.json").then(t,n)})})},e.prototype.readFileAsTxt=function(e,t){return this.file.readAsText(e,t).then(JSON.parse)["catch"](v.noop)},e}(),G=function(){function p(e,t,n,r,a,i,o,s,u,c,l){v.hasCordova()&&p.initialize(e,t,n,r,a,i,o,s,u,c,l)}return p.initialize=function(e,t,n,r,a,i,o,s,u,c,l){this.initialized||(n.addStartUpService({serviceName:"OfflineStartupService",start:function(){return window.SQLitePlugin?(s.setLogSQl("true"===sessionStorage.getItem("wm.logSql")||"true"===sessionStorage.getItem("debugMode")),window.logSql=function(e){void 0===e&&(e=!0),s.setLogSQl(e),sessionStorage.setItem("wm.logSql",e?"true":"false")},window.executeLocalSql=function(e,t,n){s.executeSQLQuery(e,t,n,!0)},s.loadDatabases().then(function(){t.addWorker(new R(s)),t.addWorker(new x(s)),t.addWorker(new O),t.addWorker(new B(r,s)),new U(t,o,s,c,u).add(),new V(t,r,a,i,c,r.getUploadDirectory()).add(),new W(t,o,s,c).add(),s.registerCallback(new A(t,r,s,i)),t.addWorker({onAddCall:function(){c.isConnected()||c.disableAutoConnect()},postFlush:function(e){0<e.totalTaskCount&&s.close()["catch"](v.noop).then(function(){location.assign(window.location.origin+window.location.pathname)})}})})):Promise.resolve()}}),new H(e,i,n,c,l).add())},p.initialized=!1,p.decorators=[{type:o.NgModule,args:[{imports:[t.CommonModule],declarations:[],exports:[],providers:[],entryComponents:[]}]}],p.ctorParameters=function(){return[{type:v.App},{type:M},{type:u.DeviceService},{type:u.DeviceFileService},{type:u.DeviceFileUploadService},{type:r.File},{type:v.AbstractHttpService},{type:I},{type:k},{type:u.NetworkService},{type:i.SecurityService}]},p}(),X=function(){function e(e){this.deviceFileUploadService=e}return e.prototype.getPromiseFromObs=function(n){return new Promise(function(t,e){n.subscribe(function(e){e&&e.type&&t(e)},e)})},e.prototype.push=function(e){var t=e.params;switch(e.service){case"DatabaseService":switch(e.operation){case"insertTableData":return this.getPromiseFromObs(c.LVService.insertTableData(e.params,null,null));case"insertMultiPartTableData":return this.getPromiseFromObs(c.LVService.insertMultiPartTableData(e.params,null,null));case"updateTableData":return this.getPromiseFromObs(c.LVService.updateTableData(e.params,null,null));case"updateMultiPartTableData":return this.getPromiseFromObs(c.LVService.updateMultiPartTableData(e.params,null,null));case"deleteTableData":return this.getPromiseFromObs(c.LVService.deleteTableData(e.params,null,null))}case"OfflineFileUploadService":if("uploadToServer"===e.operation)return this.deviceFileUploadService.uploadToServer.call(this.deviceFileUploadService,t.serverUrl,t.ftOptions.fileKey,t.file,t.ftOptions.fileName,t.params,t.headers)}return Promise.reject(e.service+" service with operation "+e.operation+" is not supported for push.")},e.decorators=[{type:o.Injectable}],e.ctorParameters=function(){return[{type:u.DeviceFileUploadService}]},e}(),Z="localDBManager.lastPullInfo",ee=function(){var r={};return{start:function(e){e.$$pullProcessId="PULL_"+_.now()},add:function(e,t){var n=e.$$pullProcessId;r[n]||(r[n]=[]),r[n].push(t)},remove:function(e,t){var n=e.$$pullProcessId;_.remove(r[n],t),_.isEmpty(r[n])&&delete r[n]},abort:function(e){var t=e.$$pullProcessId;return r[t]&&(_.forEach(r[t],function(e){e&&e.abort&&e.abort()}),delete r[t]),e.$$isMarkedToAbort=!0,e["catch"](function(){return"cancelled"})}}},te=ee(),ne=function(){function e(e,t,n,r){var a=this;this.app=e,this.localDBManagementService=t,this.localKeyValueService=n,this.networkService=r,this.localDBManagementService.registerCallback({onDbCreate:function(e){a.localKeyValueService.put(Z,{databases:[],totalRecordsToPull:0,totalPulledRecordCount:0,startTime:new Date(0),endTime:new Date(e.dbSeedCreatedOn)})}})}return e.prototype.addDeltaCriteria=function(a,i,o){var s,e=this,t=a.schema.entities[i],u=t.pullConfig.deltaFieldName,c=_.find(t.columns,{fieldName:u})||{};return _.isEmpty(u)?Promise.resolve(o):this.localDBManagementService.isBundled(a.schema.name,i).then(function(e){return s=e}).then(function(){return e.getLastPullInfo()}).then(function(e){var t=e&&e.startTime&&e.startTime.getTime(),n=_.find(e&&e.databases,{name:a.schema.name}),r=_.find(n&&n.entities,{entityName:i})||{};return!t&&s&&(t=e&&e.endTime&&e.endTime.getTime(),r.query=o),r.query===o&&0<t&&(_.isEmpty(o)?o="":o+=" AND ","datetime"===c.sqlType?o+=u+" > wm_dt('"+moment(t).utc().format("YYYY-MM-DDTHH:mm:ss")+"')":o+=u+" > wm_ts('"+t+"')"),o},function(){return Promise.resolve(o)})},e.prototype.copyDataFromRemoteDBToLocalDB=function(o,s,t,u,c){var l,p=this,f=o.stores[s],h=o.schema.entities[s],m={entityName:s,totalRecordsToPull:0,pulledRecordCount:0},d=0,y=!1;return new Promise(function(i,e){p.prepareQuery(o,s).then(function(e){return m.query=e,p.addDeltaCriteria(o,s,e)}).then(function(e){return t&&m.query===e?f.clear().then(function(){return e}):e}).then(function(e){return l=_.isEmpty(e)?"":"q="+e,p.getTotalRecordsToPull(o,h,l,u)}).then(function(e){var t=h.pullConfig.size||100,n=Math.ceil(e/t);m.totalRecordsToPull=e;var r=h.pullConfig.orderBy;r=(_.isEmpty(r)?"":r+",")+f.primaryKeyName,c.next(m);var a={next:function(e){d++,e=_.slice(e,0,m.totalRecordsToPull-m.pulledRecordCount),f.saveAll(e).then(function(){m.pulledRecordCount+=e?e.length:0,c.next(m)})["catch"](v.noop).then(function(){0===--d&&y&&i(m)})},error:null,complete:null};return p._pullEntityData(o,s,l,r,n,t,1,u,undefined,a)}).then(null,e)["catch"](v.noop).then(function(){y=!0,0===d&&i(m)})})},e.prototype.evalIfBind=function(e){return _.startsWith(e,"bind:")?(e=e.replace(/\[\$\i\]/g,"[0]"),v.$parseExpr(e.replace("bind:",""))(this.app)):e},e.prototype.executeDatabaseCountQuery=function(n){return new Promise(function(t,e){c.LVService.countTableDataWithQuery(n,null,null).subscribe(function(e){return t(e.body)},e)})},e.prototype.executeDatabaseSearchQuery=function(n){return new Promise(function(t,e){return c.LVService.searchTableDataWithQuery(n,null,null).subscribe(function(e){return t(e&&e.body&&e.body.content)},e)})},e.prototype.getTotalRecordsToPull=function(e,r,t,n){var a=this,i={dataModelName:e.schema.name,entityName:r.entityName,data:t};return this.retryIfNetworkFails(function(){return a.executeDatabaseCountQuery(i).then(function(e){var t=e,n=_.parseInt(r.pullConfig.maxNumberOfRecords);return _.isNaN(n)||n<=0||t<n?t:n})},n)},e.prototype.prepareQuery=function(e,t){var n,r=this,a=e.schema.entities[t];return this.localDBManagementService.isBundled(e.schema.name,t).then(function(e){var t=!1;if(e||_.isEmpty(a.pullConfig.query)){if(n=_.cloneDeep(a.pullConfig.filter),n=_.map(n,function(e){return e.attributeValue=r.evalIfBind(e.attributeValue),t=t||_.isNil(e.attributeValue),e}),t)return Promise.reject("Null criteria values are present");n=_.sortBy(n,"attributeName"),n=c.LiveVariableUtils.getSearchQuery(n," AND ",!0)}else n=r.evalIfBind(a.pullConfig.query);return _.isNil(n)?Promise.resolve(null):Promise.resolve(encodeURIComponent(n))})},e.prototype._pullDbData=function(i,o,s,u){var c=this,t=i.schema.name,l={name:i.schema.name,entities:[],totalRecordsToPull:0,pulledRecordCount:0,completedTaskCount:0,totalTaskCount:0},r=[];return _.forEach(i.schema.entities,function(e){r.push(c.localDBManagementService.getStore(t,e.entityName))}),new Promise(function(n,a){Promise.all(r).then(function(e){var r=[];e.forEach(function(e){var t=e.entitySchema.pullConfig,n=t.pullType;(n===p.APP_START||n===p.BUNDLED&&t.deltaFieldName)&&r.push(e.entitySchema)});var t=_.chain(r).map(function(e){var t={next:function(e){var t=_.findIndex(l.entities,{entityName:e.entityName});0<=t?l.entities[t]=e:l.entities.push(e),l.pulledRecordCount=_.reduce(l.entities,function(e,t){return e+t.pulledRecordCount},0),l.totalRecordsToPull=_.reduce(l.entities,function(e,t){return e+t.totalRecordsToPull},0),u.next(l)},error:null,complete:null};return c.copyDataFromRemoteDBToLocalDB(i,e.entityName,o,s,t).then(function(e){return l.completedTaskCount++,u.next(l),e},null)}).value();l.totalTaskCount=t.length,u.next(l),Promise.all(t).then(n,a)})})},e.prototype._pullEntityData=function(t,n,r,a,i,o,s,u,c,l){var p=this,e=t.schema.name;if(c||(c=v.defer()),i<s)return c.resolve();var f={dataModelName:e,entityName:n,page:s,size:o,data:r,sort:a,onlyOnline:!0,skipLocalDB:!0};return this.retryIfNetworkFails(function(){return p.executeDatabaseSearchQuery(f)},u).then(function(e){l.next(e),p._pullEntityData(t,n,r,a,i,o,s+1,u,c,l)},c.reject),c.promise},e.prototype.retryIfNetworkFails=function(e,t){if(t.$$isMarkedToAbort)return Promise.reject("aborted");var n=this.networkService.retryIfNetworkFails(e);return te.add(t,n),n["catch"](v.noop).then(function(){te.remove(t,n)}),n},e.prototype.cancel=function(e){return te.abort(e)},e.prototype.getDb=function(t){return this.localDBManagementService.loadDatabases().then(function(e){return _.find(e,{name:t})||Promise.reject("Local database ("+t+") not found")})},e.prototype.getLastPullInfo=function(){return this.localKeyValueService.get(Z).then(function(e){return _.isString(e.startTime)&&(e.startTime=new Date(e.startTime)),_.isString(e.endTime)&&(e.endTime=new Date(e.endTime)),e})},e.prototype.pullAllDbData=function(n,r){var a=this,i=v.getAbortableDefer(),o={completedTaskCount:0,totalTaskCount:0,inProgress:!0,databases:[],totalRecordsToPull:0,totalPulledRecordCount:0,startTime:new Date,endTime:new Date};return this.localDBManagementService.loadDatabases().then(function(e){var t=_.chain(e).filter(function(e){return!e.schema.isInternal}).map(function(e){te.start(i.promise);var t={next:function(e){var t=_.findIndex(o.databases,{name:e.name});0<=t?o.databases[t]=e:o.databases.push(e),o.totalTaskCount=_.reduce(o.databases,function(e,t){return e+t.totalTaskCount},0),o.completedTaskCount=_.reduce(o.databases,function(e,t){return e+t.completedTaskCount},0),o.totalPulledRecordCount=_.reduce(o.databases,function(e,t){return e+t.pulledRecordCount},0),o.totalRecordsToPull=_.reduce(o.databases,function(e,t){return e+t.totalRecordsToPull},0),r.next(o)},error:null,complete:null};return a._pullDbData(e,n,i.promise,t)}).value();return Promise.all(t)}).then(function(){o.endTime=new Date,o.inProgress=!1,a.localKeyValueService.put(Z,o),i.resolve(o)},i.reject),i.promise},e.prototype.pullDbData=function(e,t,n){var r=this,a=v.getAbortableDefer();return this.getDb(e).then(function(e){return r._pullDbData(e,t,a.promise,n)}).then(a.resolve,a.reject),a.promise},e.prototype.pullEntityData=function(e,t,n,r){var a=this,i=v.getAbortableDefer();return this.getDb(e).then(function(e){return a.copyDataFromRemoteDBToLocalDB(e,t,n,i.promise,r)}).then(i.resolve,i.reject),i.promise},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:v.App},{type:I},{type:f},{type:u.NetworkService}]},e.ngInjectableDef=o.defineInjectable({factory:function(){return new e(o.inject(v.App),o.inject(I),o.inject(f),o.inject(u.NetworkService))},token:e,providedIn:"root"}),e}();e.ɵa=f,e.OfflineModule=G,e.PushService=P,e.CONTEXT_KEY=w,e.LAST_PUSH_INFO_KEY=F,e.ChangeLogService=M,e.PushServiceImpl=X,e.LocalDbService=k,e.LocalDBDataPullService=ne,e.ɵ0=ee,e.LocalDBManagementService=I,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.min.js.map