{"version":3,"file":"index.umd.js.map","sources":["ng://@wm/oAuth/oAuth.utils.ts","ng://@wm/oAuth/oAuth.service.ts","ng://@wm/oAuth/oAuth.module.ts","ng://@wm/oAuth/index.ts"],"sourcesContent":["import { _WM_APP_PROJECT, hasCordova, isIE } from '@wm/core';\n\ndeclare const moment, _;\n\nconst accessTokenSuffix = '.access_token';\nconst isWaveLens = false;\n\nexport const parseConfig = (serviceParams: any): any => {\n\n    let val, param, config;\n    const urlParams = serviceParams.urlParams;\n\n    config = {\n        url: 'services/oauth2/:providerId/authorizationUrl',\n        method: 'GET'\n    };\n\n    /*To handle dynamic urls, append the serviceParams.config.url with the static url(i.e., config.url)*/\n    if (serviceParams.config) {\n        config.url = (serviceParams.config.url || '') + config.url;\n        config.method = serviceParams.config.method || config.method;\n        config.headers = config.headers || {};\n\n        // TODO[Shubham] - change to for - of\n        for (const key in serviceParams.config.headers) {\n            val = serviceParams.config.headers[key];\n            config.headers[key] = val;\n        }\n    }\n    /* check for url parameters to replace the url */\n    if (urlParams) {\n        for (param in urlParams) {\n            if (urlParams.hasOwnProperty(param)) {\n                val = urlParams[param];\n                if (!_.isUndefined(val) && val !== null) {\n                    config.url = config.url.replace(new RegExp(':' + param, 'g'), val);\n                }\n            }\n        }\n    }\n\n    /* check for data */\n    if (serviceParams.params) {\n        config.params = serviceParams.params;\n    }\n    /* check for data */\n    if (!_.isUndefined(serviceParams.data)) {\n        config.data = serviceParams.data;\n    }\n    /* check for data parameters, written to support old service calls (.json calls) */\n    if (serviceParams.dataParams) {\n        config.data.params = serviceParams.dataParams;\n    }\n    /* check for headers */\n    if (serviceParams.headers) {\n        config.headers = serviceParams.headers;\n    }\n\n    /* set extra config flags */\n    config.byPassResult    = serviceParams.byPassResult;\n    config.isDirectCall    = serviceParams.isDirectCall;\n    config.isExtURL        = serviceParams.isExtURL;\n    config.preventMultiple = serviceParams.preventMultiple;\n    config.responseType    = serviceParams.responseType;\n\n    return config;\n};\n\nconst listeners = {},\n    ACCESSTOKEN_PLACEHOLDERS = {\n        'STUDIO': 'WM_STUDIO_',\n        'RUN': 'WM_RUN_'\n    },\n    newWindowProps = 'width=400,height=600';\n\n/**\n * This function remove the accessToken for a provider\n * @param provider\n */\nexport const removeAccessToken = (provider) => {\n    const accessTokenKey = getAccessTokenPlaceholder(provider);\n    sessionStorage.removeItem(accessTokenKey);\n};\n\n/**\n * This function returns the accesstoken placeholder based on the studio or run mode for the project\n * @param provider\n * @returns {*}\n */\nfunction getAccessTokenPlaceholder(provider) {\n    let accessTokenKey;\n    accessTokenKey = ACCESSTOKEN_PLACEHOLDERS.RUN + _WM_APP_PROJECT.id + '_' + provider + accessTokenSuffix;\n    return accessTokenKey;\n}\n\n/**\n * This function performs the fake local storage update, so the IE gets the latest token instead of returning the cached localStorageValue\n */\nfunction performFakeLocalStorageUpdate() {\n    const dummy_key = 'dummy_key';\n    localStorage.setItem(dummy_key, dummy_key);\n    localStorage.removeItem(dummy_key);\n}\n\n/**\n * This function sets the accessToken\n * @param provider\n * @param accesstoken\n */\nfunction setAccessToken(provider, accesstoken) {\n    const accessTokenKey = getAccessTokenPlaceholder(provider);\n    sessionStorage.setItem(accessTokenKey, accesstoken);\n}\n\n/**\n * this is a callback function to check if the authentication is done and invokes the successCallback\n * @param providerId\n * @param successCallback\n * @param evt\n */\nfunction checkAuthenticationStatus(providerId, successCallback, removeProviderConfigCallBack, evt) {\n    const accessTokenKey = providerId + accessTokenSuffix,\n        accessToken = localStorage.getItem(accessTokenKey);\n    if (evt && evt.origin !== window.location.origin) {\n        return;\n    }\n    if (accessToken) {\n        removeProviderConfigCallBack(providerId);\n        localStorage.removeItem(accessTokenKey);\n        setAccessToken(providerId, accessToken);\n        window.removeEventListener('message', listeners[providerId]);\n        setTimeout(() => {\n            delete listeners[providerId];\n            if (successCallback) {\n                successCallback(accessToken);\n            }\n        });\n    }\n}\n\n/**\n * this function keeps on checking the accesstoken in the LocalStorage and updates it accordingly\n * @param providerId\n * @param onSuccess\n * @param onError\n * @param startTime\n * @param loginObj\n */\nfunction checkAccessTokenInWindow(providerId, onSuccess, onError, startTime, loginObj, removeProviderConfigCallBack) {\n    performFakeLocalStorageUpdate();\n    const currentTime = moment.duration(moment().format('HH:mm'), 'HH:mm'),\n        timeDiff = currentTime.subtract(startTime),\n        accessToken = getAccessToken(providerId, true);\n    if (accessToken) {\n        loginObj.accesstoken_retrieved = true;\n        setAccessToken(providerId, accessToken);\n        localStorage.removeItem(providerId + accessTokenSuffix);\n        removeProviderConfigCallBack(providerId);\n        if (onSuccess) {\n            onSuccess();\n        }\n    } else if (timeDiff.minutes() > 1 && onSuccess && !loginObj.accesstoken_retrieved) {\n        onSuccess('error');\n    } else {\n        setTimeout(() => {\n            checkAccessTokenInWindow(providerId, onSuccess, onError, startTime, loginObj, removeProviderConfigCallBack);\n        }, 3000);\n    }\n}\n\n/**\n * checks for the window existence i.e if the window is manually closed by the user or any such\n * @param oAuthWindow\n * @param provider\n * @param callback\n */\nfunction checkForWindowExistence(oAuthWindow, provider, callback) {\n    if (oAuthWindow && listeners[provider]) {\n        if (!oAuthWindow.closed) { // .closed is supported across major browser vendors however for IE the user has to enable protected mode from security options\n            setTimeout(checkForWindowExistence.bind(undefined, oAuthWindow, provider, callback), 3000);\n        } else {\n            window.removeEventListener('message', listeners[provider]);\n            delete listeners[provider];\n            if (callback) {\n                callback('error');\n            }\n        }\n    }\n}\n/**\n * this functions handles the logic related to the window operations in IE\n * @param url\n * @param providerId\n * @param onSuccess\n * @param onError\n */\nfunction handleLoginForIE(url, providerId, onSuccess, onError, removeProviderConfigCallBack) {\n    const loginObj = {\n        'accesstoken_retrieved': false\n    };\n    window.open(url, '_blank', newWindowProps);\n    checkAccessTokenInWindow(providerId, onSuccess, onError, moment.duration(moment().format('HH:mm'), 'HH:mm'), loginObj, removeProviderConfigCallBack);\n}\n\n/**\n * this function adds the listener on the window and assigns the listener\n * @param provider\n * @param callback\n */\nfunction onAuthWindowOpen(provider, callback, removeProviderConfigCallBack) {\n    listeners[provider] = checkAuthenticationStatus.bind(undefined, provider, callback, removeProviderConfigCallBack);\n    window.addEventListener('message', listeners[provider], false);\n}\n\n/**\n * this function is a callback function which enables the listener and checks for the window existence\n * @param providerId\n * @param onSuccess\n * @param url\n */\nfunction postGetAuthorizationURL(url, providerId, onSuccess, removeProviderConfigCallBack) {\n    let oAuthWindow;\n\n     if (hasCordova()) {\n         window.open(url, '_system');\n         window['OAuthInMobile'](providerId).then(accessToken => {\n             const key = providerId + accessTokenSuffix;\n             if (accessToken) {\n                 localStorage.setItem(key, accessToken);\n                 checkAuthenticationStatus(providerId, onSuccess, removeProviderConfigCallBack, null);\n             } else {\n                 onSuccess('error');\n             }\n         });\n     } else {\n         oAuthWindow = window.open(url, '_blank', newWindowProps);\n         onAuthWindowOpen(providerId, onSuccess, removeProviderConfigCallBack);\n         checkForWindowExistence(oAuthWindow, providerId, onSuccess);\n     }\n}\n\n/**\n * function to get the authorization url\n * @param params provider id for which the auth url has to be fetched\n * @param successCallback callback to be invoked upon successful fetch of the providers\n * @param failureCallback callback to be invoked upon error\n * @returns {*}\n */\nfunction getAuthorizationUrl(params, http) {\n    const action = 'getAuthorizationUrl',\n        serviceSettings = parseConfig({\n            target: 'oauthConfiguration',\n            action: action,\n            urlParams: {\n                projectId: _WM_APP_PROJECT.id,\n                providerId: params.providerId\n            },\n            params: {\n                'requestSourceType': params.requestSourceType\n            }\n        });\n    return http.send(serviceSettings);\n}\n\n/**\n * this function retrieves the accessToken based on the run/studiomode\n * @param provider\n * @returns {*}\n */\nexport const getAccessToken = (provider, checkLocalStorage) => {\n    const accessTokenKey = getAccessTokenPlaceholder(provider);\n    if (checkLocalStorage) {\n        return localStorage.getItem(provider + accessTokenSuffix);\n    }\n    return sessionStorage.getItem(accessTokenKey);\n};\n\n\n/**\n * this function is used to perform the authorization by opening the window and having active listeners\n * @param url\n * @param providerId\n * @param onSuccess\n * @returns {*}\n */\nexport const performAuthorization = (url, providerId, onSuccess, onError, http, addProviderConfigCallBack, removeProviderConfigCallBack) => {\n    let requestSourceType = 'WEB';\n    if (url) {\n        if (isIE()) { // handling for IE\n            handleLoginForIE(url, providerId, onSuccess, onError, removeProviderConfigCallBack);\n        } else {\n            postGetAuthorizationURL(url, providerId, onSuccess, removeProviderConfigCallBack);\n        }\n    } else {\n        if (isWaveLens) {\n            requestSourceType = 'WAVELENS';\n        } else if (hasCordova()) {\n            requestSourceType = 'MOBILE';\n        }\n        return getAuthorizationUrl({\n            'providerId': providerId,\n            'requestSourceType': requestSourceType\n        }, http).then((response) => {\n            addProviderConfigCallBack({\n                name: providerId,\n                url: response.body,\n                invoke: () => {\n                    if (isIE()) { // handling for IE\n                        handleLoginForIE(response, providerId, onSuccess, onError, removeProviderConfigCallBack);\n                    } else {\n                        postGetAuthorizationURL(response.body, providerId, onSuccess, removeProviderConfigCallBack);\n                    }\n                }\n            });\n        });\n    }\n};\n","import { Injectable } from '@angular/core';\n\nimport { Observable, Subject } from 'rxjs';\n\nimport { AbstractHttpService } from '@wm/core';\n\nimport { getAccessToken, performAuthorization, removeAccessToken } from './oAuth.utils';\n\ndeclare const _;\n\n@Injectable()\nexport class OAuthService {\n    constructor(private httpService: AbstractHttpService) {}\n\n    providers = new Subject();\n\n    providersConfig = [];\n\n    getOAuthProvidersAsObservable(): Observable<any> {\n        return this.providers.asObservable();\n    }\n\n    addProviderConfig(provider) {\n        if (!(_.find(this.providersConfig, {'name' : provider.name}))) {\n            this.providersConfig.push(provider);\n        }\n        this.providers.next(this.providersConfig);\n    }\n\n    removeProviderConfig(providerId) {\n        _.remove(this.providersConfig, provider => provider.name === providerId);\n        this.providers.next(this.providersConfig);\n    }\n\n    perfromOAuthorization(url, providerId, onSuccess, onError) {\n        performAuthorization(url, providerId, onSuccess, onError, this.httpService, this.addProviderConfig.bind(this), this.removeProviderConfig.bind(this));\n    }\n\n    getAccessToken(provider, checkLocalStorage) {\n        return getAccessToken(provider, checkLocalStorage);\n    }\n\n    removeAccessToken(provider) {\n        removeAccessToken(provider);\n    }\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { OAuthService } from './oAuth.service';\n\n@NgModule({})\nexport class OAuthModule {\n\n    static forRoot(): ModuleWithProviders {\n        return {\n            ngModule: OAuthModule,\n            providers: [OAuthService]\n        };\n    }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["_WM_APP_PROJECT","hasCordova","isIE","Subject","Injectable","AbstractHttpService","NgModule"],"mappings":"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"}
