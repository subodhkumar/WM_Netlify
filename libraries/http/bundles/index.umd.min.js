!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("rxjs"),require("@wm/core"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("@wm/http",["exports","@angular/common","@angular/core","rxjs","@wm/core","@angular/common/http"],t):t((e.wm=e.wm||{},e.wm.http={}),e.ng.common,e.ng.core,e.rxjs,e.wm.core,e.ng.common.http)}(this,function(e,t,o,n,s,p){"use strict";var u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};function a(e,t){function r(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function c(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,s=r.call(e),u=[];try{for(;(void 0===t||0<t--)&&!(o=s.next()).done;)u.push(o.value)}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=s["return"])&&r.call(s)}finally{if(n)throw n.error}}return u}var r=function(r){function e(e){var t=r.call(this)||this;return t.httpClient=e,t.nonBodyTypeMethods=["GET","DELETE","HEAD","OPTIONS","JSONP"],t.sessionTimeoutObservable=new n.Subject,t.sessionTimeoutQueue=[],t}return a(e,r),e.prototype.handleSessionTimeout=function(e,t){this.sessionTimeoutQueue.push({requestInfo:e,sub401:t}),this.on401()},e.prototype.generateRequest=function(e){var t,r,n=new p.HttpHeaders,s=new p.HttpParams,o=e.headers,u=e.params,a=e.responseType;e.isDirectCall||(n=n.append("X-Requested-With","XMLHttpRequest")),o&&Object.entries(o).forEach(function(e){var t=c(e,2),r=t[0],o=t[1];return n=n.append(r,o)}),u&&Object.entries(u).forEach(function(e){var t=c(e,2),r=t[0],o=t[1];return s=s.append(r,o)});var i={headers:n,params:s,responseType:a};return r=_.includes(this.nonBodyTypeMethods,e.method&&e.method.toUpperCase())?(t=i,null):(t=e.data,i),new p.HttpRequest(e.method,e.url,t,r)},e.prototype.getErrMessage=function(e){var t={404:this.getLocale().MESSAGE_404_ERROR||"Requested resource not found",401:this.getLocale().MESSAGE_401_ERROR||"Requested resource requires authentication",403:this.getLocale().LABEL_FORBIDDEN_MESSAGE||"The requested resource access/action is forbidden."}[e.status],r=e.error;return t=(r=s.getValidJSON(r)||r)&&r.errors?this.parseErrors(r.errors):t||"Service Call Failed"},e.prototype.sendCallAsObservable=function(e){var t=this.generateRequest(e);return this.httpClient.request(t)},e.prototype.send=function(e){var n=this,t=this.generateRequest(e);return new Promise(function(r,o){n.httpClient.request(t).toPromise().then(function(e){r(e)},function(e){if(n.isPlatformSessionTimeout(e))e._401Subscriber.asObservable().subscribe(function(e){r(e)},function(e){o(e)});else{var t=n.getErrMessage(e);o({error:t,details:e})}})})},e.prototype.setLocale=function(e){this.localeObject=e},e.prototype.getLocale=function(){return this.localeObject},e.prototype.parseErrors=function(e){var r=this,o="";return e.error.forEach(function(e,t){o+=r.parseError(e)+(0<t?"\n":"")}),o},e.prototype.parseError=function(e){return e.message?s.replace(e.message,e.parameters,!0):e.parameters&&e.parameters[0]||""},e.prototype.getHeader=function(e,t){return e.headers.get(t)},e.prototype.isPlatformSessionTimeout=function(e){return 401===e.status&&"Session Not Found"===this.getHeader(e,"x-wm-login-errormessage")},e.prototype.get=function(e,t){return(t=t||{}).url=e,t.method="get",this.send(t).then(function(e){return e.body})},e.prototype.post=function(e,t,r){return(r=r||{}).url=e,r.method="post",r.data=t,this.send(r)},e.prototype.put=function(e,t,r){return(r=r||{}).url=e,r.method="put",r.data=t,this.send(r)},e.prototype.patch=function(e,t,r){return(r=r||{}).url=e,r.method="patch",r.data=t,this.send(r)},e.prototype["delete"]=function(e,t){return(t=t||{}).url=e,t.method="delete",this.send(t)},e.prototype.head=function(e,t){return(t=t||{}).url=e,t.method="head",this.send(t)},e.prototype.jsonp=function(e,t){return(t=t||{}).url=e,t.method="jsonp",this.send(t)},e.prototype.upload=function(e,t,r){var o=new p.HttpRequest("POST",e,t,{reportProgress:!0});return this.httpClient.request(o)},e.prototype.registerOnSessionTimeout=function(e){this.sessionTimeoutObservable.asObservable().subscribe(e)},e.prototype.on401=function(){this.sessionTimeoutObservable.next()},e.prototype.pushToSessionFailureQueue=function(e){this.sessionTimeoutQueue.push({callback:e})},e.prototype.executeSessionFailureRequests=function(){var e=this.sessionTimeoutQueue,r=this;r.sessionTimeoutQueue=[],e.forEach(function(t){_.isFunction(t.callback)?t.callback():(t.requestInfo.headers.headers["delete"]("x-wm-xsrf-token"),r.httpClient.request(t.requestInfo).subscribe(function(e){e&&e.type&&t.sub401&&t.sub401.next(e)},function(e){t.sub401.error(e)}))})},e.decorators=[{type:o.Injectable}],e.ctorParameters=function(){return[{type:p.HttpClient}]},e}(s.AbstractHttpService),i=function(){function o(){this.headers=[]}return o.prototype.wmToAngularRequest=function(e){var r;return(r=(r=new p.HttpRequest(e.method,e.url)).clone()).body=e.body,r.method=e.method,r.responseType=e.responseType,r.urlWithParams=e.url,r.withCredentials=e.withCredentials,e.headers.forEach(function(e,t){r.headers=r.headers.append(t,e)}),r},o.prototype.angularToWmRequest=function(t){var e=new o,r=new Map;return e.body=t.body,e.method=t.method,e.responseType=t.responseType,e.url=t.urlWithParams,e.withCredentials=t.withCredentials,t.headers.keys().forEach(function(e){r.set(e,t.headers.headers.get(e.toLowerCase())[0])}),e.headers=r,e},o}(),d=function(e){function o(){return e.call(this)||this}return a(o,e),o.prototype.wmToAngularResponse=function(e){var r;return(r=(r=new p.HttpResponse).clone()).body=e.body,r.error=e.error,r.message=e.message,r.url=e.url,r.ok=e.ok,r.status=e.status,r.statusText=e.statusText,e.headers.forEach(function(e,t){r.headers=r.headers.append(t,e)}),r},o.prototype.angularToWmResponse=function(t){var e,r=new Map;return(e=new o).body=t.body,e.error=t.error,e.message=t.message,e.url=t.url,e.ok=t.ok,e.status=t.status,e.statusText=t.statusText,t.headers.keys().forEach(function(e){r.set(e,t.headers.headers.get(e.toLowerCase())[0])}),e.headers=r,e},o}(i),l=function(){function e(){}return e.forRoot=function(){return{ngModule:t.CommonModule,providers:[{provide:s.AbstractHttpService,useClass:r}]}},e.decorators=[{type:o.NgModule,args:[{imports:[t.CommonModule,p.HttpClientModule],declarations:[]}]}],e}();e.HttpServiceModule=l,e.HttpServiceImpl=r,e.WmHttpRequest=i,e.WmHttpResponse=d,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.min.js.map